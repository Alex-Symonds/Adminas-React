const STATUS_CODE_OK="status_ok",STATUS_CODE_ACTION="status_action",STATUS_CODE_ATTN="status_attn";function nbsp(){return" "}function capitaliseFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function format_money(e){return isNaN(e)?"-":e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}function format_percentage(e,t=0){return isNaN(e)?"-%":e.toLocaleString(void 0,{minimumFractionDigits:t,maximumFractionDigits:2})+"%"}function format_timestamp(e){const t=new Date(e);return`${t.getFullYear()}-${t.getMonth().toString().padStart(2,"0")}-`+t.getDate().toString().padStart(2,"0")}function JobItemIdIcon(e){return React.createElement(JobItemNameTagSpan,{css:"id",name:e.ji_id})}function JobItemPriceListIconSpan(e){let t=e.price_list_name;return null===t&&(t="TBC"),React.createElement(JobItemNameTagSpan,{name:t})}function JobItemNameTagSpan(e){var t;return null===e.name?null:(t="css"in e?" "+e.css:"",React.createElement("span",{class:"name-tag"+t},e.name))}function InvalidIconUI(e){return e.is_valid?null:React.createElement("div",{class:"invalid-icon"},React.createElement("span",null,e.message))}function WarningSubsection(e){return e.show_warning?[React.createElement("div",{className:"warning subsection"+(void 0!==e.css?" "+e.css:"")},React.createElement("h4",null,e.title||"Warning"),React.createElement("p",null,e.message))]:null}function WarningSubSubsectionUI(e){return[React.createElement("div",{className:"warningSubSubsection"+(void 0!==e.css?" "+e.css:"")},React.createElement("h4",{className:"warningSubSubsection_heading"},React.createElement("img",{src:window.PATH_IMAGES+"i-warning.svg",height:"18px","aria-hidden":"true"}),e.title||"Warning"),React.createElement("p",{className:"warningSubSubsection_text"},e.message),void 0===e.children?null:e.children)]}function SubmitButton({submit:e,cssClasses:t}){return React.createElement("button",{className:"button-primary "+(t??""),onClick:e},"submit")}function DeleteButton(e){return e.user_has_permission?React.createElement("button",{type:"button",class:"button-warning delete-btn formControls_button",onClick:e.delete},"delete"):null}function CancelButton(e){return React.createElement("button",{className:"close"+(void 0===e.css?"":" "+e.css),onClick:e.cancel},React.createElement("span",null,"close"))}function EditorControls(e){return[React.createElement("div",{className:"controls formControls"+(void 0===e.bemClass?"":" "+e.bemClass)},React.createElement(SubmitButton,{submit:e.submit,cssClasses:"formControls_submit"}),React.createElement(DeleteButton,{delete:e.delete,user_has_permission:e.want_delete}))]}function PriceComparisonTable(e){let t=0;return 0!==e.second_value&&(t=e.difference/e.second_value*100),React.createElement(PriceComparisonTableUI,{currency:e.currency,difference:e.difference,difference_as_perc:t,first_title:e.first_title,first_value:e.first_value,second_title:e.second_title,second_value:e.second_value})}function PriceComparisonTableUI(e){return[React.createElement("table",{id:"po-discrepancy",class:"price-comparison"},React.createElement("tr",null,React.createElement("th",null,e.first_title),React.createElement("td",null,e.currency),React.createElement("td",{class:"po-total-price-f number"},format_money(e.first_value)),React.createElement("td",null)),React.createElement("tr",null,React.createElement("th",null,e.second_title),React.createElement("td",null,e.currency),React.createElement("td",{class:"selling-price number"},format_money(e.second_value)),React.createElement("td",null)),React.createElement("tr",{class:"conclusion"},React.createElement("th",null,"Difference"),React.createElement("td",null,e.currency),React.createElement("td",{class:"diff-val number"},format_money(e.difference)),React.createElement("td",null,React.createElement("span",{class:"diff-perc"},format_percentage(e.difference_as_perc)))))]}function QuantityNameLi(e){return[React.createElement("li",null,e.quantity," x ",e.name)]}function SelectBackendOptions(a){var e=a.api_url+"?type=select_options_list&name="+a.get_param;const{data:t,error:n,isLoaded:c}=useFetch(e);return n?React.createElement(LoadingErrorUI,{name:"dropdown"}):c&&void 0!==t.opt_list?[React.createElement("select",{className:"formy_select"+(void 0===a.cssClasses?"":" "+a.cssClasses),name:a.select_name,id:a.select_id,required:a.is_required,onChange:a.handle_change},React.createElement(OptionEmptyDefaultUI,{selected_opt_id:a.selected_opt_id}),t.opt_list.map(e=>{var t=e.id==a.selected_opt_id;return React.createElement(OptionIdAndNameUI,{key:e.id.toString(),id:e.id,is_selected:t,name:e.display_str})}))]:React.createElement(LoadingUI,null)}function OptionEmptyDefaultUI(e){return React.createElement("option",{value:"",selected:null!==e.selected_opt_id&&""!==e.selected_opt_id},"---------")}function OptionIdAndNameUI(e){return e.is_selected?React.createElement("option",{value:e.id,selected:!0},e.name):React.createElement("option",{value:e.id},e.name)}function FormLabel(e){return React.createElement("label",{for:e.inputID,className:"formy_label"},e.children)}function LabelFieldContainer({children:e}){return React.createElement("div",{className:"formy_labelFieldContainer"},e)}function get_actions_object(e,t,a,n){return{url:e,create_f:t,update_f:a,delete_f:n}}function getter_and_setter(e,t){return{get:e,set:t}}function get_editor_object(e,t,a){return{on:function(){a(e)},off:function(){a(null)},active_id:t,is_active:t===e}}function LoadingUI(e){return React.createElement("div",{class:"loading"},"Loading...")}function LoadingErrorUI(e){return React.createElement("div",{class:"loading error"},"Error loading ",e.name)}function EmptySectionUI(e){return React.createElement("p",{className:"empty-section-notice"+(void 0!==e.css?" "+e.css:"")},e.message)}const useFetch=e=>{const[t,a]=React.useState([]),[n,c]=React.useState(null),[r,i]=React.useState(!1);return React.useEffect(()=>{(async()=>{await fetch(e).then(e=>get_json_with_status(e)).then(e=>{status_is_good(e)||c(get_error_message(e)),a(e),i(!0)}).catch(e=>{c(e),i(!0)})})()},[e]),{data:t,error:n,isLoaded:r}};function url_for_page_load(e,t,a){return e+`?job_id=${t}&type=page_load&name=`+a}function url_for_url_list(e){return e+"?type=urls"}function set_if_ok(e,t,a){void 0!==e[t]&&a(e[t])}function get_if_defined(e,t,a){return void 0!==e[t]?e[t]:a}function getUpdatedObjectFromList(e,t,a,n,c){var r=t.findIndex(e=>e[a]===n);if(-1===r)throw Error(`Unrecognised ${e} cannot be edited`);return{...t[r],...c}}function getFetchHeaders(e,t=null){return get_request_options(e,t)}const update_server=(e,t,a)=>{fetch(e,t).then(e=>get_json_with_status(e)).then(e=>{a(e)}).catch(e=>{console.log("Error: ",e)})};function BackendErrorUI(e){return null===e.message?null:[React.createElement("div",{class:CLASS_ERROR_MESSAGE},React.createElement("div",{class:"message"},e.message),React.createElement(CancelButton,{cancel:e.turn_off_error}))]}function get_backend_error_object(e,t){return{message:e,set:function(e){t(e)},clear:function(){t(null)}}}function update_list_state(e,t,a,n,c){var r=e.findIndex(e=>e[a]===parseInt(n));-1!==r&&t([...e.slice(0,r),Object.assign(e[r],c),...e.slice(r+1)])}function remove_from_list_state(e,t,a,n){var c=e.findIndex(e=>e[a]===parseInt(n));-1!==c&&t([...e.slice(0,c),...e.slice(c+1)])}function add_to_list_state(e,t){e(e=>[...e,t])}function getUpdatedList(e,t,a,n){return e.map(e=>e[t]===a?n:e)}const PINNED_STRING="pinned",HIGHLIGHTED_STRING="highlighted";function JobComments(e){var t=useJobCommentsModal();const a=useSortByDate(),n=useCommentsFilter();const c=usePagination(n.applyTo(e.comments).sort((e,t)=>{e=new Date(e.created_on),t=new Date(t.created_on);return a.activeSortByDate(e,t)}),5);return[React.createElement("section",{class:"jobComments jobNarrowSection"},t.activeModal===t.options.filter?React.createElement(JobCommentsFilterModal,{editor:t.filterEditor,filterKit:n,title:"Filter Comments"}):t.activeModal===t.options.newComment?React.createElement(CommentEditor,{actions:e.commentsActions,comment:{contents:"",private:!0,pinned:!1,highlighted:!1},editor:t.newCommentEditor,title:"Add Comment"}):null,React.createElement(JobSectionHeadingNarrowUI,{text:"Comments"}),React.createElement(AddButton,{label:"comment",css:"jobComments_addButton jobNarrowSection_content",onClick:t.newCommentEditor.on}),React.createElement("div",{class:"jobComments_viewExistingWrapper jobNarrowSection_content"},React.createElement("div",{class:"jobComments_viewExisting"},React.createElement(JobCommentsControls,{orderByKit:a,filterEditor:t.filterEditor}),React.createElement(PaginationControls,{css:"above",currentPage:c.currentPage,numPages:c.numPages,changePageTo:c.changePageTo,pageNumsForButtons:c.getDisplayPageNumbersForNav(1,1,1,1)}),React.createElement(JobCommentsSubsection,{actions:e.commentsActions,heading:`${n.heading} (${a.heading.toLowerCase()})`,comments:c.page,commentsEditor:e.commentsEditor,css:"jobComments_container",emptyMessage:"No comments on this job match the current filter settings",username:e.username,wantCollapsable:!1}),React.createElement(PaginationControls,{css:"below",currentPage:c.currentPage,numPages:c.numPages,changePageTo:c.changePageTo,pageNumsForButtons:c.getDisplayPageNumbersForNav(1,1,1,1)}))))]}function AddButton({css:e,disabled:t,label:a,onClick:n}){return React.createElement("button",{class:"add-button"+(" "+e??""),onClick:n,disabled:t??!1},a)}function useJobCommentsModal(){const e={filter:1,newComment:2},[t,a]=React.useState(null);return{activeModal:t,newCommentEditor:{on:()=>{a(e.newComment)},off:()=>{a(null)}},filterEditor:{on:()=>{a(e.filter)},off:()=>{a(null)}},options:e}}function useSortByDate(){const a=[{id:"newestFirst",displayStr:"Newest first",f:(e,t)=>t-e},{id:"oldestFirst",displayStr:"Oldest first",f:(e,t)=>e-t}],[e,n]=React.useState(0);return{activeID:a[e].id,activeSortByDate:a[e].f,options:a,update:function(t){var e=a.findIndex(e=>e.id===t);-1!==e&&n(e)},heading:a[e].displayStr}}function JobCommentsControls(t){var e="id_commentOrderSelect";return React.createElement("div",{class:"jobComments_controls"},React.createElement("button",{class:"jobComments_filterButton",onClick:function(){t.filterEditor.on()}},React.createElement("span",{class:"jobComments_filterButtonText"},"filter")),React.createElement("form",{class:"orderByForm jobComments_orderByForm"},React.createElement("label",{htmlFor:e,className:"sr-only"},"Order by"),React.createElement("select",{className:"jobComments_orderBySelect",id:e,onChange:e=>{void 0!==e.target.value&&t.orderByKit.update(e.target.value)}},t.orderByKit.options.map(e=>React.createElement("option",{key:e.id,value:e.id,selected:e.id===t.orderByKit.activeID},e.displayStr)))))}function JobCommentsFilterModal(e){return React.createElement(Modal,{close:e.editor.off},React.createElement("div",{class:"commentFilterEditor"},React.createElement("h3",{className:"modal_heading"},e.title),React.createElement("div",{className:"modal_contents"},React.createElement("form",{className:"commentFilterEditor_form"},React.createElement(CommentsRadioFilter,{legendStr:"Pinned",groupName:"filterByPinned",filterStatus:e.filterKit.pinned.current,FILTER_STATES:e.filterKit.STATE_LIST,trueStr:"Pinned Only",falseStr:"Unpinned Only",bothStr:"Both",filterActions:e.filterKit.pinned.actions}),React.createElement(CommentsRadioFilter,{legendStr:"Highlighted",groupName:"filterByHiglighted",filterStatus:e.filterKit.highlighted.current,FILTER_STATES:e.filterKit.STATE_LIST,trueStr:"Highlighted Only",falseStr:"Unhighlighted Only",bothStr:"Both",filterActions:e.filterKit.highlighted.actions}),React.createElement(CommentsRadioFilter,{legendStr:"Private",groupName:"filterByPrivacy",filterStatus:e.filterKit.private.current,FILTER_STATES:e.filterKit.STATE_LIST,trueStr:"Private Only",falseStr:"Public Only",bothStr:"Both",filterActions:e.filterKit.private.actions})))))}function CommentsRadioFilter(e){return React.createElement("fieldset",{class:"radioFilter"},React.createElement("legend",null,e.legendStr),React.createElement(RadioFilterOption,{isChecked:e.filterStatus===e.FILTER_STATES.true,display_text:e.trueStr,name:e.groupName,handleChange:e.filterActions.setTrue}),React.createElement(RadioFilterOption,{isChecked:e.filterStatus===e.FILTER_STATES.false,display_text:e.falseStr,name:e.groupName,handleChange:e.filterActions.setFalse}),React.createElement(RadioFilterOption,{isChecked:e.filterStatus===e.FILTER_STATES.both,display_text:e.bothStr,name:e.groupName,handleChange:e.filterActions.setBoth}))}function RadioFilterOption(e){return React.createElement("label",{className:`radioFilter_optionLabel radioFilter_optionLabel-${e.isChecked?"":"un"}checked`},React.createElement("input",{hidden:!0,checked:e.isChecked,type:"radio",disabled:!1,name:e.name,value:e.display_text,onChange:()=>e.handleChange()}),React.createElement("span",{class:"radioFilter_optionStr"},e.display_text))}function useCommentsFilter(){const n={false:0,true:1,both:2},[c,e]=React.useState(n.both),[r,t]=React.useState(n.both),[i,a]=React.useState(n.both);function o(e){return{setTrue:()=>e(n.true),setFalse:()=>e(n.false),setBoth:()=>e(n.both)}}return{pinned:{current:c,actions:o(e)},highlighted:{current:r,actions:o(t)},private:{current:i,actions:o(a)},STATE_LIST:n,heading:function(){const e=[a(c,"Pinned","Unpinned"),a(r,"Highlighted","Unhighlighted"),a(i,"Private","Public")];var t=e.reduce((e,t)=>""===t?e:""===e?t:e+", "+t,"");return""!==t?t:"All Comments";function a(e,t,a){return e===n.true?t:e===n.false?a:""}}(),reset:function(){e(n.both),t(n.both),a(n.both)},applyTo:function(e){return null===e?[]:(c===n.true?e=e.filter(e=>e.pinned):c===n.false&&(e=e.filter(e=>!e.pinned)),r===n.true?e=e.filter(e=>e.highlighted):r===n.false&&(e=e.filter(e=>!e.highlighted)),i===n.true?e=e.filter(e=>e.private):i===n.false&&(e=e.filter(e=>!e.private)),e)}}}function JobCommentsSubsection(t){return[React.createElement("section",{className:"subsection jobCommentSection"+(void 0!==t.css?" "+t.css:"")},React.createElement("h4",null,t.heading),React.createElement("div",{className:"subsection_contentWrapper commentContainer"},React.createElement(CommentsEmpty,{comments:t.comments,emptyMessage:t.emptyMessage}),t.comments.map(e=>React.createElement(Comment,{key:e.id.toString(),actions:t.actions,comment:e,commentsEditor:t.commentsEditor,wantCollapsable:t.wantCollapsable}))))]}function filter_comments(e,t){return null===e?[]:t==PINNED_STRING?e.filter(e=>e.pinned):t==HIGHLIGHTED_STRING?e.filter(e=>e.highlighted):e}function CommentsEmpty(e){return null!==e.comments&&0<e.comments.length?null:React.createElement(EmptySectionUI,{message:e.emptyMessage??"No comments on this job",css:"commentSection_empty"})}function Comment(e){var t=get_editor_object(e.comment.id,e.commentsEditor.activeIDStr,e.commentsEditor.set);return React.createElement(React.Fragment,null,t.is_active?React.createElement(CommentEditor,{actions:e.actions,comment:e.comment,editor:t,title:"Edit Comment"}):null,React.createElement(CommentReader,{actions:e.actions,comment:e.comment,editor:t,wantCollapsable:e.wantCollapsable}))}function CommentReader(e){var t="one-comment",a=(t=(t+=e.comment.private?" private":" public")+(e.comment.highlighted?" "+HIGHLIGHTED_STRING:""),e.wantCollapsable?"details":"div"),n=e.wantCollapsable?"summary":"section";return React.createElement("article",{class:t},React.createElement(a,{class:"wrapper"},React.createElement(n,{class:"comment-body"},React.createElement(CommentReaderBodyUI,{comment:e.comment})),React.createElement(CommentReaderFooter,{actions:e.actions,comment:e.comment,editor:e.editor})))}function CommentReaderBodyUI(e){let t="public-status",a="public";return e.comment.user_is_owner&&e.comment.private&&(t="privacy-status",a="PRIVATE"),[React.createElement("span",{class:"main"},React.createElement("div",{class:t},"[",a,"]"),React.createElement(CommentContentsWithLinebreaks,{text:e.comment.contents}))]}function CommentContentsWithLinebreaks(e){return e=e.text.includes("\n")?e.text.split("\n").map(e=>React.createElement("span",null,e,React.createElement("br",null))):React.createElement("p",null,e.text),[React.createElement("span",{class:"contents"},e)]}function CommentReaderFooter(e){var{backend_error:t,toggle_highlighted:a,toggle_pinned:n}=useCommentReaderToggles(e.actions,e.comment);return[React.createElement("section",{class:"footer"},React.createElement("div",{class:"ownership"},e.comment.created_by," on ",e.comment.created_on_str),React.createElement("div",{class:"controls"},React.createElement(BackendErrorUI,{message:t.message,turn_off_error:t.clear}),React.createElement(CommentPinnedButtonUI,{handle_toggle:n,pinned:e.comment.pinned}),React.createElement(CommentHighlightButtonUI,{handle_toggle:a}),React.createElement(CommentEditButtonUI,{editor:e.editor,user_is_owner:e.comment.user_is_owner})))]}function CommentPinnedButtonUI(e){var t=e.pinned?"unpin":"pin",a=e.pinned?"on":"off";return React.createElement("button",{class:"pinned-toggle pin-"+a,onClick:e.handle_toggle},t)}function CommentHighlightButtonUI(e){return React.createElement("button",{class:"highlighted-toggle",onClick:e.handle_toggle},"+/- highlight")}function CommentEditButtonUI(e){return e.user_is_owner?React.createElement("button",{class:"edit-comment",onClick:e.editor.on},"edit"):null}function useCommentReaderToggles(n,c){var[e,t]=React.useState(null);const r=get_backend_error_object(e,t);function a(t){var e=n.url+"?id="+c.id,a=getFetchHeaders("PUT",t);update_server(e,a,e=>{status_is_good(e,204)?n.update_f(c.id,t):r.set(get_error_message(e))})}return{backend_error:r,toggle_highlighted:function(){a({highlighted:!c.highlighted})},toggle_pinned:function(){a({pinned:!c.pinned})}}}function CommentEditor(e){const{backend_error:t,controlled:a,handle_delete:n,handle_submit:c}=useCommentEditor(e.actions,e.editor,e.comment);return[React.createElement(Modal,{close:e.editor.off},React.createElement("div",{class:"commentEditor"},React.createElement("h3",{className:"modal_heading"},e.title),React.createElement("div",{className:"modal_contents"},React.createElement(BackendErrorUI,{message:t.message,turn_off_error:t.clear}),React.createElement("form",{className:"commentEditor_form"},React.createElement("label",{for:"id_comment_contents",className:"sr-only"},"Contents"),React.createElement("textarea",{id:"id_comment_contents",className:"commentEditor_editText",name:"contents",cols:"30",rows:"5",value:a.contents.get,onChange:a.contents.set}),React.createElement(CommentEditorCheckboxes,{controlled:a}),React.createElement(EditorControls,{delete:n,submit:e=>{e.preventDefault(),c()},want_delete:void 0!==e.comment.id})))))]}function CommentEditorCheckboxes({controlled:e}){return React.createElement("div",{class:"commentEditor_checkboxesContainer"},React.createElement(CheckboxWithLabel,{idStr:"id_private_checkbox",labelStr:"Private",isChecked:e.private.get,onChange:e.private.set}),React.createElement(CheckboxWithLabel,{idStr:"id_pinned_checkbox",labelStr:"Pin",isChecked:e.pinned.get,onChange:e.pinned.set}),React.createElement(CheckboxWithLabel,{idStr:"id_highlighted_checkbox",labelStr:"Highlight",isChecked:e.highlighted.get,onChange:e.highlighted.set}))}function CheckboxWithLabel({idStr:e,labelStr:t,isChecked:a,onChange:n}){return React.createElement("div",{className:"checkboxWithLabel"},React.createElement("label",{for:e,className:"checkboxWithLabel_label"},t),React.createElement("input",{type:"checkbox",id:e,checked:a,onChange:n}))}function useCommentEditor(a,n,c){const[e,t]=React.useState(c.contents),[r,i]=React.useState(c.private),[o,s]=React.useState(c.pinned),[l,d]=React.useState(c.highlighted);var m={contents:getter_and_setter(e,function(e){t(e.target.value)}),private:getter_and_setter(r,function(e){i(e.target.checked)}),pinned:getter_and_setter(o,function(e){s(e.target.checked)}),highlighted:getter_and_setter(l,function(e){d(e.target.checked)})},[u,_]=React.useState(null);const p=get_backend_error_object(u,_);function E(){return{contents:e,private:r,pinned:o,highlighted:l}}return{backend_error:p,controlled:m,handle_delete:function(){var e,t;e=a.url+"?id="+c.id,t=getFetchHeaders("DELETE",null),update_server(e,t,e=>{status_is_good(e,204)?a.delete_f(c.id):p.set(get_error_message(e))})},handle_submit:function(){var e,t;void 0===c.id||0===c.id||"0"===c.id?(e=a.url+"?job_id="+window.JOB_ID,t=getFetchHeaders("POST",E()),update_server(e,t,e=>{var t;status_is_good(e,201)?(a.create_f((t=e,{...E(),id:t.id,user_is_owner:!0,created_by:"You",created_on:t.created_on,created_on_str:t.created_on_str})),n.off()):p.set(get_error_message(e))})):(e=a.url+"?id="+c.id,t=getFetchHeaders("PUT",E()),update_server(e,t,e=>{status_is_good(e,204)?(a.update_f(c.id,E()),n.off()):p.set(get_error_message(e))}))}}}function PaginationControls(a){return[React.createElement("div",{className:"pagination pagination-"+a.css},React.createElement("span",{class:"sr-only"},"pages"),a.pageNumsForButtons.map((e,t)=>{t=t<a.pageNumsForButtons.length-1&&1<a.pageNumsForButtons[t+1]-e;return React.createElement(React.Fragment,null,React.createElement(PaginationPageButton,{pageNum:e,onClick:()=>a.changePageTo(e),disabled:e===a.currentPage}),t?React.createElement(PaginationSeparator,null):null)}))]}function PaginationPageButton(e){return React.createElement("button",{className:"pagination_button",onClick:e.onClick,disabled:e.disabled},e.pageNum)}function PaginationSeparator(){return React.createElement("span",{className:"pagination_separator"},"...")}function usePagination(t,a){const[d,n]=React.useState(1),[m,c]=React.useState(1);return React.useEffect(()=>{var e=null!=t&&0<t.length?t.length:-1;-1!==e&&c(Math.ceil(e/a))},[t]),{currentPage:d,numPages:m,page:(e=(d-1)*a,t.slice(e,e+a)),changePageTo:function(e){var t,e=parseInt(e,10);t=e,Number.isInteger(t)&&0<t&&t<=m&&e!==d&&n(e)},getDisplayPageNumbersForNav:function(e,t,a,n){e=l(e),n=l(n);var c=e+(t=l(t))+1+(a=l(a))+n;if(m<=c)return s(1,m);var c=t+1+a,r=m+1-n,i=d<=e+t+1,a=d>=r-a-1;const o=i?s(1,e+c):0===e?[]:s(1,e);return e=a?s(r-c,n+c):0===n?[]:s(r,n),(i||a?o:(r=s(d-t,c),o.concat(r))).concat(e);function s(t,e){return Array.from(Array(e).keys()).map(e=>t+e)}function l(e){var t;return Number.isNaN(e)?(t=parseInt(e),Number.isNaN(t)?0:Math.max(t,0)):Math.max(e,0)}}};var e}function JobDetails(e){var{data:t,error:a,isLoaded:n}=useFetch(url_for_page_load(e.URL_GET_DATA,e.job_id,"details"));return a?React.createElement(LoadingErrorUI,{name:"details"}):n?React.createElement(JobDetailsUI,{currency:e.currency,data:t}):React.createElement(LoadingUI,null)}function JobDetailsUI(e){return[React.createElement("section",{className:"jobDetails jobPanelSection"},React.createElement("h3",{className:"jobPanelSection_headingWrapper"},React.createElement("span",{className:"jobDetails_headerContent jobPanelSection_headingContent"},"General Details",React.createElement("a",{href:e.data.url,class:"edit-icon sectionHeadingWrapper_editIcon"},React.createElement("span",null,"edit")))),React.createElement(JobDetailsIdSectionUI,{data:e.data}),React.createElement(JobDetailsPaymentSectionUI,{currency:e.currency,data:e.data}),React.createElement(JobDetailsDeliverySectionUI,{data:e.data}))]}function JobDetailsIdSectionUI(e){return[React.createElement("section",{class:"jobDetails_subsection"},React.createElement("h4",{className:"jobDetails_subsectionHeading jobPanelSection_subsectionHeading"},"Identification"),React.createElement(JobDetailsReadRowUI,{heading:"Name",value:e.data.name}),React.createElement(JobDetailsReadRowUI,{heading:"Agent",value:e.data.agent}),React.createElement(JobDetailsReadRowUI,{heading:"Customer",value:e.data.customer}),React.createElement(JobDetailsReadRowUI,{heading:"Quote ref",value:e.data.quote_ref}),React.createElement(JobDetailsReadRowUI,{heading:"Country",value:e.data.country_name}),React.createElement(JobDetailsReadRowUI,{heading:"Language",value:e.data.language}))]}function JobDetailsPaymentSectionUI(e){return[React.createElement("section",{class:"jobDetails_subsection"},React.createElement("h4",{className:"jobDetails_subsectionHeading jobPanelSection_subsectionHeading"},"Payment"),React.createElement(JobDetailsReadRowUI,{heading:"Invoice address",value:e.data.invoice_to,cssModifier:"wrap"}),React.createElement(JobDetailsReadRowUI,{heading:"Currency",value:e.currency,cssModifier:"wrap"}),React.createElement(JobDetailsReadRowUI,{heading:"Payment terms",value:e.data.payment_terms,cssModifier:"wrap"}))]}function JobDetailsDeliverySectionUI(e){return[React.createElement("section",{class:"jobDetails_subsection"},React.createElement("h4",{className:"jobDetails_subsectionHeading jobPanelSection_subsectionHeading"},"Delivery"),React.createElement(JobDetailsReadRowUI,{heading:"Delivery address",value:e.data.delivery_to,cssModifier:"wrap"}),React.createElement(JobDetailsReadRowUI,{heading:"Incoterm",value:e.data.incoterm_code+" "+e.data.incoterm_location,cssModifier:"wrap"}))]}function JobDetailsReadRowUI(e){return[React.createElement("div",{className:"jobDetails_row"+(void 0===e.cssModifier?"":" jobDetails_row-"+e.cssModifier)},React.createElement("span",{class:"jobDetails_rowLabel"},e.heading,": "),React.createElement("span",{className:"jobDetails_rowContent"+(void 0===e.cssModifier?"":" jobDetails_rowContent-"+e.cssModifier)},e.value))]}function JobDetailsAndPO(e){return React.createElement("div",{class:"jobDetailsPO jobNarrowSection"},React.createElement(JobSectionHeadingNarrowUI,{text:"Details & Purchase Orders"}),React.createElement("div",{class:"jobDetailsPO_wrapper"},React.createElement(JobDetails,{currency:e.currency,job_id:e.job_id,URL_GET_DATA:e.URL_GET_DATA}),React.createElement(JobPo,{actions_po:e.actions_po,poList:e.poList,currency:e.currency,difference:e.difference,job_id:e.job_id,total_po_value:e.total_po_value,total_items_value:e.total_items_value,has_invalid_currency_po:e.has_invalid_currency_po,URL_GET_DATA:e.URL_GET_DATA})))}function JobDocumentsUI(e){return[React.createElement("section",{class:"jobDocsOut jobNarrowSection"},React.createElement(JobSectionHeadingNarrowUI,{text:"Documents"}),React.createElement("div",{className:"jobDocsOut_contentWrapper"},React.createElement(JobDocumentsSubsection,{docList:e.docList,docQuantities:e.docQuantities,totalQuantityAllItems:e.totalQuantityAllItems,URL_DOCS:e.URL_DOCS,doc_type:"WO",job_id:e.job_id,title:"Works Order"}),React.createElement(JobDocumentsSubsection,{docList:e.docList,docQuantities:e.docQuantities,totalQuantityAllItems:e.totalQuantityAllItems,URL_DOCS:e.URL_DOCS,doc_type:"OC",job_id:e.job_id,title:"Order Confirmation"})))]}function JobDocumentsSubsection(t){var e=t.URL_DOCS+"&type="+t.doc_type,a=get_unassigned_quantity(t.doc_type,t.docQuantities,t.totalQuantityAllItems),n=t.docList.filter(e=>e.doc_type==t.doc_type);return React.createElement(JobDocumentsSubsectionUI,{doc_list:n,doc_type:t.doc_type,title:t.title,unassigned_qty:a,url_builder:e})}function get_unassigned_quantity(e,t,a){var n,c=parseInt(a);for(n in t){var r=t[n];if(r.doc_type==e)return c=(c-=parseInt(r.qty_on_issued))-parseInt(r.qty_on_draft)}return c}function JobDocumentsSubsectionUI(e){return[React.createElement("div",{className:"subsection jobDocsOut_subsection"},React.createElement("h4",{className:"jobDocsOut_subsectionHeading"},e.title),React.createElement("a",{href:e.url_builder,class:"add-button jobDocsOut_subsectionAddButton"},"New ",e.doc_type),React.createElement(JobDocumentsUnassignedItemsUI,{unassigned_qty:e.unassigned_qty}),React.createElement(JobDocumentsOutgoingTable,{doc_list:e.doc_list}))]}function JobDocumentsUnassignedItemsUI(e){return null==e.unassigned_qty||isNaN(e.unassigned_qty)||e.unassigned_qty<=0?null:[React.createElement("div",{class:"jobDocsOut_unassignedWrapper"},React.createElement("span",{class:"jobDocsOut_unassignedIcon"},"?"),React.createElement("span",{class:"jobDocsOut_unassignedMsg"},"unassigned items"))]}function JobDocumentsOutgoingTable(e){return null==e.doc_list||0==e.doc_list.length?null:[React.createElement("table",{className:"documentsOutTable banded"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Reference"),React.createElement("th",null,"Date"),React.createElement("th",null,"Status"))),React.createElement("tbody",null,e.doc_list.map(e=>React.createElement(JobDocumentsOutgoingTableRow,{key:e.doc_version_id,doc:e}))))]}function JobDocumentsOutgoingTableRow(e){var t=null==e.doc.issue_date?"":"issued",a=null==e.doc.issue_date?e.doc.created_on:e.doc.issue_date,n=null==e.doc.issue_date?"draft":"issued",n=1==e.doc.is_valid?n:n+" invalid",n=null==e.doc.issue_date?"Draft":"Issued";return e.doc.is_valid||(n=React.createElement(InvalidIconUI,{is_valid:e.doc.is_valid,message:"invalid item assignments"})),React.createElement("tr",null,React.createElement("td",{className:"documentsOutTable_referenceCol"},e.doc.reference),React.createElement("td",{className:"documentsOutTable_dateCol"},t," ",a),React.createElement("td",{className:"documentsOutTable_statusCol documentsOutTable_statusCol-"+n.toLowerCase()},React.createElement("div",{className:"documentsOutTable_status documentsOutTable_status-"+n.toLowerCase()},n)),React.createElement("td",{className:"documentsOutTable_editCol"},React.createElement("a",{href:e.doc.url,className:"edit-icon"},React.createElement("span",null,"edit"))))}const SELECTED_PARENT="parent",SELECTED_CHILD="child",SELECTED_SIBLING="sibling",CSS_HIGHLIGHTED_TD="content-highlight-wrapper";function JobItems(e){var[t,a]=React.useState(null),t=get_editor_object("create_items_form",t,a);return[React.createElement("section",{class:"jobItems jobNarrowSection"},React.createElement(JobSectionHeadingNarrowUI,{text:"Items"}),React.createElement("div",{class:"jobItems_contentWrapper"},React.createElement("button",{id:"open_item_form_btn",class:"add-button",onClick:t.on,disabled:t.is_active},"Add Items"),React.createElement(JobItemsCreator,{actions_items:e.actions_items,editor:t,job_id:e.job_id,URL_GET_DATA:e.URL_GET_DATA}),React.createElement(JobItemsExisting,{actions_items:e.actions_items,currency:e.currency,items_list:e.items_list,job_id:e.job_id,URL_GET_DATA:e.URL_GET_DATA,URL_MODULE_MANAGEMENT:e.URL_MODULE_MANAGEMENT})))]}function WarningMessageSpan(e){return null===e.message?null:React.createElement("span",{class:"warning-msg"},React.createElement("span",{class:"invalid-icon"}),React.createElement("span",{class:"msg"},e.message))}function JobItemsExisting(e){var t,[a,n]=React.useState(null),a=getter_and_setter(a,n),[n,c]=React.useState(null),c=getter_and_setter(n,c),n=get_details_parent(n,e.items_list);return 0==e.items_list.length?React.createElement(EmptySectionUI,{message:"No items have been entered",css:"jobPage_emptySection"}):(t=slot_assignment_data_by_product(e.items_list),React.createElement(JobItemsExistingUI,{actions_items:e.actions_items,currency:e.currency,details_parent:n,details_state:c,editor_state:a,items_list:e.items_list,job_id:e.job_id,product_slot_assignments:t,URL_GET_DATA:e.URL_GET_DATA,URL_MODULE_MANAGEMENT:e.URL_MODULE_MANAGEMENT}))}function JobItemsExistingUI(e){return[React.createElement("div",{class:"jobItems_existingAndDetailsContainer"},React.createElement(JobItemsExistingTable,{currency:e.currency,details_parent:e.details_parent},React.createElement(JobItemsExistingTableBodyUI,{actions_items:e.actions_items,currency:e.currency,details_items_list:e.details_items_list,details_parent:e.details_parent,details_state:e.details_state,editor_state:e.editor_state,items_list:e.items_list,job_id:e.job_id,product_slot_assignments:e.product_slot_assignments,URL_GET_DATA:e.URL_GET_DATA,URL_MODULE_MANAGEMENT:e.URL_MODULE_MANAGEMENT})),React.createElement(JobItemsDetailsContainer,{actions_items:e.actions_items,currency:e.currency,details_parent:e.details_parent,details_state:e.details_state,editor_state:e.editor_state,job_id:e.job_id,product_slot_assignments:e.product_slot_assignments,URL_GET_DATA:e.URL_GET_DATA,URL_MODULE_MANAGEMENT:e.URL_MODULE_MANAGEMENT}))]}function JobItemsExistingTable(e){var t=null===e.details_parent?"banded":"details-visible";return[React.createElement("table",{id:"jobitems_table",class:"jobItems_existing "+t},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"id"),React.createElement("th",null,"qty"),React.createElement("th",null,"part #"),React.createElement("th",null,"name"),React.createElement("th",null,"modular"),React.createElement("th",null,"sold @ ",e.currency),React.createElement("th",null,"price list"))),React.createElement("tbody",null,e.children))]}function JobItemsExistingTableBodyUI(t){return React.createElement(React.Fragment,null," ",t.items_list.map(e=>React.createElement(JobItemRow,{key:e.ji_id.toString(),actions_items:t.actions_items,currency:t.currency,data:e,details_parent:t.details_parent,details_state:t.details_state,editor_state:t.editor_state,job_id:t.job_id,product_slot_data:t.product_slot_assignments[e.product_id.toString()],URL_GET_DATA:t.URL_GET_DATA,URL_MODULE_MANAGEMENT:t.URL_MODULE_MANAGEMENT}))," ")}function JobItemRow(e){var t=get_details_selection_status(e.data,e.details_parent);return React.createElement(JobItemRowUI,{currency:e.currency,data:e.data,details_selection_status:t,product_slot_data:e.product_slot_data,toggle_details:function(){e.details_state.get===e.data.ji_id?(e.details_state.set(null),document.activeElement.blur()):e.details_state.set(e.data.ji_id)},URL_MODULE_MANAGEMENT:e.URL_MODULE_MANAGEMENT})}function JobItemRowUI(e){var t=get_details_css_class(e.details_selection_status),a=e.details_selection_status===SELECTED_PARENT?" dark":"",n=e.data.is_modular?"":" not-modular";return[React.createElement("tr",{class:t},React.createElement("td",{class:"ji_id"},React.createElement("div",{class:CSS_HIGHLIGHTED_TD},React.createElement(JobItemIdIcon,{ji_id:e.data.ji_id}))),React.createElement("td",{class:"quantity"},e.data.quantity),React.createElement("td",{class:"part_no"},React.createElement("div",{class:CSS_HIGHLIGHTED_TD},e.data.part_number)),React.createElement("td",{class:"product_name"},e.data.product_name),React.createElement("td",{class:"modular"+n},React.createElement(JobItemRowModularContentsUI,{data:e.data,URL_MODULE_MANAGEMENT:e.URL_MODULE_MANAGEMENT})),React.createElement("td",{class:"selling_price"},format_money(parseFloat(e.data.selling_price))),React.createElement("td",{class:"price_list"},React.createElement(JobItemPriceListIconSpan,{price_list_name:e.data.price_list_name})),React.createElement("td",{class:"more_info"},React.createElement("button",{class:"more-icon"+a,onClick:e.toggle_details},React.createElement("span",null,"more info"))))]}function JobItemRowChildTdUI(e){let t="";var a;return 0<e.data.num_assigned&&(a=e.data.total_product_quantity-e.data.num_assigned,t=`${e.data.total_product_quantity} (${e.data.num_assigned}:${a})`),React.createElement("td",{class:"assignments"},React.createElement("div",{class:CSS_HIGHLIGHTED_TD},t))}function JobItemRowModularContentsUI(e){var t;return e.data.is_modular?(t=job_item_module_status_css(e.data),e=job_item_module_status_string(e.data),React.createElement("div",{class:CSS_HIGHLIGHTED_TD+" modules-"+t},e)):React.createElement("div",{class:CSS_HIGHLIGHTED_TD},"-")}function JobItemsDetailsContainer(t){var[e,a]=React.useState(!1),a=getter_and_setter(e,a);return[React.createElement("div",{className:"jobItems_detailsWrapper jobItems_detailsWrapper-"+(e?"expanded":"retracted")+(null===t.details_parent?" jobItems_detailsWrapper-inactive":" jobItems_detailsWrapper-active")},React.createElement("div",{class:"jobItems_detailsHeaderStrip"},React.createElement("h4",{className:"jobItems_detailsHeader"},"item details"),React.createElement(CancelButton,{cancel:function(){t.details_state.set(null)},css:"jobItems_closeDetailsButton"})),React.createElement("div",{class:"jobItems_detailsContent"},null===t.details_parent?React.createElement("p",{className:"jobItems_noSelectionMessage"},"Select an item to view details"):React.createElement(React.Fragment,null,React.createElement(JobItem,{actions_items:t.actions_items,currency:t.currency,data:t.details_parent,details_state:t.details_state,editor_state:t.editor_state,job_id:t.job_id,product_slot_data:t.product_slot_assignments[t.details_parent.product_id.toString()],URL_GET_DATA:t.URL_GET_DATA,URL_MODULE_MANAGEMENT:t.URL_MODULE_MANAGEMENT}),t.details_parent.module_list.map(e=>React.createElement(JobItemProductUI,{key:String(e.product_id),currency:t.currency,data:t.product_slot_assignments[e.product_id.toString()]})))),React.createElement(ExpandCollapseToggle,{expanded_state:a}))]}function ExpandCollapseToggle(e){var t=e.expanded_state.get?"collapse":"expand";const a=!e.expanded_state.get;return React.createElement("div",{className:"jobItems_detailsExpandCollapseWrapper"},React.createElement("button",{class:"jobItems_detailsExpandCollapseButton jobItems_detailsExpandCollapseButton-"+t,onClick:function(){e.expanded_state.set(a)}},React.createElement("span",{class:"sr-only"},t)))}function get_details_parent(t,e){var a;return null===t||-1===(a=e.findIndex(e=>e.ji_id===parseInt(t)))?null:e[a]}function get_details_selection_status(t,e){return null===e?null:e.ji_id===t.ji_id?SELECTED_PARENT:e.product_id===t.product_id?SELECTED_SIBLING:-1===e.module_list.findIndex(e=>e.product_id===t.product_id)?null:SELECTED_CHILD}function get_details_css_class(e){switch(e){case SELECTED_PARENT:return"details-active";case SELECTED_CHILD:return"details-child";case SELECTED_SIBLING:return"details-sibling";default:return null}}function JobItem(e){var t=get_editor_object(e.data.ji_id,e.editor_state.get,e.editor_state.set);return t.is_active?React.createElement(JobItemEditor,{data:e.data,delete_item:function(){e.actions_items.delete_f(e.data.ji_id)},editor:t,job_id:e.job_id,update_item:e.actions_items.update_f,URL_GET_DATA:e.URL_GET_DATA,URL_ITEMS:e.actions_items.url}):React.createElement(JobItemReaderUI,{currency:e.currency,data:e.data,editor:t,job_id:e.job_id,product_slot_data:e.product_slot_data,URL_MODULE_MANAGEMENT:e.URL_MODULE_MANAGEMENT})}function JobItemReaderUI(e){return[React.createElement("div",{class:"jobItems_detailsJobItem"},React.createElement(JobItemHeadingUI,{description:e.data.description,ji_id:e.data.ji_id,part_number:e.data.part_number,product_name:e.data.product_name,quantity:e.data.quantity}),React.createElement(JobItemMoneyUI,{currency:e.currency,data:e.data,editor:e.editor}),React.createElement(JobItemAccessoriesUI,{data:e.data}),React.createElement(JobItemSpecificationUI,{data:e.data,job_id:e.job_id,URL_MODULE_MANAGEMENT:e.URL_MODULE_MANAGEMENT}),React.createElement(JobItemsProductMembers,{currency:e.currency,data:e.product_slot_data,exclude_id:e.data.ji_id,title:"Product also entered as"}),React.createElement(JobItemAssignmentsUI,{product_slot_data:e.product_slot_data}))]}function JobItemHeadingUI(e){return[React.createElement("div",{class:"subsection"},React.createElement("h5",{class:"subsection_heading what"},React.createElement(JobItemHeadingQuantitySpan,{quantity:e.quantity}),React.createElement("span",{class:"product"},e.part_number,": ",e.product_name),React.createElement(JobItemIdIcon,{ji_id:e.ji_id}),React.createElement("div",{class:"desc"},e.description)))]}function JobItemHeadingQuantitySpan(e){return null===e.quantity?null:React.createElement("span",{class:"quantity"},e.quantity," x ")}function JobItemMoneyUI(e){var t=parseFloat(e.data.selling_price);return[React.createElement("div",{class:"money subsection"},React.createElement("span",{class:"selling_price"},e.currency+nbsp()+format_money(t)),React.createElement(JobItemPriceListIconSpan,{price_list_name:e.data.price_list_name}),React.createElement("button",{class:"ji-edit edit-icon",onClick:e.editor.on},React.createElement("span",null,"edit")))]}function JobItemAccessoriesUI(e){var t;return 0==e.data.standard_accessories.length?null:(t=1<e.data.quantity?" (in total)":"",[React.createElement("div",{class:"std-accs-container subsection"},React.createElement("div",{class:"std-accs"},React.createElement("p",null,"Included accessories",t),React.createElement("ul",null,e.data.standard_accessories.map((e,t)=>React.createElement(QuantityNameLi,{key:t,name:e.product_name,quantity:e.quantity})))))])}function JobItemSpecificationUI(e){var t,a,n;return e.data.is_modular?(t=job_item_module_status_css(e.data),a=job_item_module_title_str(e.data),n=e.data.is_complete?null:"incomplete".toUpperCase(),[React.createElement("div",{class:"module-status-section subsection modules-"+t},React.createElement("div",{class:"intro-line"},React.createElement("span",{class:"display-text"},"» ",a),React.createElement(WarningMessageSpan,{message:n}),React.createElement("a",{href:e.URL_MODULE_MANAGEMENT+"#modular_jobitem_"+e.data.ji_id,class:"edit-icon"},React.createElement("span",null,"edit"))),React.createElement("ul",{class:"details"},e.data.module_list.map(e=>React.createElement(QuantityNameLi,{key:e.module_id.toString(),name:e.name,quantity:e.quantity}))))]):null}function job_item_module_status_css(e){return e.excess_modules?"excess":e.is_complete?"ok":"incomplete"}function job_item_module_status_string(e){return e.excess_modules?"special":e.is_complete?"ok":"invalid"}function job_item_module_title_str(e){var t="Specification";return e.excess_modules&&(t="Special "+t),1<e.quantity&&(t+=" (per"+nbsp()+"item)"),t}function JobItemsProductMembers(t){var e=null===t.exclude_id?t.data.members:t.data.members.filter(e=>e.ji_id!==t.exclude_id);return 0===e.length?null:React.createElement(JobItemsProductMembersUI,{currency:t.currency,members:e,title:t.title})}function JobItemsProductMembersUI(t){return[React.createElement("div",{class:"subsection product"},React.createElement("div",{class:"subsection_heading"},t.title),React.createElement("div",{class:"ji-list"},React.createElement("table",null,t.members.map(e=>React.createElement(JobItemsProductMembersRowUI,{key:e.ji_id.toString(),currency:t.currency,data:e})))))]}function JobItemsProductMembersRowUI(e){return[React.createElement("tr",null,React.createElement("td",null,React.createElement(JobItemIdIcon,{ji_id:e.data.ji_id})),React.createElement("td",{class:"desc"},e.data.quantity," for ",e.currency+nbsp()+format_money(parseFloat(e.data.selling_price))),React.createElement("td",null,React.createElement(JobItemPriceListIconSpan,{price_list_name:e.data.price_list_name})))]}function JobItemAssignmentsUI(e){return 0===e.product_slot_data.assignments.length?null:[React.createElement("div",{class:"module-status-section assignments subsection"},React.createElement("div",{class:"intro-line"},React.createElement("span",{class:"display-text"},"« Assignment"),React.createElement("div",{class:"usage-counters"},React.createElement(JobItemAssignmentsCounterUI,{display_str:"used",num:e.product_slot_data.num_assigned,total:e.product_slot_data.total_product_quantity}),React.createElement(JobItemAssignmentsCounterUI,{display_str:"unused",num:e.product_slot_data.total_product_quantity-e.product_slot_data.num_assigned,total:e.product_slot_data.total_product_quantity}))),React.createElement("ul",null,e.product_slot_data.assignments.map((e,t)=>React.createElement(JobItemAssignmentLiUI,{key:t,data:e}))))]}function JobItemAssignmentsCounterUI(e){return[React.createElement("div",{class:"assignment-icon"},React.createElement("span",{class:"label"},e.display_str),React.createElement("span",{class:"status"},e.num,"used"===e.display_str?"/"+e.total:""))]}function JobItemAssignmentLiUI(e){var t=1<e.data.parent_qty?"each ":"";return[React.createElement("li",null,e.data.quantity," ",t,"to ",e.data.parent_qty," x [",e.data.part_num,"] ",e.data.product_name,React.createElement(JobItemIdIcon,{ji_id:e.data.parent_id}))]}function slot_assignment_data_by_product(e){var t,a=initialise_products_list(e);for(t in e){var n=e[t];if(null!=n.module_list&&0<n.module_list.length)for(var c in n.module_list){var r=n.module_list[c].product_id.toString();if(!(r in a))break;c=n.module_list[c].quantity*n.quantity,c=(a[r].num_assigned+=c,{quantity:c,parent_qty:n.quantity,part_num:n.part_number,product_name:n.product_name,parent_id:n.ji_id});a[r].assignments.push(c)}}return a}function initialise_products_list(e){var t,a={};for(t in e){var n=e[t],c=n.product_id.toString();c in a||(a[c]={description:n.description,part_number:n.part_number,product_name:n.product_name,total_product_quantity:0,num_assigned:0,assignments:[],members:[]}),a[c].total_product_quantity+=parseInt(n.quantity),a[c].members.push(n)}return a}function JobItemProductUI(e){return[React.createElement("div",{class:"jobItems_detailsJobItem product"},React.createElement(JobItemHeadingUI,{description:e.data.description,ji_id:null,part_number:e.data.part_number,product_name:e.data.product_name,quantity:null}),React.createElement(JobItemProductQuantityUI,{quantity:e.data.total_product_quantity}),React.createElement(JobItemsProductMembers,{currency:e.currency,data:e.data,exclude_id:null,title:"Entered as"}),React.createElement(JobItemAssignmentsUI,{product_slot_data:e.data}))]}function JobItemProductQuantityUI(e){return[React.createElement("div",{class:"subsection"},React.createElement("span",{class:"product-quantity"},"Total quantity: ",e.quantity))]}function JobItemsCreator(a){const{formSetForms:n,actionsFormSet:c,backendError:e,handleSubmit:t}=useFormSet("ji_id_list",[{be:"quantity",fe:"quantity",init:""},{be:"product",fe:"product_id",init:""},{be:"selling_price",fe:"selling_price",init:""},{be:"price_list",fe:"price_list_id",init:""},{be:"job",fe:"job_id",init:""+a.job_id}],a.actions_items,a.editor,10);return a.editor.is_active?[React.createElement(Modal,{close:a.editor.off},React.createElement("div",{className:"jobItemsCreator"},React.createElement("h3",{className:"modal_heading"},"Add New Items"),React.createElement("div",{className:"modal_contents"},React.createElement(BackendErrorUI,{message:e.message,turn_off_error:e.clear}),React.createElement("form",{className:"jobItemsCreator_form",onSubmit:t},React.createElement(FormSet,{totalForms:n.length,MAX_FORMS:10,actionsFormSet:c},n.map((e,t)=>React.createElement(JobItemsCreatorRow,{key:t,form_index:t,actions_formset:c,data:e,job_id:a.job_id,num_forms:n.length,URL_GET_DATA:a.URL_GET_DATA,URL_ITEMS:a.URL_ITEMS}))),React.createElement("input",{type:"submit",action:"submit",id:"items_submit_button",class:"button-primary button-wide",value:"submit"})))))]:null}function JobItemsCreatorRow(t){function a(e){t.actions_formset.update(t.form_index,e)}var e={quantity:getter_and_setter(t.data.quantity,function(e){a({quantity:e.target.value})}),selling_price:getter_and_setter(t.data.selling_price,function(e){a({selling_price:e.target.value})}),product_id:getter_and_setter(t.data.product_id,function(e){a({product_id:e.target.value})}),price_list_id:getter_and_setter(t.data.price_list_id,function(e){a({price_list_id:e.target.value})})};return React.createElement(JobItemsCreatorRowUI,{num_forms:t.num_forms,handle_click:function(e){e.preventDefault(),t.actions_formset.remove(t.form_index)},controlled:e,job_id:t.job_id,URL_GET_DATA:t.URL_GET_DATA,URL_ITEMS:t.URL_ITEMS,form_index:t.form_index})}function JobItemsCreatorRowUI(e){var t="form-"+e.form_index+"-",a=getFormsetFieldNames(t,"job");return[React.createElement("div",{class:"formSet_formRow"},React.createElement(JobItemsCreatorRowRemoveButton,{num_forms:e.num_forms,handle_click:e.handle_click}),React.createElement(JobItemSharedFormFields,{controlled:e.controlled,description:"",job_id:e.job_id,prefix:t,URL_GET_DATA:e.URL_GET_DATA,URL_ITEMS:e.URL_ITEMS}),React.createElement("input",{type:"hidden",name:a.name,value:e.job_id,id:a.id}))]}function JobItemsCreatorRowRemoveButton(e){return 1===e.num_forms?null:React.createElement("button",{class:"delete-panel formSet_removeItemButton",onClick:e.handle_click},React.createElement("span",null,"remove"))}function JobItemEditor(e){const t=React.useRef();t.current=e;var{backendError:a,controlled:n,handleSubmit:c,handleDelete:r}=useJobItemEditor(t);return[React.createElement(Modal,{close:e.editor.off},React.createElement("div",null,React.createElement("h3",{class:"modal_heading"},"Edit Item"),React.createElement("div",{className:"modal_contents"},React.createElement("div",{className:"formy"},React.createElement(JobItemSharedFormFields,{controlled:n,description:e.data.description,job_id:e.job_id,prefix:"",URL_GET_DATA:e.URL_GET_DATA,URL_ITEMS:e.URL_ITEMS}),React.createElement(BackendErrorUI,{message:a.message,turn_off_error:a.clear}),React.createElement(EditorControls,{delete:r,submit:c,want_delete:!0})))))]}function useJobItemEditor(e){const n=e.current,[c,t]=React.useState(n.data.quantity),[r,a]=React.useState(n.data.selling_price),[i,o]=React.useState(n.data.product_id),[s,l]=React.useState(n.data.price_list_id);var[e,d]=React.useState(null);const m=get_backend_error_object(e,d);e={quantity:getter_and_setter(c,function(e){t(e.target.value)}),selling_price:getter_and_setter(r,function(e){a(e.target.value)}),product_id:getter_and_setter(i,function(e){o(e.target.value)}),price_list_id:getter_and_setter(s,function(e){l(e.target.value)})};return{backendError:m,controlled:e,handleSubmit:function(e){e.preventDefault();var t=n.URL_ITEMS+"?id="+n.data.ji_id;e=getFetchHeaders("PUT",{quantity:c,selling_price:r,product:i,price_list:s}),update_server(t,e,e=>{var t,a;status_is_good(e,204)?"product_id"in(t=function(){var e={};c!=n.data.quantity&&(e.quantity=c);r!=n.data.selling_price&&(e.selling_price=r);i!=n.data.product_id&&(e.product_id=i);s!=n.data.price_list_id&&(e.price_list_id=s);return e}())||"price_list_id"in t?(a=n.URL_ITEMS+"?ji_id="+n.data.ji_id,fetch(a).then(e=>get_json_with_status(e)).then(e=>{status_is_good(e,200)?(n.update_item(n.data.ji_id,e),n.editor.off()):m.set(get_error_message(e))}).catch(e=>console.log(e))):(n.update_item(n.data.ji_id,t),n.editor.off()):m.set(get_error_message(e))})},handleDelete:function(){var e,t;e=n.URL_ITEMS+"?id="+n.data.ji_id,t=getFetchHeaders("DELETE",null),update_server(e,t,e=>{status_is_good(e,204)?(n.delete_item(n.data.ji_id),n.editor.off()):m.set(get_error_message(e))})}}}function JobItemSharedFormFields(t){const[e,a]=React.useState(t.description);return React.createElement(JobItemSharedFormFieldsUI,{controlled:t.controlled,description:e,handle_product_change:function(e){t.controlled.product_id.set(e),e=e.target.value,e=t.URL_GET_DATA+`?type=product_description&product_id=${e}&job_id=`+t.job_id,fetch(e).then(e=>e.json()).then(e=>{"desc"in e&&a(e.desc)}).catch(e=>console.log(e))},prefix:"",URL_GET_DATA:t.URL_GET_DATA})}function JobItemSharedFormFieldsUI(e){var t=getFormsetFieldNames(e.prefix,"quantity"),a=getFormsetFieldNames(e.prefix,"product"),n=getFormsetFieldNames(e.prefix,"selling_price"),c=getFormsetFieldNames(e.prefix,"price_list");return[React.createElement("div",{className:"formy_inputsContainer"},React.createElement(LabelFieldContainer,null,React.createElement(FormLabel,{inputID:t.id},"Quantity"),React.createElement("input",{className:"formy_input",type:"number",name:t.name,id:t.id,value:e.controlled.quantity.get,onChange:e.controlled.quantity.set})),React.createElement("div",{className:"formy_labelFieldContainerWithAutoDesc"},React.createElement(LabelFieldContainer,null,React.createElement(FormLabel,{inputID:a.id},"Item"),React.createElement(SelectBackendOptions,{api_url:e.URL_GET_DATA,get_param:"products",handle_change:e.handle_product_change,is_required:!0,select_id:a.id,select_name:a.name,selected_opt_id:e.controlled.product_id.get})),React.createElement(JobItemAutoDescUI,{description:e.description})),React.createElement(LabelFieldContainer,null,React.createElement(FormLabel,{inputID:n.id},"Selling Price"),React.createElement("input",{className:"formy_input",type:"number",name:n.name,step:"0.01",id:n.id,value:e.controlled.selling_price.get,onChange:e.controlled.selling_price.set})),React.createElement(LabelFieldContainer,null,React.createElement(FormLabel,{inputID:c.id},"Price List"),React.createElement(SelectBackendOptions,{api_url:e.URL_GET_DATA,get_param:"price_lists",handle_change:e.controlled.price_list_id.set,is_required:!0,select_id:c.id,select_name:c.name,selected_opt_id:e.controlled.price_list_id.get})))]}function JobItemAutoDescUI(e){return""===e.description||null===e.description?null:React.createElement("span",{class:"formy_productDesc"},e.description)}function getFormsetFieldNames(e,t){return{name:e+t,id:"id_"+e+t}}function JobPo(e){return[React.createElement("section",{class:"jobPO jobPanelSection"},React.createElement("h3",{className:"jobPanelSection_headingWrapper"},React.createElement("span",{className:"jobPO_headerContent jobPanelSection_headingContent"},"Purchase Orders")),React.createElement("div",{className:"jobPO_content"},React.createElement(JobPoCreate,{actions_po:e.actions_po,currency:e.currency,job_id:e.job_id,URL_GET_DATA:e.URL_GET_DATA}),e.has_invalid_currency_po?React.createElement(WarningSubSubsectionUI,{message:"All POs should be in the same currency as the job.",title:"Error: Currency Mismatch"}):null,0===e.difference||0===e.poList.length?null:React.createElement(WarningSubSubsectionUI,{message:"Sum of PO values does not match sum of line item selling prices.",title:"Discrepancy"},React.createElement(JobPoDiscrepancyUI,{currency:e.currency,difference:e.difference,poList:e.poList,total_po_value:e.total_po_value,total_items_value:e.total_items_value})),React.createElement(JobPOReceived,{actions_po:e.actions_po,currency:e.currency,poList:e.poList,job_id:e.job_id,URL_GET_DATA:e.URL_GET_DATA})))]}function JobPoCreate(e){var[t,a]=React.useState(null),t=get_editor_object("create_po_form",t,a);return[React.createElement("div",{class:"jobPO_addPO"},React.createElement("button",{id:"toggle_po_form_btn",class:"add-button",onClick:t.on,disabled:t.is_active},"New PO"),React.createElement(JobPoAddNew,{actions_po:e.actions_po,currency:e.currency,editor:t,job_id:e.job_id,URL_GET_DATA:e.URL_GET_DATA}))]}function JobPoAddNew(a){var e;return a.editor.is_active?(e={po_id:null,currency:a.currency,date_on_po:null,date_received:null,reference:null,value:null},React.createElement(JobPoEditor,{data:e,editor:a.editor,form_id:"po_form",state_submit:function(e,t){a.actions_po.create_f(e,t)},state_delete:null,job_id:a.job_id,title:"Add PO",URL_GET_DATA:a.URL_GET_DATA})):null}function JobPoDiscrepancyUI(e){return[React.createElement("div",{class:"jobPO_comparisonTableWrapper"},React.createElement("h5",{class:"jobPO_comparisonTableHeading"},"Comparison: Items to PO"),React.createElement(PriceComparisonTable,{currency:e.currency,difference:e.difference,first_title:"PO Sum",first_value:e.total_po_value,second_title:"Line Items Sum",second_value:e.total_items_value}))]}function JobPOReceived(e){return React.createElement("div",{className:"jobPO_receivedSection"},React.createElement("h4",{className:"jobPO_subsectionHeading jobPanelSection_subsectionHeading"},"Received"),0===e.poList.length?React.createElement(EmptySectionUI,{message:"No purchase orders have been entered",css:"jobPage_emptySection"}):React.createElement(JobPoList,{actions_po:e.actions_po,currency:e.currency,poList:e.poList,job_id:e.job_id,URL_GET_DATA:e.URL_GET_DATA}))}function JobPoList(e){var[t,a]=React.useState(null),t=getter_and_setter(t,a);return React.createElement(JobPoListUI,{poList:e.poList,actions_po:e.actions_po,currency:e.currency,editor_state:t,job_id:e.job_id,URL_GET_DATA:e.URL_GET_DATA})}function JobPoListUI(t){return[React.createElement("div",{class:"jobPO_poListWrapper"},React.createElement("table",{id:"po_table",class:"banded"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Reference"),React.createElement("th",null,"Date on PO"),React.createElement("th",null,"Received"),React.createElement("th",null,"Value"))),React.createElement("tbody",null,t.poList.map(e=>React.createElement(JobPoElement,{key:e.po_id.toString(),actions_po:t.actions_po,currency:t.currency,data:e,editor_state:t.editor_state,job_id:t.job_id,URL_GET_DATA:t.URL_GET_DATA})))))]}function JobPoElement(t){var e=get_editor_object(t.data.po_id,t.editor_state.get,t.editor_state.set);return e.is_active?[React.createElement("tr",null,React.createElement("td",{colspan:5},React.createElement(JobPoEditor,{data:t.data,editor:e,form_id:"po_edit_form",state_delete:function(){t.actions_po.delete_f(t.data.po_id)},state_submit:function(e){t.actions_po.update_f(t.data.po_id,e)},job_id:t.job_id,title:"Edit PO",URL_GET_DATA:t.URL_GET_DATA})))]:React.createElement(JobPoReadUI,{currency:t.currency,data:t.data,editor:e})}function JobPoReadUI(e){var t=e.data.currency===e.currency;return[React.createElement("tr",{class:t?null:"invalid"},React.createElement("td",{class:"ref"},e.data.reference),React.createElement("td",{class:"date_on_po"},e.data.date_on_po),React.createElement("td",{class:"date_received"},e.data.date_received),React.createElement("td",{class:"value"},React.createElement(InvalidIconUI,{is_valid:t,message:"job has different currency"}),React.createElement("span",{class:"display-text"},e.data.currency+nbsp()+format_money(parseFloat(e.data.value)))),React.createElement("td",{class:"edit"},React.createElement("button",{type:"button",class:"po-edit edit-icon",onClick:e.editor.on},React.createElement("span",null,"edit"))))]}function JobPoEditor(e){var{error:t,isLoaded:a,backend_error:n,controlled:c,handle_delete:r,handle_submit:i}=usePOEditor(e.data,e.URL_GET_DATA,e.state_submit,e.state_delete,e.editor);return t?React.createElement(LoadingErrorUI,{name:"form"}):a?React.createElement(JobPoEditorUI,{backend_error:n,editor:e.editor,controlled:c,form_id:e.form_id,po_id:e.data.po_id,handle_delete:r,handle_submit:i,title:e.title,URL_GET_DATA:e.URL_GET_DATA}):React.createElement(LoadingUI,null)}function JobPoEditorUI(e){var t="id_po_reference",a="id_date_on_po",n="id_po_date_received",c="id_po_currency",r="id_po_value";return[React.createElement(Modal,{close:e.editor.off},React.createElement("div",{className:"poEditor"},React.createElement("h3",{class:"modal_heading"},e.title),React.createElement("div",{className:"modal_contents"},React.createElement(BackendErrorUI,{message:e.backend_error.message,turn_off_error:e.backend_error.clear}),React.createElement("form",{class:"poEditor_form formy",id:e.form_id},React.createElement("div",{className:"formy_inputsContainer"},React.createElement(LabelFieldContainer,null,React.createElement(FormLabel,{inputID:t},"Customer PO Number:"),React.createElement("input",{className:"poEditor_poNumInput formy_input",type:"text",name:"reference",maxlength:"50",required:"",id:t,value:e.controlled.reference.get,onChange:e.controlled.reference.set})),React.createElement(LabelFieldContainer,null,React.createElement(FormLabel,{inputID:a},"Date on PO:"),React.createElement("input",{className:"formy_date",type:"date",name:"date_on_po",required:"",id:a,value:e.controlled.date_on_po.get,onChange:e.controlled.date_on_po.set})),React.createElement(LabelFieldContainer,null,React.createElement(FormLabel,{inputID:n},"Date received:"),React.createElement("input",{className:"formy_date",type:"date",name:"date_received",required:"",id:n,value:e.controlled.date_received.get,onChange:e.controlled.date_received.set})),React.createElement(LabelFieldContainer,null,React.createElement(FormLabel,{inputID:c},"Currency:"),React.createElement(SelectBackendOptions,{select_id:c,select_name:"currency",is_required:!0,api_url:e.URL_GET_DATA,get_param:"currencies",selected_opt_id:e.controlled.currency.get,handle_change:e.controlled.currency.set,cssClass:"formy_currencySelect"})),React.createElement(LabelFieldContainer,null,React.createElement(FormLabel,{inputID:r},"Value:"),React.createElement("input",{className:"formy_input",type:"number",name:"value",step:"0.01",required:"",id:r,value:e.controlled.po_value.get,onChange:e.controlled.po_value.set}))),React.createElement(EditorControls,{submit:e.handle_submit,delete:e.handle_delete,want_delete:null!==e.po_id})))))]}function usePOEditor(a,e,n,c,r){const[i,t]=React.useState(a.reference),[o,s]=React.useState(a.date_on_po),[l,d]=React.useState(a.date_received),[m,u]=React.useState(a.currency),[_,p]=React.useState(a.value);var E={reference:getter_and_setter(i,function(e){t(e.target.value)}),date_on_po:getter_and_setter(o,function(e){s(e.target.value)}),date_received:getter_and_setter(l,function(e){d(e.target.value)}),currency:getter_and_setter(m,function(e){u(e.target.value)}),po_value:getter_and_setter(_,function(e){p(e.target.value)})};const[b,R]=React.useState(""),{data:g,error:f,isLoaded:h}=useFetch(url_for_url_list(e));React.useEffect(()=>{set_if_ok(g,"po_url",R)},[g]);var[e,v]=React.useState(null);const y=get_backend_error_object(e,v);function I(e,t,a,n){e=getFetchHeaders(e,{reference:i,date_on_po:o,value:_,date_received:l,currency:m,job:window.JOB_ID});update_server(a,e,e=>{status_is_good(e,t)?(n(e),r.off()):y.set(get_error_message(e))})}function S(){return{reference:i,date_on_po:o,value:_,date_received:l,currency:m}}return{error:f,isLoaded:h,backend_error:y,controlled:E,handle_delete:function(e){e.preventDefault();var e=b+"?id="+a.po_id,t=getFetchHeaders("DELETE",null);update_server(e,t,e=>{status_is_good(e,204)?(c(),r.off()):y.set(get_error_message(e))})},handle_submit:function(e){e.preventDefault(),null===a.po_id?I("POST",201,b,e=>{var t=S();t.po_id=e.id,n(t)}):I("PUT",204,b+"?id="+a.po_id,()=>{n(S())})}}}function JobPriceCheck(e){var t=e.items_list.reduce((e,t)=>parseFloat(t.list_price_each)*parseInt(t.quantity)+e,0);return React.createElement(JobPriceCheckUI,{actions_items:e.actions_items,currency:e.currency,has_invalid_currency_po:e.has_invalid_currency_po,items_list:e.items_list,job_id:e.job_id,price_accepted_state:e.price_accepted_state,total_selling:e.total_selling,total_list:t,URL_GET_DATA:e.URL_GET_DATA})}function JobPriceCheckUI(e){let t;return t=0==e.items_list.length?React.createElement(JobPriceCheckEmptyUI,{is_empty:0==e.items_list.length}):[React.createElement(PriceAcceptanceToggle,{job_id:e.job_id,price_accepted_state:e.price_accepted_state,URL_GET_DATA:e.URL_GET_DATA}),React.createElement(WarningSubsection,{message:`The figures below assume all item selling prices are in the job currency, ${e.currency}. If a selling price is actually in a different currency, the numbers will be inaccurate.`,show_warning:e.has_invalid_currency_po,title:"Caution: PO Currency Mismatch"}),React.createElement(JobPriceCheckSummaryUI,{currency:e.currency,total_selling:e.total_selling,total_list:e.total_list}),React.createElement(JobPriceCheckDetails,{actions_items:e.actions_items,currency:e.currency,items_list:e.items_list})],[React.createElement("section",{id:"price_check_section",class:"jobPriceCheck jobNarrowSection"},React.createElement(JobSectionHeadingNarrowUI,{text:"Prices"}),t)]}function JobPriceCheckEmptyUI(e){return e.is_empty?React.createElement(EmptySectionUI,{message:"Activates upon entering items",css:"jobPage_emptySection jobNarrowSection_content"}):null}function PriceAcceptanceToggle(e){var{error:t,isLoaded:a,toggle_acceptance:n}=usePriceAcceptanceToggle(e.URL_GET_DATA,e.job_id,e.price_accepted_state);return t?React.createElement(LoadingErrorUI,{name:"price acceptance toggle"}):a?React.createElement(PriceAcceptanceToggleUI,{is_accepted:e.price_accepted_state.get,toggle_acceptance:n}):React.createElement(LoadingUI,null)}function PriceAcceptanceToggleUI(e){var t=e.is_accepted?"on":"off",a=e.is_accepted?"accepted":"NOT ACCEPTED";return[React.createElement("div",{id:"price_confirmation_status",className:"jobNarrowSection_content"},React.createElement("div",{class:"status-indicator "+t},React.createElement("span",{class:"status-name"},"selling price is"),React.createElement("button",{id:"price_confirmation_button",onClick:e.toggle_acceptance},a)))]}function usePriceAcceptanceToggle(e,a,n){const[c,t]=React.useState(null),{data:r,error:i,isLoaded:o}=useFetch(url_for_url_list(e,a));return React.useEffect(()=>{set_if_ok(r,"price_acceptance_url",t)},[r]),{error:i,isLoaded:o,toggle_acceptance:function(){if(null!==c){let t=!n.get;var e=getFetchHeaders("PUT",{new_status:t});update_server(c+"?job_id="+a,e,e=>{status_is_good(e,204)?n.set(t):alert("Error: "+get_error_message(e))})}}}}function JobPriceCheckSummaryUI(e){return[React.createElement("div",{class:"subsection jobPriceCheckComparison jobNarrowSection_content"},React.createElement("h4",null,"Comparison to List Price"),React.createElement(PriceComparisonTable,{currency:e.currency,difference:e.total_selling-e.total_list,first_title:"Line Items Sum",first_value:e.total_selling,second_title:"List Prices Sum",second_value:e.total_list}))]}function JobPriceCheckDetails(e){var[t,a]=React.useState(null),t=getter_and_setter(t,a);return[React.createElement("div",{class:"subsection jobPriceCheckDetails jobNarrowSection_content"},React.createElement("h4",null,"Details"),React.createElement("div",{class:"subsection_contentWrapper"},React.createElement("table",{id:"price_check_table",class:"banded"},React.createElement(JobPriceCheckDetailsTableHeadUI,{currency:e.currency}),React.createElement(JobPriceCheckDetailsTableBodyUI,{actions_items:e.actions_items,editor_state:t,items_list:e.items_list}))))]}function JobPriceCheckDetailsTableHeadUI(e){return[React.createElement("thead",null,React.createElement("tr",{class:"upper-h-row"},React.createElement("th",{colspan:4}),React.createElement("th",{colspan:4},"vs. Price List (",e.currency,")"),React.createElement("th",{colspan:4},"vs. Resale (",e.currency,")")),React.createElement("tr",{class:"lower-h-row"},React.createElement("th",null,"id"),React.createElement("th",null,"part #"),React.createElement("th",null,"qty"),React.createElement("th",null,"sold @"),React.createElement("th",null,"version"),React.createElement("th",null,"expected"),React.createElement("th",{colspan:2},"difference"),React.createElement("th",null,"discount"),React.createElement("th",null,"expected"),React.createElement("th",{colspan:2},"difference")))]}function JobPriceCheckDetailsTableBodyUI(t){return[React.createElement("tbody",null,t.items_list.map(e=>React.createElement(JobPriceCheckDetailsTableRow,{key:e.ji_id.toString(),actions_items:t.actions_items,data:e,editor_state:t.editor_state})))]}function JobPriceCheckDetailsTableRow(t){var e=get_editor_object(t.data.ji_id,t.editor_state.get,t.editor_state.set);var a,n,c,r,i=t.actions_items.url+"?id="+t.data.ji_id;return React.createElement(JobPriceCheckDetailsRowUI,{calc:(a=parseFloat(t.data.selling_price),n=parseFloat(t.data.list_price_each)*parseInt(t.data.quantity),c=a-n,r=(e=>{e=1-parseFloat(e)/100;return n*e})(t.data.resale_perc),{selling_price:a,list_price:n,difference_list:c,resale_price:r,difference_resale:a-r}),data:t.data,editor:e,update_item:function(e){t.actions_items.update_f(t.data.ji_id,e)},url_with_id:i})}function JobPriceCheckDetailsRowUI(e){return[React.createElement("tr",{id:"price_check_row_"+e.data.ji_id},React.createElement("td",{class:"ji_id"},React.createElement(JobItemIdIcon,{ji_id:e.data.ji_id})),React.createElement(JobPriceCheckDetailsDescription,{data:e.data}),React.createElement("td",{class:"qty"},e.data.quantity),React.createElement(JobPriceCheckDetailsSellingPrice,{calc:e.calc,data:e.data,editor:e.editor,update_item:e.update_item,url_with_id:e.url_with_id}),React.createElement("td",{class:"version"},React.createElement(JobItemPriceListIconSpan,{price_list_name:e.data.price_list_name})),React.createElement("td",{class:"list-price"},format_money(e.calc.list_price)),React.createElement("td",{class:"list-diff-val"},format_money(e.calc.difference_list)),React.createElement("td",{class:"list-diff-perc"},format_percentage(e.calc.difference_list/e.calc.list_price*100,2)),React.createElement("td",{class:"resale-percentage"},React.createElement(JobItemNameTagSpan,{name:format_percentage(parseFloat(e.data.resale_perc))})),React.createElement("td",{class:"resale-price"},format_money(e.calc.resale_price)),React.createElement("td",{class:"resale-diff-val"},format_money(e.calc.difference_resale)),React.createElement("td",{class:"resale-diff-perc"},format_percentage(e.calc.difference_resale/e.calc.resale_price*100,2)))]}function JobPriceCheckDetailsDescription(e){const[t,a]=React.useState(!1);return[React.createElement("td",{class:"description"},React.createElement("span",{class:"details-toggle",onClick:function(){var e=!t;a(e)}},e.data.part_number),t?React.createElement("span",{class:"details"},e.data.product_name):null)]}function JobPriceCheckDetailsSellingPrice(e){var[t,a]=React.useState(null),t=get_backend_error_object(t,a);return[React.createElement("td",{class:"selling-price-container"},React.createElement(BackendErrorUI,{message:t.message,turn_off_error:t.clear}),React.createElement("span",{class:"selling-price"},format_money(e.calc.selling_price)),React.createElement(JobPriceCheckEditButtonUI,{editor:e.editor}),React.createElement(JobPriceCheckPriceEditor,{editor:e.editor,calc:e.calc,data:e.data,update_item:e.update_item,url_with_id:e.url_with_id,backend_error:t}))]}function JobPriceCheckEditButtonUI(e){return React.createElement("button",{class:"edit-btn edit-icon",onClick:e.editor.on,disabled:null!==e.editor.active_id},React.createElement("span",null,"edit"))}function JobPriceCheckPriceEditor(e){var t,a,n;return e.editor.is_active?({handle_list_click:t,handle_resale_click:a,update_price:n}=priceCheckEditorKit(e.calc,e.url_with_id,e.update_item,e.editor,e.backend_error),React.createElement(JobPriceCheckPriceEditorUI,{calc:e.calc,cancel:e.editor.off,data:e.data,handle_list_click:t,handle_resale_click:a,update_price:n})):null}function JobPriceCheckPriceEditorUI(e){return[React.createElement("div",{class:"priceCheckEditor panel popout"},React.createElement(CancelButton,{cancel:e.cancel}),React.createElement("h5",{class:"panel-header"},"Edit Price"),React.createElement("p",{className:"priceCheckEditor_description"},e.data.quantity," x [",e.data.part_number,"] ",e.data.product_name),React.createElement("div",{class:"priceCheckEditor_optionsContainer"},React.createElement("h6",{className:"priceCheckEditor_optionsHeading"},"Click new price"),React.createElement(PresetPriceButtonUI,{handle_click:e.handle_list_click,price_preset:e.calc.list_price,price_type:"list"}),React.createElement(PresetPriceButtonUI,{handle_click:e.handle_resale_click,price_preset:e.calc.resale_price,price_type:"resale"})),React.createElement(ManualPriceInput,{handle_submit:e.update_price}))]}function PresetPriceButtonUI(e){return React.createElement("button",{class:"priceCheckEditor_presetPriceButton button-primary-hollow",onClick:e.handle_click},e.price_type," (",format_money(parseFloat(e.price_preset)),")")}function ManualPriceInput(e){var{customPrice:e,handle_change:t,handle_submit:a}=useManualPriceInput(e.handle_submit);return[React.createElement("form",{class:"priceCheckEditor_customPrice singleInputWithButton"},React.createElement("label",{className:"singleInputWithButton_label",htmlFor:"id_new_price"},"Or enter your own and submit"),React.createElement("input",{className:"singleInputWithButton_input",id:"id_new_price",type:"number",step:.01,name:"new_price",value:e,onChange:t}),React.createElement(SubmitButton,{submit:a,cssClasses:"singleInputWithButton_submit formControls_submit"}))]}function useManualPriceInput(e){const[t,a]=React.useState("");return{customPrice:t,handle_change:function(e){a(e.target.value)},handle_submit:function(){e(t)}}}function priceCheckEditorKit(e,a,n,c,r){function t(e){const t={selling_price:e};e=getFetchHeaders("PUT",t);update_server(a,e,e=>{status_is_good(e,204)?n(t):r.set(get_error_message(e)),c.off()})}return{handle_list_click:function(){t(e.list_price)},handle_resale_click:function(){t(e.resale_price)},update_price:t}}function JobSideNav(t){return[React.createElement("section",{className:"jobSideNav jobSideNav-"+(t.isOpen?"open":"closed")},React.createElement("button",{className:"jobSideNav_closeButton close",onClick:()=>t.close()},React.createElement("span",null,"close")),React.createElement(JobSidebarHeadingUI,{job_id:t.job_id,names:t.names,URL_GET_DATA:t.URL_GET_DATA}),React.createElement("ul",{className:"jobSideNav_list"},t.TABS.map(e=>React.createElement("li",null,React.createElement("button",{className:"jobSideNav_button"+(e===t.activeTab?" jobSideNav_button-on":""),onClick:()=>t.updateActiveTab(e),disabled:e===t.activeTab},e)))))]}function JobSidebarHeadingUI(e){return[React.createElement("div",{className:"jobSideNav_topWrapper"},React.createElement("div",null,React.createElement("h3",{className:"jobSideNav_heading"},e.names.job_name),React.createElement(JobSidebarSubHeadingUI,{customer_name:e.names.customer_name})),React.createElement(JobToDoToggle,{job_id:e.job_id,URL_GET_DATA:e.URL_GET_DATA}))]}function JobSidebarSubHeadingUI(e){return""!=e.customer_name?React.createElement("div",{class:"jobSideNav_subheading"},"for ",e.customer_name):null}function JobToDoToggle(a){const[n,c]=React.useState(!1),[r,e]=React.useState(""),{data:t,error:i,isLoaded:o}=useFetch(url_for_page_load(a.URL_GET_DATA,a.job_id,"todo"));return React.useEffect(()=>{set_if_ok(t,"on_todo",c),set_if_ok(t,"url",e)},[t]),i?React.createElement(LoadingErrorUI,{name:"todo status"}):o?React.createElement(JobToDoToggleUI,{todo:n,toggle_todo:function(){var t=!n,e=getFetchHeaders(t?"PUT":"DELETE",{job_id:a.job_id});update_server(r,e,e=>{status_is_good(e,204)?c(t):alert(get_error_message(e))})}}):React.createElement(LoadingUI,null)}function JobToDoToggleUI(e){var t=e.todo?"on":"off",a=e.todo?"on":"off";return[React.createElement("label",{className:"jobSideNav_toggleWrapper"},React.createElement("input",{hidden:!0,checked:e.todo,type:"checkbox",disabled:!1,name:"onToDo",value:a,onChange:()=>e.toggle_todo()}),React.createElement("span",{className:"toggle_labelText"},"todo"),React.createElement("div",{className:"toggle toggle-"+t},React.createElement("span",{className:"toggle_statusText toggle_statusText-"+t},a),React.createElement("div",{className:"toggle_ball toggle_ball-"+t,"aria-hidden":!0})))]}function BurgerMenuIcon({open:e}){return React.createElement("div",{className:"burgerMenu"},React.createElement("button",{className:"burgerMenu_button",onClick:e},React.createElement("span",{className:"buttonSpan"},"open menu")))}function JobSummary(e){return React.createElement("section",{id:"job_summary",class:"job-section jobSummary"},React.createElement(JobSectionHeadingUI,{text:"Summary"}),React.createElement("div",{className:"jobSummary_contentsLayout"},React.createElement(SubsectionWrapper,{extraClasses:"jobSummaryStatus"},React.createElement("h4",null,"Status"),React.createElement(JobStatusStrip,{status_data:e.status_data})),React.createElement("div",{className:"timeValueContainer"},React.createElement(JobSummary_TimeStamp,{timestamp:format_timestamp(e.timestamp)}),React.createElement(JobSummary_OrderValue,{currency:e.currency,value:e.value})),React.createElement(JobCommentsSubsection,{actions:e.actions_comments,comments:e.comments.filter(e=>e.pinned),commentsEditor:e.commentsEditor,css:"jobCommentSection-summary",heading:"Pinned",emptyMessage:"No comments have been pinned",username:e.username,wantCollapsable:!0}),React.createElement(JobSummary_Items,{currency:e.currency,items_list:e.items_list}),React.createElement(JobSummary_CustomerReference,{po_list:e.po_list})))}function SubsectionWrapper(e){return React.createElement("section",{className:"subsection "+(e.extraClasses??"")},e.children)}function JobSummary_TimeStamp(e){return React.createElement(SubsectionWrapper,{extraClasses:"jobSummaryTimestamp"},React.createElement("h4",null,"Job Opened"),React.createElement("p",{className:"jobSummaryTimestamp_text"},e.timestamp))}function JobSummary_OrderValue(e){return React.createElement(SubsectionWrapper,{extraClasses:"jobSummaryOrderValue"},React.createElement("h4",null,"Order Value"),React.createElement("p",{className:"jobSummaryOrderValue_text"},e.currency," ",format_money(e.value)))}function JobSummary_CustomerReference(e){return React.createElement(SubsectionWrapper,{extraClasses:"jobSummaryCustomerRef"},React.createElement("h4",null,"Customer Reference",1<e.po_list.length?"s":""),React.createElement("ul",{className:"jobSummaryCustomerRef_list"},0===e.po_list.length?React.createElement("li",{className:"empty-section-notice"},"TBC"):e.po_list.map((e,t)=>React.createElement("li",{key:e+"_"+t,className:"jobSummaryCustomerRef_listItem"},React.createElement("span",{className:"jobSummaryCustomerRef_poRef"},e.reference),React.createElement("span",{className:"jobSummaryCustomerRef_poDated"}," dated "+e.date_on_po)))))}function JobSummary_Items(t){var e=5<t.items_list.length;let a=[];if(0<t.items_list.length){const n=t.items_list.toSorted((e,t)=>t.selling_price-e.selling_price);a=a=n.length<=5?n:n.slice(0,5)}return React.createElement(SubsectionWrapper,{extraClasses:"jobSummaryItems"},React.createElement("h4",null,e?"Top ":"","Items"),React.createElement("ul",{className:"jobSummaryItems_list"},0===a.length?React.createElement("li",{className:"empty-section-notice"},"No items have been entered"):a.map(e=>React.createElement("li",{key:""+e.ji_id,className:"jobSummaryItems_item"},`${e.quantity} x [${e.part_number}] `+e.product_name,React.createElement("span",{className:"jobSummaryItems_price"},` @ ${t.currency} `+format_money(parseFloat(e.selling_price)))))),e?React.createElement("p",{className:"jobSummaryItems_moreItems"},"And more..."):null)}function useJobMenu(){var e={summary:"Summary",detailsAndPO:"Details & PO",comments:"Comments",docs_out:"Documents",items:"Items",pricecheck:"Price Check"};const a=[e.summary,e.detailsAndPO,e.comments,e.docs_out,e.items,e.pricecheck],[t,n]=React.useState(!0),[c,r]=React.useState(a[0]);function i(){n(!1)}return{isOpen:t,open:function(){n(!0)},close:i,activeTab:c,updateActiveTab:function(t){-1!==a.findIndex(e=>e===t)&&r(t),window.innerWidth<1200&&i()},TABS:a,TAB_NAMES:e}}function useCommentsEditor(){const[e,t]=React.useState(null);return{activeIDStr:e,set:function(e){t(e)}}}function useJobState(e,t){const a={itemsList:[],poList:[],docList:[],priceAccepted:[],currency:"",timestamp:null,doc_quantities:[],URL_MODULE_MANAGEMENT:"",URL_ITEMS:"",URL_DOCS:"",URL_COMMENTS:"",API_COMMENTS:"",username:"",comments:[],names:{customer_via_agent:"",customer:"",job:""},error:!1,isLoaded:!1,data:!1},[n,c]=React.useState(a),{data:r,error:i,isLoaded:o}=useFetch(url_for_page_load(e,t,"job_page_root"));return React.useEffect(()=>{var e={itemsList:get_if_defined(r,"item_list",a.itemsList),poList:get_if_defined(r,"po_list",a.poList),docList:get_if_defined(r,"doc_list",a.docList),priceAccepted:get_if_defined(r,"price_accepted",a.priceAccepted),currency:get_if_defined(r,"currency",a.currency),timestamp:get_if_defined(r,"timestamp",a.timestamp),doc_quantities:get_if_defined(r,"doc_quantities",a.doc_quantities),URL_MODULE_MANAGEMENT:get_if_defined(r,"URL_MODULE_MANAGEMENT",a.URL_MODULE_MANAGEMENT),URL_ITEMS:get_if_defined(r,"items_url",a.URL_ITEMS),URL_DOCS:get_if_defined(r,"docbuilder_url",a.URL_DOCS),API_COMMENTS:get_if_defined(r,"comments_api",a.API_COMMENTS),username:get_if_defined(r,"username",a.username),comments:get_if_defined(r,"comments",a.comments),names:get_if_defined(r,"names",a.names)};c(e)},[r]),{job:n,updateKey:function(t,a){if(!(t in n))throw Error("Failed to update Job");c(e=>({...e,[t]:a}))},fetchProps:{data:r,error:i,isLoaded:o}}}function useErrorReporting(){const[e,t]=React.useState("");function a(){t("")}return{reportError:function(e){null===e?a():"string"!=typeof e?t("There was an error with reporting an error. :("):t(e)},errorStr:e,closeError:a}}function JobPage(){var e=window.JOB_ID,t=window.URL_GET_DATA,a=useJobMenu(),n=useCommentsEditor();const{errorStr:c,reportError:r,closeError:i}=useErrorReporting(),{job:o,updateKey:s,fetchProps:l}=useJobState(t,e);function d(e,t){try{s(e,t)}catch(e){r(e)}}var m=createCommentsActions(o.comments,d,o.API_COMMENTS,r),u=createPOActions(o.poList,d,r),_=createItemsActions(o.itemsList,d,o.URL_ITEMS,t,e,r),p=getter_and_setter(o.priceAccepted,e=>{d("priceAccepted",e)}),E=jobCalc(o.poList,o.itemsList,o.currency),b={po_count:o.poList.length,value_difference_po_vs_items:E.value_difference_po_vs_items,total_qty_all_items:E.total_qty_all_items,has_invalid_currency_po:E.has_invalid_currency_po,price_accepted:o.priceAccepted,items_list:o.itemsList,doc_list:o.docList,doc_quantities:o.doc_quantities};return React.createElement(JobPageUI,{fetchProps:l,job:o,job_id:e,jobMenu:a,URL_GET_DATA:t},""!==c?React.createElement(BigErrorMessage,{errorStr:c,close:i}):null,React.createElement(JobContentsUI,{calc:E,commentsActions:m,commentsEditor:n,itemsActions:_,job:o,job_id:e,jobMenu:a,poActions:u,price_accepted_state:p,status_data:b,URL_GET_DATA:t,URL_MODULE_MANAGEMENT:o.URL_MODULE_MANAGEMENT}))}function JobPageUI(e){return e.fetchProps.error?React.createElement(LoadingErrorUI,{name:"page"}):e.fetchProps.isLoaded&&null!==e.fetchProps.data?[React.createElement("div",{className:"jobPage"},React.createElement(JobSideNav,{activeTab:e.jobMenu.activeTab,getCSS:e.jobMenu.getCSS,isOpen:e.jobMenu.isOpen,close:e.jobMenu.close,updateActiveTab:e.jobMenu.updateActiveTab,TABS:e.jobMenu.TABS,names:e.job.names,job_id:e.job_id,URL_GET_DATA:e.URL_GET_DATA}),e.jobMenu.isOpen?null:React.createElement(BurgerMenuIcon,{open:e.jobMenu.open}),React.createElement(JobPageContentsWrapper,null,React.createElement(JobHeadingUI,{customer_via_agent:e.job.names.customer_via_agent,job_name:e.job.names.job_name}),e.children))]:React.createElement(LoadingUI,null)}function JobPageContentsWrapper(e){return React.createElement("div",{className:"jobPageContentsWrapper"},e.children)}function JobHeadingUI(e){return[React.createElement("div",{class:"jobPageHeading"},React.createElement("h2",{className:"pageHeading jobPageHeading_heading"},"Job ",e.job_name),React.createElement(JobSubHeadingUI,{customer_via_agent:e.customer_via_agent}))]}function JobSubHeadingUI(e){return""!=e.customer_via_agent?React.createElement("div",{class:"jobPageHeading_subheading subheading"},e.customer_via_agent):null}function JobSectionHeadingUI(e){return React.createElement("h3",{className:"sectionHeading"},e.text)}function JobSectionHeadingNarrowUI(e){return React.createElement("h3",{className:"sectionHeading jobNarrowSection_header"},React.createElement("span",{className:"jobNarrowSection_headerText"},e.text))}function JobContentsUI(e){var t=e.jobMenu.TAB_NAMES;return e.jobMenu.activeTab===t.detailsAndPO?React.createElement(JobDetailsAndPO,{currency:e.job.currency,job_id:e.job_id,URL_GET_DATA:e.URL_GET_DATA,actions_po:e.poActions,poList:e.job.poList,difference:e.calc.difference,total_po_value:e.calc.total_po_value,total_items_value:e.calc.total_items_value,has_invalid_currency_po:e.calc.has_invalid_currency_po}):e.jobMenu.activeTab===t.comments?React.createElement(JobComments,{commentsEditor:e.commentsEditor,commentsActions:e.commentsActions,commentsURL:e.job.URL_COMMENTS,comments:e.job.comments,username:e.job.username}):e.jobMenu.activeTab===t.docs_out?React.createElement(JobDocumentsUI,{URL_DOCS:e.job.URL_DOCS,docList:e.job.docList,docQuantities:e.doc_quantities,totalQuantityAllItems:e.calc.total_qty_all_items,job_id:e.job_id}):e.jobMenu.activeTab===t.items?React.createElement(JobItems,{actions_items:e.itemsActions,items_list:e.job.itemsList,currency:e.job.currency,URL_MODULE_MANAGEMENT:e.job.URL_MODULE_MANAGEMENT,job_id:e.job_id,URL_GET_DATA:e.URL_GET_DATA}):e.jobMenu.activeTab===t.pricecheck?React.createElement(JobPriceCheck,{has_invalid_currency_po:e.calc.has_invalid_currency_po,total_selling:e.calc.total_items_value,actions_items:e.itemsActions,items_list:e.job.itemsList,currency:e.job.currency,price_accepted_state:e.price_accepted_state,job_id:e.job_id,URL_GET_DATA:e.URL_GET_DATA}):React.createElement(JobSummary,{actions_comments:e.commentsActions,comments:e.job.comments,commentsEditor:e.commentsEditor,po_list:e.job.poList,value:e.calc.total_items_value,items_list:e.job.itemsList,status_data:e.status_data,timestamp:e.job.timestamp,username:e.job.username,currency:e.job.currency})}function createCommentsActions(n,c,e,r){const i="comments";return get_actions_object(e,function(e){c(i,[...n,e])},function(e,t){try{var a=getUpdatedObjectFromList("comment",n,"id",e,t);c(i,getUpdatedList(n,"id",e,a))}catch(e){r(e)}},function(t){c(i,n.filter(e=>e.id!==t))})}function createPOActions(n,c,r){const i="poList",o="po_id";return get_actions_object(null,function(e){c(i,[...n,e])},function(e,t){try{var a=getUpdatedObjectFromList("PO",n,o,e,t);c(i,getUpdatedList(n,o,e,a))}catch(e){r(e)}},function(t){c(i,n.filter(e=>e[o]!==t))})}function createItemsActions(n,c,e,a,r,i){const o="itemsList",s="ji_id";function l(e,t){null!==t&&!function(e,t,a){if(!("quantity"in a))return;if(!("ji_id"in a))return 1;a=a.quantity;var n=e.findIndex(e=>e.ji_id===parseInt(t));if(-1===n)return 1;e=e[n].quantity;return parseInt(e)!==parseInt(a)}(n,e,t)||fetch(url_for_page_load(a,r,"documents")).then(e=>e.json()).then(e=>{if(void 0===e.doc_list)throw Error("Document status failed to update on screen and is unreliable.");c("docList",e.doc_list)}).catch(e=>i(e))}return get_actions_object(e,function(e){e=n.concat(e),c(o,e)},function(e,t){try{l(e,t);var a=getUpdatedObjectFromList("item",n,s,e,t);c(o,getUpdatedList(n,s,e,a))}catch(e){i(e)}},function(t){l(t,null),c(o,n.filter(e=>e[s]!==t))})}function jobCalc(e,t,a){var n=e.reduce((e,t)=>t.currency==a?parseFloat(t.value)+e:e,0),c=t.reduce((e,t)=>parseFloat(t.selling_price)+e,0);return{difference:n-c,total_items_value:c,total_po_value:n,has_invalid_currency_po:function(t,a){for(let e=0;e<t.length;e++)if(t[e].currency!==a)return!0;return!1}(e,a),total_qty_all_items:t.reduce((e,t)=>parseInt(t.quantity)+e,0)}}function JobStatusStrip(e){e=list_of_job_statuses(e.status_data);return[React.createElement("div",{class:"jobSummaryStatus_container"},e.map((e,t)=>React.createElement(JobStatusElementUI,{key:t,status_code:e[0],message:e[1]})))]}function JobStatusElementUI(e){var t="status-ele "+e.status_code,a=get_job_status_symbol(e.status_code);return[React.createElement("div",{class:t},React.createElement("span",{class:"icon"},a),React.createElement("span",{class:"message"},e.message))]}function get_job_status_symbol(e){var t={[STATUS_CODE_OK]:"ok",[STATUS_CODE_ATTN]:"!",[STATUS_CODE_ACTION]:"?"};return e in t?t[e]:"-"}function list_of_job_statuses(e){var t=[];return t=(t=(t=(t=(t=t.concat(get_status_price_acceptance(e))).concat(get_status_items(e))).concat(get_status_po(e))).concat(get_status_documents(e))).concat(get_status_document_validity(e))}function get_status_price_acceptance(e){return e.price_accepted?[[STATUS_CODE_OK,"Price accepted"]]:[[STATUS_CODE_ACTION,"Price not accepted"]]}function get_status_items(e){var t=[];return 0==e.total_qty_all_items?t.push([STATUS_CODE_ACTION,"No items"]):(e.items_list.some(e=>!0===e.excess_modules)&&t.push([STATUS_CODE_ATTN,"Special item/s"]),e.items_list.some(e=>!0===e.is_modular&&!1===e.is_complete)?t.push([STATUS_CODE_ACTION,"Item/s incomplete"]):t.push([STATUS_CODE_OK,"Items ok"])),t}function get_status_po(e){return 0==e.po_count?[[STATUS_CODE_ACTION,"PO missing"]]:!0===e.has_invalid_currency_po?[[STATUS_CODE_ACTION,"PO currency mismatch"]]:0!=e.value_difference_po_vs_items?[[STATUS_CODE_ACTION,"PO discrepancy"]]:[[STATUS_CODE_OK,"PO ok"]]}function get_status_documents(e){var t,a=[];for(t in e.doc_quantities){var n=e.doc_quantities[t],c=n.doc_type+" ",r=parseInt(n.qty_on_issued),n=parseInt(n.qty_on_draft);e.total_qty_all_items==r?a.push([STATUS_CODE_OK,c+"ok"]):e.total_qty_all_items==r+n?a.push([STATUS_CODE_ACTION,c+"pending"]):a.push([STATUS_CODE_ACTION,c+"needed"])}return a}function get_status_document_validity(e){let t={},a=[];for(var n in e.doc_list){var n=e.doc_list[n],c=n.doc_type;c in t||n.is_valid||(t[c]=1,a.push([STATUS_CODE_ACTION,"Invalid "+c]))}return a}function BigErrorMessage({errorStr:e,close:t}){return React.createElement(Modal,{close:t},React.createElement("section",{className:"bigErrorMessage"},React.createElement("h2",{className:"bigErrorMessage_heading"},"Error"),React.createElement("p",{className:"bigErrorMessage_genericText"},"The following error has occurred:"),React.createElement("p",{className:"bigErrorMessage_specificError"},e),React.createElement("p",{className:"bigErrorMessage_genericText"},"If the error did not contain any specific instructions to resolve the issue, try refreshing the page.")))}function Modal({children:e,close:t}){const a=React.useRef();return React.useLayoutEffect(()=>{a.current.show()},[]),React.createElement("div",{className:"modalWrapper"},React.createElement("dialog",{className:"modal",ref:a},React.createElement("button",{className:"modal_closeButton close",onClick:()=>{a.current.close(),t()}},React.createElement("span",null,"close")),e))}function FormSet({actionsFormSet:e,MAX_FORMS:t,totalForms:a,children:n}){return React.createElement(React.Fragment,null,React.createElement("input",{type:"hidden",name:"form-TOTAL_FORMS",value:a,id:"id_form-TOTAL_FORMS"}),React.createElement("input",{type:"hidden",name:"form-INITIAL_FORMS",value:"0",id:"id_form-INITIAL_FORMS"}),React.createElement("input",{type:"hidden",name:"form-MIN_NUM_FORMS",value:"0",id:"id_form-MIN_NUM_FORMS"}),React.createElement("input",{type:"hidden",name:"form-MAX_NUM_FORMS",value:t,id:"id_form-MAX_NUM_FORMS"}),React.createElement("div",{className:"formSet_formRowsContainer"},n),React.createElement("div",{className:"formSet_addMoreContainer"},React.createElement("button",{class:"formSet_addOne add-button",onClick:e.add_one},React.createElement("span",null,"add 1 more")),React.createElement("div",{class:"formSet_addNMore"},React.createElement("label",{className:"formSet_addNMoreLabel"},"add more",React.createElement("input",{type:"number",className:"formSet_inputNMore",id:"add_multi_items",value:e.num_to_add.get,onChange:e.num_to_add.set})),React.createElement("button",{type:"button",class:"formSet_submitNMore button-primary",onClick:e.add_multiple},"add"))))}function useFormSet(c,i,r,o,s=10){const n=i.reduce((e,t)=>({...e,[t.fe]:t.init}),{}),[l,d]=React.useState(0),[m,u]=React.useState([n]);var[e,t]=React.useState(null);const _=get_backend_error_object(e,t);e={add_one:function(e){e.preventDefault(),m.length>=s||u([...m,n])},add_multiple:function(e){if(e.preventDefault(),0!==l){for(var t=[],a=0;a<l;)t.push(n),a++;u(m.concat(t)),d(0)}},num_to_add:getter_and_setter(l,function(e){(e=e.target.value)<0?d(0):d(e)}),remove:function(a){u(m.filter((e,t)=>t!==a))},update:function(a,e){if(m.length<=a)throw Error("Formset fields were not updated");const n={...m[a],...e};e=m.map((e,t)=>t===a?n:e),u(e)}};return{formSetForms:m,actionsFormSet:e,backendError:_,handleSubmit:function(e){var t;e.preventDefault(),e=r.url,t=getFetchHeaders("POST",function(){const e={"form-TOTAL_FORMS":""+m.length,"form-INITIAL_FORMS":"0","form-MIN_NUM_FORMS":"0","form-MAX_NUM_FORMS":""+s};for(var t in m){var a,n=m[t],c=`form-${t}-`;for(a in i){var r=i[a];e[c+r.be]=n[r.fe]}}return e}()),update_server(e,t,e=>{var t,a,n;status_is_good(e,201)?void 0!==e.id_list?(t=e.id_list,a=r.url,n=getFetchHeaders("GET",null),t=t.join("."),a=a+`?${c}=`+t,update_server(a,n,e=>{status_is_good(e,200)?(r.create_f(e.jobitems),o.off()):_.set(get_error_message(e))})):_.set("Page refresh recommended."):_.set(get_error_message(e))})},MAX_FORMS:s}}ReactDOM.render(React.createElement(JobPage,null),document.querySelector(".job-page"));