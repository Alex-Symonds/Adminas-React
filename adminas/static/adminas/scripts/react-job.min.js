function nbsp(){return" "}function capitaliseFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function format_money(e){return isNaN(e)?"-":e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}function format_percentage(e,t=0){return isNaN(e)?"-%":e.toLocaleString(void 0,{minimumFractionDigits:t,maximumFractionDigits:2})+"%"}function JobItemIdIcon(e){return React.createElement(JobItemNameTagSpan,{css:" id",name:e.ji_id})}function JobItemPriceListIconSpan(e){let t=e.price_list_name;return null===t&&(t="TBC"),React.createElement(JobItemNameTagSpan,{name:t})}function JobItemNameTagSpan(e){var t;return null===e.name?null:(t="css"in e?" "+e.css:"",React.createElement("span",{class:"name-tag"+t},e.name))}function InvalidIconUI(e){return e.is_valid?null:React.createElement("div",{class:"invalid-icon"},React.createElement("span",null,e.message))}function WarningSubsection(e){return e.show_warning?[React.createElement("div",{class:"warning subsection"},React.createElement("h4",null,e.title||"Warning"),React.createElement("p",null,e.message))]:null}function SubmitButton(e){return React.createElement("button",{class:"button-primary",onClick:e.submit},"submit")}function DeleteButton(e){return e.user_has_permission?React.createElement("button",{class:"button-warning delete-btn",onClick:e.delete},"delete"):null}function CancelButton(e){return React.createElement("button",{class:"close",onClick:e.cancel},React.createElement("span",null,"close"))}function EditorControls(e){return[React.createElement("div",{class:"controls"},React.createElement(SubmitButton,{submit:e.submit}),React.createElement(DeleteButton,{delete:e.delete,user_has_permission:e.want_delete}))]}function PriceComparisonTable(e){let t=0;return 0!==e.second_value&&(t=e.difference/e.second_value*100),React.createElement(PriceComparisonTableUI,{currency:e.currency,difference:e.difference,difference_as_perc:t,first_title:e.first_title,first_value:e.first_value,second_title:e.second_title,second_value:e.second_value})}function PriceComparisonTableUI(e){return[React.createElement("table",{id:"po-discrepancy",class:"price-comparison"},React.createElement("tr",null,React.createElement("th",null,e.first_title),React.createElement("td",null,e.currency),React.createElement("td",{class:"po-total-price-f number"},format_money(e.first_value)),React.createElement("td",null)),React.createElement("tr",null,React.createElement("th",null,e.second_title),React.createElement("td",null,e.currency),React.createElement("td",{class:"selling-price number"},format_money(e.second_value)),React.createElement("td",null)),React.createElement("tr",{class:"conclusion"},React.createElement("th",null,"Difference"),React.createElement("td",null,e.currency),React.createElement("td",{class:"diff-val number"},format_money(e.difference)),React.createElement("td",null,React.createElement("span",{class:"diff-perc"},format_percentage(e.difference_as_perc)))))]}function QuantityNameLi(e){return[React.createElement("li",null,e.quantity," x ",e.name)]}function SelectBackendOptions(a){var e=a.api_url+"?type=select_options_list&name="+a.get_param;const{data:t,error:n,isLoaded:c}=useFetch(e);return n?React.createElement(LoadingErrorUI,{name:"dropdown"}):c&&void 0!==t.opt_list?[React.createElement("select",{name:a.select_name,id:a.select_id,required:a.is_required,onChange:a.handle_change},React.createElement(OptionEmptyDefaultUI,{selected_opt_id:a.selected_opt_id}),t.opt_list.map(e=>{var t=e.id==a.selected_opt_id;return React.createElement(OptionIdAndNameUI,{key:e.id.toString(),id:e.id,is_selected:t,name:e.display_str})}))]:React.createElement(LoadingUI,null)}function OptionEmptyDefaultUI(e){return React.createElement("option",{value:"",selected:null!==e.selected_opt_id&&""!==e.selected_opt_id},"---------")}function OptionIdAndNameUI(e){return e.is_selected?React.createElement("option",{value:e.id,selected:!0},e.name):React.createElement("option",{value:e.id},e.name)}function get_actions_object(e,t,a,n){return{url:e,create_f:t,update_f:a,delete_f:n}}function getter_and_setter(e,t){return{get:e,set:t}}function get_editor_object(e,t,a){return{on:function(){a(e)},off:function(){a(null)},active_id:t,is_active:t===e}}function LoadingUI(e){return React.createElement("div",{class:"loading"},"Loading...")}function LoadingErrorUI(e){return React.createElement("div",{class:"loading error"},"Error loading ",e.name)}function EmptySectionUI(e){return React.createElement("p",{class:"empty-section-notice"},e.message)}const useFetch=e=>{const[t,a]=React.useState([]),[n,c]=React.useState(null),[r,i]=React.useState(!1);return React.useEffect(()=>{(async()=>{await fetch(e).then(e=>get_json_with_status(e)).then(e=>{status_is_good(e)||c(get_error_message(e)),a(e),i(!0)}).catch(e=>{c(e),i(!0)})})()},[e]),{data:t,error:n,isLoaded:r}};function url_for_page_load(e,t,a){return e+`?job_id=${t}&type=page_load&name=`+a}function url_for_url_list(e){return e+"?type=urls"}function set_if_ok(e,t,a){void 0!==e[t]&&a(e[t])}function getFetchHeaders(e,t=null){return get_request_options(e,t)}const update_server=(e,t,a)=>{fetch(e,t).then(e=>get_json_with_status(e)).then(e=>{a(e)}).catch(e=>{console.log("Error: ",e)})};function BackendErrorUI(e){return null===e.message?null:[React.createElement("div",{class:CLASS_ERROR_MESSAGE},React.createElement("div",{class:"message"},e.message),React.createElement(CancelButton,{cancel:e.turn_off_error}))]}function get_backend_error_object(e,t){return{message:e,set:function(e){t(e)},clear:function(){t(null)}}}function update_list_state(e,t,a,n,c){var r=e.findIndex(e=>e[a]===parseInt(n));-1!==r&&t([...e.slice(0,r),Object.assign(e[r],c),...e.slice(r+1)])}function remove_from_list_state(e,t,a,n){var c=e.findIndex(e=>e[a]===parseInt(n));-1!==c&&t([...e.slice(0,c),...e.slice(c+1)])}function add_to_list_state(e,t){e(e=>[...e,t])}const PINNED_STRING="pinned",HIGHLIGHTED_STRING="highlighted";function JobComments(e){const[t,a]=React.useState(""),[n,c]=React.useState(""),[r,i]=React.useState(""),[o,s]=React.useState([]);var[l,_]=React.useState([null,null]),l=getter_and_setter(l,_);const{data:d,error:u,isLoaded:m}=useFetch(url_for_page_load(e.URL_GET_DATA,e.job_id,"comments"));React.useEffect(()=>{set_if_ok(d,"url",a),set_if_ok(d,"api",c),set_if_ok(d,"username",i),set_if_ok(d,"comments",s)},[d]);_=get_actions_object(n,null,function(e,t){update_list_state(o,s,"id",e,t)},function(e){remove_from_list_state(o,s,"id",e)});return u?React.createElement(LoadingErrorUI,{name:"comments"}):m?React.createElement(JobCommentsUI,{actions_comments:_,comments:o,editor_state:l,comment_page_url:t,username:r}):React.createElement(LoadingUI,null)}function JobCommentsUI(e){var t=null===e.comments?0:e.comments.length;return[React.createElement("section",{id:"job_comments",class:"job-section"},React.createElement("h3",null,"Comments"),React.createElement("a",{href:e.comment_page_url+"&page=1"},"See all ",t," comments"),React.createElement(JobCommentsSubsection,{actions_comments:e.actions_comments,comments:e.comments,editor_state:e.editor_state,section_name:PINNED_STRING,username:e.username}),React.createElement(JobCommentsSubsection,{actions_comments:e.actions_comments,comments:e.comments,editor_state:e.editor_state,section_name:HIGHLIGHTED_STRING,username:e.username}))]}function JobCommentsSubsection(e){var t=filter_comments(e.comments,e.section_name);return React.createElement(JobCommentsSubsectionUI,{actions_comments:e.actions_comments,editor_state:e.editor_state,filtered_comments:t,section_name:e.section_name,username:e.username})}function JobCommentsSubsectionUI(t){return[React.createElement("section",{class:"subsection"},React.createElement("h4",null,capitaliseFirstLetter(t.section_name)," by ",t.username),React.createElement("div",{class:"comment-container "+t.section_name},React.createElement(CommentsEmpty,{comments:t.filtered_comments,verbed:t.section_name}),t.filtered_comments.map(e=>React.createElement(Comment,{key:e.id.toString(),actions_comments:t.actions_comments,comment:e,editor_state:t.editor_state,section_name:t.section_name}))))]}function filter_comments(e,t){return null===e?[]:t==PINNED_STRING?e.filter(e=>e.pinned):t==HIGHLIGHTED_STRING?e.filter(e=>e.highlighted):e}function CommentsEmpty(e){return null!==e.comments&&0<e.comments.length?null:React.createElement(EmptySectionUI,{message:`No comments have been ${e.verbed}.`})}function Comment(e){var t=get_editor_object(e.comment.id+"_"+e.section_name,e.editor_state.get,e.editor_state.set);return t.is_active?React.createElement(CommentEditor,{actions_comments:e.actions_comments,comment:e.comment,editor:t}):React.createElement(CommentReaderUI,{actions_comments:e.actions_comments,comment:e.comment,editor:t})}function CommentReaderUI(e){var t="one-comment",t=(t+=e.comment.private?" private":" public")+(e.comment.highlighted?" "+HIGHLIGHTED_STRING:"");return[React.createElement("article",{class:t},React.createElement("details",{class:"wrapper"},React.createElement("summary",{class:"comment-body"},React.createElement(CommentReaderBodyUI,{comment:e.comment})),React.createElement(CommentReaderFooter,{actions_comments:e.actions_comments,comment:e.comment,editor:e.editor})))]}function CommentReaderBodyUI(e){let t="public-status",a="public";return e.comment.user_is_owner&&e.comment.private&&(t="privacy-status",a="PRIVATE"),[React.createElement("span",{class:"main"},React.createElement("div",{class:t},"[",a,"]"),React.createElement(CommentContentsWithLinebreaks,{text:e.comment.contents}))]}function CommentContentsWithLinebreaks(e){return e=e.text.includes("\n")?e.text.split("\n").map(e=>React.createElement("span",null,e,React.createElement("br",null))):React.createElement("p",null,e.text),[React.createElement("span",{class:"contents"},e)]}function CommentReaderFooter(n){var[e,t]=React.useState(null);const c=get_backend_error_object(e,t);function a(t){var e=n.actions_comments.url+"?id="+n.comment.id,a=getFetchHeaders("PUT",t);update_server(e,a,e=>{status_is_good(e,204)?n.actions_comments.update_f(n.comment.id,t):c.set(get_error_message(e))})}return React.createElement(CommentReaderFooterUI,{backend_error:c,comment:n.comment,editor:n.editor,toggle_highlighted:function(){a({highlighted:!n.comment.highlighted})},toggle_pinned:function(){a({pinned:!n.comment.pinned})}})}function CommentReaderFooterUI(e){return[React.createElement("section",{class:"footer"},React.createElement("div",{class:"ownership"},e.comment.created_by," on ",e.comment.created_on),React.createElement("div",{class:"controls"},React.createElement(BackendErrorUI,{message:e.backend_error.message,turn_off_error:e.backend_error.clear}),React.createElement(CommentPinnedButtonUI,{handle_toggle:e.toggle_pinned,pinned:e.comment.pinned}),React.createElement(CommentHighlightButtonUI,{handle_toggle:e.toggle_highlighted}),React.createElement(CommentEditButtonUI,{editor:e.editor,user_is_owner:e.comment.user_is_owner})))]}function CommentPinnedButtonUI(e){var t=e.pinned?"unpin":"pin",a=e.pinned?"on":"off";return React.createElement("button",{class:"pinned-toggle pin-"+a,onClick:e.handle_toggle},t)}function CommentHighlightButtonUI(e){return React.createElement("button",{class:"highlighted-toggle",onClick:e.handle_toggle},"+/- highlight")}function CommentEditButtonUI(e){return e.user_is_owner?React.createElement("button",{class:"edit-comment",onClick:e.editor.on},"edit"):null}function CommentEditor(a){const[e,t]=React.useState(a.comment.contents),[n,c]=React.useState(a.comment.private),[r,i]=React.useState(a.comment.pinned),[o,s]=React.useState(a.comment.highlighted);var l={contents:getter_and_setter(e,function(e){t(e.target.value)}),private:getter_and_setter(n,function(e){c(e.target.checked)}),pinned:getter_and_setter(r,function(e){i(e.target.checked)}),highlighted:getter_and_setter(o,function(e){s(e.target.checked)})},[_,d]=React.useState(null);const u=get_backend_error_object(_,d);function m(){return{contents:e,private:n,pinned:r,highlighted:o}}return React.createElement(CommentEditorUI,{backend_error:u,controlled:l,editor:a.editor,handle_delete:function(){var e,t;e=a.actions_comments.url+"&id="+a.comment.id,t=getFetchHeaders("DELETE",null),update_server(e,t,e=>{status_is_good(e,204)?a.actions_comments.delete_f(a.comment.id):u.set(get_error_message(e))})},handle_submit:function(){var e=a.actions_comments.url+"?id="+a.comment.id,t=getFetchHeaders("PUT",m());update_server(e,t,e=>{status_is_good(e,204)?(a.actions_comments.update_f(a.comment.id,m()),a.editor.off()):u.set(get_error_message(e))})}})}function CommentEditorUI(e){return[React.createElement("div",{class:"job-comment-cu-container panel form-like"},React.createElement("button",{class:"close",onClick:e.editor.off},React.createElement("span",null,"close")),React.createElement("h4",null,"Edit Comment"),React.createElement(BackendErrorUI,{message:e.backend_error.message,turn_off_error:e.backend_error.clear}),React.createElement("textarea",{id:"id_comment_contents",name:"contents",cols:"30",rows:"5",value:e.controlled.contents.get,onChange:e.controlled.contents.set}),React.createElement(CommentEditorCheckboxes,{controlled:e.controlled}),React.createElement(EditorControls,{delete:e.handle_delete,submit:e.handle_submit,want_delete:!0}))]}function CommentEditorCheckboxes(e){var t="id_private_checkbox",a="id_pinned_checkbox",n="id_highlighted_checkbox";return[React.createElement("div",{class:"checkbox-container"},React.createElement("label",{for:t},"Private"),React.createElement("input",{type:"checkbox",id:t,checked:e.controlled.private.get,onChange:e.controlled.private.set}),React.createElement("label",{for:a},"Pin"),React.createElement("input",{type:"checkbox",id:a,checked:e.controlled.pinned.get,onChange:e.controlled.pinned.set}),React.createElement("label",{for:n},"Highlight"),React.createElement("input",{type:"checkbox",id:n,checked:e.controlled.highlighted.get,onChange:e.controlled.highlighted.set}))]}function JobDetails(e){var{data:t,error:a,isLoaded:n}=useFetch(url_for_page_load(e.URL_GET_DATA,e.job_id,"details"));return a?React.createElement(LoadingErrorUI,{name:"details"}):n?React.createElement(JobDetailsUI,{currency:e.currency,data:t}):React.createElement(LoadingUI,null)}function JobDetailsUI(e){return[React.createElement("section",{id:"job_details",class:"job-section"},React.createElement("h3",null,"General Details"),React.createElement("div",{class:"extended-subheading"},React.createElement("a",{href:e.data.url,class:"edit-icon"},React.createElement("span",null,"edit"))),React.createElement(JobDetailsIdSectionUI,{data:e.data}),React.createElement(JobDetailsPaymentSectionUI,{currency:e.currency,data:e.data}),React.createElement(JobDetailsDeliverySectionUI,{data:e.data}))]}function JobDetailsIdSectionUI(e){return[React.createElement("section",{class:"subsection"},React.createElement("h4",null,"Identification"),React.createElement(JobDetailsReadRowUI,{heading:"Name",value:e.data.name}),React.createElement(JobDetailsReadRowUI,{heading:"Agent",value:e.data.agent}),React.createElement(JobDetailsReadRowUI,{heading:"Customer",value:e.data.customer}),React.createElement(JobDetailsReadRowUI,{heading:"Quote ref",value:e.data.quote_ref}),React.createElement(JobDetailsReadRowUI,{heading:"Country",value:e.data.country_name}),React.createElement(JobDetailsReadRowUI,{heading:"Language",value:e.data.language}))]}function JobDetailsPaymentSectionUI(e){return[React.createElement("section",{id:"job_payment_section",class:"subsection"},React.createElement("h4",null,"Payment"),React.createElement(JobDetailsReadRowUI,{heading:"Invoice address",value:e.data.invoice_to}),React.createElement(JobDetailsReadRowUI,{heading:"Currency",value:e.currency}),React.createElement(JobDetailsReadRowUI,{heading:"Payment terms",value:e.data.payment_terms}))]}function JobDetailsDeliverySectionUI(e){return[React.createElement("section",{id:"job_delivery_section",class:"subsection"},React.createElement("h4",null,"Delivery"),React.createElement(JobDetailsReadRowUI,{heading:"Delivery address",value:e.data.delivery_to}),React.createElement(JobDetailsReadRowUI,{heading:"Incoterm",value:e.data.incoterm_code+" "+e.data.incoterm_location}))]}function JobDetailsReadRowUI(e){return[React.createElement("div",{class:"read_row"},React.createElement("span",{class:"row-label"},e.heading,": "),e.value)]}function JobDocumentsUI(e){return[React.createElement("section",{class:"job-doc-section job-section"},React.createElement("h3",null,"Documents"),React.createElement(JobDocumentsSubsection,{doc_data:e.doc_data,doc_type:"WO",job_id:e.job_id,title:"Works Order"}),React.createElement(JobDocumentsSubsection,{doc_data:e.doc_data,doc_type:"OC",job_id:e.job_id,title:"Order Confirmation"}))]}function JobDocumentsSubsection(t){var e=t.doc_data.URL_DOCS+"&type="+t.doc_type,a=get_unassigned_quantity(t.doc_data,t.doc_type),n=t.doc_data.doc_list.filter(e=>e.doc_type==t.doc_type);return React.createElement(JobDocumentsSubsectionUI,{doc_list:n,doc_type:t.doc_type,title:t.title,unassigned_qty:a,url_builder:e})}function get_unassigned_quantity(e,t){var a,n=parseInt(e.total_quantity_items);for(a in e.doc_quantities){var c=e.doc_quantities[a];if(c.doc_type==t)return n=(n-=parseInt(c.qty_on_issued))-parseInt(c.qty_on_draft)}return n}function JobDocumentsSubsectionUI(e){return[React.createElement("div",{class:"subsection"},React.createElement("h4",null,e.title),React.createElement("a",{href:e.url_builder,class:"add-button"},"New ",e.doc_type),React.createElement(JobDocumentsUnassignedItemsUI,{unassigned_qty:e.unassigned_qty}),React.createElement(JobDocumentsListOfDocLinksUI,{doc_list:e.doc_list}))]}function JobDocumentsUnassignedItemsUI(e){return null==e.unassigned_qty||isNaN(e.unassigned_qty)||e.unassigned_qty<=0?null:[React.createElement("div",{class:"status-ele status_warning"},React.createElement("span",{class:"icon"},"?"),React.createElement("span",{class:"message"},"unassigned items exist"))]}function JobDocumentsListOfDocLinksUI(e){return null==e.doc_list||0==e.doc_list.length?null:[React.createElement("ul",null,e.doc_list.map(e=>React.createElement(JobDocumentsLiUI,{key:e.doc_version_id,doc:e})))]}function JobDocumentsLiUI(e){var t=null==e.doc.issue_date?"":"issued",a=null==e.doc.issue_date?e.doc.created_on:e.doc.issue_date,n=null==e.doc.issue_date?"draft":"issued",n=1==e.doc.is_valid?n:n+" invalid",c=null==e.doc.issue_date?"D":"I";return e.doc.is_valid||(c=React.createElement(InvalidIconUI,{is_valid:e.doc.is_valid,message:"invalid item assignments"})),[React.createElement("li",{class:n},React.createElement("a",{href:e.doc.url},React.createElement("span",{class:"icon"},c),React.createElement("div",{class:"doc-details"},React.createElement("span",{class:"name"},e.doc.doc_type," ",e.doc.reference),React.createElement("span",{class:"doc-date"},t," ",a))))]}const STATUS_CODE_OK="status_ok",STATUS_CODE_ACTION="status_action",STATUS_CODE_ATTN="status_attn";function JobHeadingSubsectionUI(e){return[React.createElement("section",{class:"job-heading-with-status"},React.createElement("div",{id:"job_status_strip",class:"subsection"},React.createElement(JobHeading,{job_id:e.job_id,URL_GET_DATA:e.URL_GET_DATA}),React.createElement(JobStatusStrip,{status_data:e.status_data})))]}function JobHeading(e){const[t,a]=React.useState({job_name:"",customer_name:""}),n=useFetch(url_for_page_load(e.URL_GET_DATA,e.job_id,"heading"))["data"];return React.useEffect(()=>{set_if_ok(n,"names",a)},[n]),React.createElement(JobHeadingUI,{customer_name:t.customer_name,job_id:e.job_id,job_name:t.job_name,URL_GET_DATA:e.URL_GET_DATA})}function JobHeadingUI(e){return[React.createElement("div",{class:"job-heading-with-extra"},React.createElement("h2",null,"Job ",e.job_name),React.createElement(JobToDoIndicator,{job_id:e.job_id,URL_GET_DATA:e.URL_GET_DATA}),React.createElement(JobSubHeadingUI,{customer_name:e.customer_name}))]}function JobToDoIndicator(a){const[n,c]=React.useState(!1),[r,e]=React.useState(""),{data:t,error:i,isLoaded:o}=useFetch(url_for_page_load(a.URL_GET_DATA,a.job_id,"todo"));return React.useEffect(()=>{set_if_ok(t,"on_todo",c),set_if_ok(t,"url",e)},[t]),i?React.createElement(LoadingErrorUI,{name:"todo status"}):o?React.createElement(JobToDoIndicatorUI,{todo:n,toggle_todo:function(){var t=!n,e=getFetchHeaders(t?"PUT":"DELETE",{job_id:a.job_id});update_server(r,e,e=>{status_is_good(e,204)?c(t):alert(get_error_message(e))})}}):React.createElement(LoadingUI,null)}function JobToDoIndicatorUI(e){var t=e.todo?"on":"off",a=e.todo?"on":"off";return[React.createElement("div",{class:"indicator-wrapper"},React.createElement("div",{class:"status-indicator "+t},React.createElement("span",{class:"status-name"},"to-do"),React.createElement("button",{class:"todo-list-toggle",onClick:e.toggle_todo},a)))]}function JobSubHeadingUI(e){return""!=e.customer_name?React.createElement("div",{class:"subheading"},"for ",e.customer_name):null}function JobStatusStrip(e){e=list_of_job_statuses(e.status_data);return[React.createElement("div",{class:"job-status-ele-container"},e.map((e,t)=>React.createElement(JobStatusElementUI,{key:t,status_code:e[0],message:e[1]})))]}function JobStatusElementUI(e){var t="status-ele "+e.status_code,a=job_status_symbol(e.status_code);return[React.createElement("div",{class:t},React.createElement("span",{class:"icon"},a),React.createElement("span",{class:"message"},e.message))]}function job_status_symbol(e){switch(e){case STATUS_CODE_OK:return"ok";case STATUS_CODE_ATTN:return"!";case STATUS_CODE_ACTION:return"?";default:return"-"}}function list_of_job_statuses(e){var t=[];return t=(t=(t=(t=(t=t.concat(get_status_price_acceptance(e))).concat(get_status_items(e))).concat(get_status_po(e))).concat(get_status_documents(e))).concat(get_status_document_validity(e))}function get_status_price_acceptance(e){return e.price_accepted?[[STATUS_CODE_OK,"Price accepted"]]:[[STATUS_CODE_ACTION,"Price not accepted"]]}function get_status_items(e){var t=[];return 0==e.total_qty_all_items?t.push([STATUS_CODE_ACTION,"No items"]):(e.items_list.some(e=>!0===e.excess_modules)&&t.push([STATUS_CODE_ATTN,"Special item/s"]),e.items_list.some(e=>!0===e.is_modular&&!1===e.is_complete)?t.push([STATUS_CODE_ACTION,"Item/s incomplete"]):t.push([STATUS_CODE_OK,"Items ok"])),t}function get_status_po(e){return 0==e.po_count?[[STATUS_CODE_ACTION,"PO missing"]]:!0===e.has_invalid_currency_po?[[STATUS_CODE_ACTION,"PO currency mismatch"]]:0!=e.value_difference_po_vs_items?[[STATUS_CODE_ACTION,"PO discrepancy"]]:[[STATUS_CODE_OK,"PO ok"]]}function get_status_documents(e){var t,a=[];for(t in e.doc_quantities){var n=e.doc_quantities[t],c=n.doc_type+" ",r=parseInt(n.qty_on_issued),n=parseInt(n.qty_on_draft);e.total_qty_all_items==r?a.push([STATUS_CODE_OK,c+"ok"]):e.total_qty_all_items==r+n?a.push([STATUS_CODE_ACTION,c+"pending"]):a.push([STATUS_CODE_ACTION,c+"needed"])}return a}function get_status_document_validity(e){let t={},a=[];for(var n in e.doc_list){var n=e.doc_list[n],c=n.doc_type;c in t||n.is_valid||(t[c]=1,a.push([STATUS_CODE_ACTION,"Invalid "+c]))}return a}const SELECTED_PARENT="parent",SELECTED_CHILD="child",SELECTED_SIBLING="sibling",CSS_HIGHLIGHTED_TD="content-highlight-wrapper";function JobItems(e){var[t,a]=React.useState(null),t=get_editor_object("create_items_form",t,a);return React.createElement(JobItemsUI,{actions_items:e.actions_items,currency:e.currency,editor:t,items_list:e.items_list,job_id:e.job_id,URL_GET_DATA:e.URL_GET_DATA,URL_MODULE_MANAGEMENT:e.URL_MODULE_MANAGEMENT})}function JobItemsUI(e){return[React.createElement("section",{id:"job_items_section",class:"job-section"},React.createElement("h3",null,"Items"),React.createElement("div",{class:"job-items-container"},React.createElement(JobItemsCreatorButtonUI,{editor:e.editor}),React.createElement(JobItemsCreator,{actions_items:e.actions_items,editor:e.editor,job_id:e.job_id,URL_GET_DATA:e.URL_GET_DATA}),React.createElement(JobItemsExisting,{actions_items:e.actions_items,currency:e.currency,items_list:e.items_list,job_id:e.job_id,URL_GET_DATA:e.URL_GET_DATA,URL_MODULE_MANAGEMENT:e.URL_MODULE_MANAGEMENT})))]}function WarningMessageSpan(e){return null===e.message?null:React.createElement("span",{class:"warning-msg"},React.createElement("span",{class:"invalid-icon"}),React.createElement("span",{class:"msg"},e.message))}function JobItemsCreatorButtonUI(e){return e.editor.is_active?null:React.createElement("button",{id:"open_item_form_btn",class:"add-button",onClick:e.editor.on},"Add Items")}function JobItemsExisting(e){var t,a,n,c;return 0==e.items_list.length?React.createElement(EmptySectionUI,{message:"No items have been entered."}):([t,n]=React.useState(null),t=getter_and_setter(t,n),[n,a]=React.useState(null),a=getter_and_setter(n,a),n=get_details_parent(n,e.items_list),c=slot_assignment_data_by_product(e.items_list),React.createElement(JobItemsExistingUI,{actions_items:e.actions_items,currency:e.currency,details_parent:n,details_state:a,editor_state:t,items_list:e.items_list,job_id:e.job_id,product_slot_assignments:c,URL_GET_DATA:e.URL_GET_DATA,URL_MODULE_MANAGEMENT:e.URL_MODULE_MANAGEMENT}))}function JobItemsExistingUI(e){return[React.createElement("div",{class:"existing-items-container"},React.createElement(JobItemsExistingTable,{actions_items:e.actions_items,currency:e.currency,details_items_list:e.details_items_list,details_parent:e.details_parent,details_state:e.details_state,editor_state:e.editor_state,items_list:e.items_list,job_id:e.job_id,product_slot_assignments:e.product_slot_assignments,URL_GET_DATA:e.URL_GET_DATA,URL_MODULE_MANAGEMENT:e.URL_MODULE_MANAGEMENT}),React.createElement(JobItemsDetailsContainer,{actions_items:e.actions_items,currency:e.currency,details_parent:e.details_parent,details_state:e.details_state,editor_state:e.editor_state,job_id:e.job_id,product_slot_assignments:e.product_slot_assignments,URL_GET_DATA:e.URL_GET_DATA,URL_MODULE_MANAGEMENT:e.URL_MODULE_MANAGEMENT}))]}function JobItemsExistingTable(e){var t=null===e.details_parent?"banded":"details-visible";return[React.createElement("table",{id:"jobitems_table",class:t},React.createElement(JobItemsExistingTableHeadUI,{currency:e.currency}),React.createElement(JobItemsExistingTableBodyUI,{actions_items:e.actions_items,currency:e.currency,details_items_list:e.details_items_list,details_parent:e.details_parent,details_state:e.details_state,editor_state:e.editor_state,items_list:e.items_list,job_id:e.job_id,product_slot_assignments:e.product_slot_assignments,URL_GET_DATA:e.URL_GET_DATA,URL_MODULE_MANAGEMENT:e.URL_MODULE_MANAGEMENT}))]}function JobItemsExistingTableHeadUI(e){return[React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"id"),React.createElement("th",null,"qty"),React.createElement("th",null,"part #"),React.createElement("th",null,"name"),React.createElement("th",null,"modular"),React.createElement("th",null,"sold @ ",e.currency),React.createElement("th",null,"price list")))]}function JobItemsExistingTableBodyUI(t){return[React.createElement("tbody",null,t.items_list.map(e=>React.createElement(JobItemRow,{key:e.ji_id.toString(),actions_items:t.actions_items,currency:t.currency,data:e,details_parent:t.details_parent,details_state:t.details_state,editor_state:t.editor_state,job_id:t.job_id,product_slot_data:t.product_slot_assignments[e.product_id.toString()],URL_GET_DATA:t.URL_GET_DATA,URL_MODULE_MANAGEMENT:t.URL_MODULE_MANAGEMENT})))]}function JobItemRow(e){var t=get_details_selection_status(e.data,e.details_parent);return React.createElement(JobItemRowUI,{currency:e.currency,data:e.data,details_selection_status:t,product_slot_data:e.product_slot_data,toggle_details:function(){e.details_state.get===e.data.ji_id?(e.details_state.set(null),document.activeElement.blur()):e.details_state.set(e.data.ji_id)},URL_MODULE_MANAGEMENT:e.URL_MODULE_MANAGEMENT})}function JobItemRowUI(e){var t=get_details_css_class(e.details_selection_status),a=e.details_selection_status===SELECTED_PARENT?" dark":"",n=e.data.is_modular?"":" not-modular";return[React.createElement("tr",{class:t},React.createElement("td",{class:"ji_id"},React.createElement("div",{class:CSS_HIGHLIGHTED_TD},React.createElement(JobItemIdIcon,{ji_id:e.data.ji_id}))),React.createElement("td",{class:"quantity"},e.data.quantity),React.createElement("td",{class:"part_no"},React.createElement("div",{class:CSS_HIGHLIGHTED_TD},e.data.part_number)),React.createElement("td",{class:"product_name"},e.data.product_name),React.createElement("td",{class:"modular"+n},React.createElement(JobItemRowModularContentsUI,{data:e.data,URL_MODULE_MANAGEMENT:e.URL_MODULE_MANAGEMENT})),React.createElement("td",{class:"selling_price"},format_money(parseFloat(e.data.selling_price))),React.createElement("td",{class:"price_list"},React.createElement(JobItemPriceListIconSpan,{price_list_name:e.data.price_list_name})),React.createElement("td",{class:"more_info"},React.createElement("button",{class:"more-icon"+a,onClick:e.toggle_details},React.createElement("span",null,"more info"))))]}function JobItemRowChildTdUI(e){let t="";var a;return 0<e.data.num_assigned&&(a=e.data.total_product_quantity-e.data.num_assigned,t=`${e.data.total_product_quantity} (${e.data.num_assigned}:${a})`),React.createElement("td",{class:"assignments"},React.createElement("div",{class:CSS_HIGHLIGHTED_TD},t))}function JobItemRowModularContentsUI(e){var t;return e.data.is_modular?(t=job_item_module_status_css(e.data),e=job_item_module_status_string(e.data),React.createElement("div",{class:CSS_HIGHLIGHTED_TD+" modules-"+t},e)):React.createElement("div",{class:CSS_HIGHLIGHTED_TD},"-")}function JobItemsDetailsContainer(t){var e,a;return null===t.details_parent?null:([e,a]=React.useState(!0),a=getter_and_setter(e,a),[React.createElement("div",{class:"jobitems-details"},React.createElement("div",{class:"header"},React.createElement("h4",null,"item details"),React.createElement(CancelButton,{cancel:function(){t.details_state.set(null)}})),React.createElement("div",{class:"jobitems-details-container"+(e?" expanded":"")},React.createElement(JobItem,{actions_items:t.actions_items,currency:t.currency,data:t.details_parent,details_state:t.details_state,editor_state:t.editor_state,job_id:t.job_id,product_slot_data:t.product_slot_assignments[t.details_parent.product_id.toString()],URL_GET_DATA:t.URL_GET_DATA,URL_MODULE_MANAGEMENT:t.URL_MODULE_MANAGEMENT}),t.details_parent.module_list.map(e=>React.createElement(JobItemProductUI,{key:String(e.product_id),currency:t.currency,data:t.product_slot_assignments[e.product_id.toString()]}))),React.createElement(ExpandCollapseToggle,{expanded_state:a}))])}function ExpandCollapseToggle(e){var t=e.expanded_state.get?"collapse":"expand";const a=!e.expanded_state.get;return React.createElement("button",{class:"expand-collapse "+t,onClick:function(){e.expanded_state.set(a)}},React.createElement("span",null,t))}function get_details_parent(t,e){var a;return null===t||-1===(a=e.findIndex(e=>e.ji_id===parseInt(t)))?null:e[a]}function get_details_selection_status(t,e){return null===e?null:e.ji_id===t.ji_id?SELECTED_PARENT:e.product_id===t.product_id?SELECTED_SIBLING:-1===e.module_list.findIndex(e=>e.product_id===t.product_id)?null:SELECTED_CHILD}function get_details_css_class(e){switch(e){case SELECTED_PARENT:return"details-active";case SELECTED_CHILD:return"details-child";case SELECTED_SIBLING:return"details-sibling";default:return null}}function JobItem(e){var t=get_editor_object(e.data.ji_id,e.editor_state.get,e.editor_state.set);return t.is_active?React.createElement(JobItemEditor,{data:e.data,delete_item:function(){e.actions_items.delete_f(e.data.ji_id)},editor:t,job_id:e.job_id,update_item:e.actions_items.update_f,URL_GET_DATA:e.URL_GET_DATA,URL_ITEMS:e.actions_items.url}):React.createElement(JobItemReaderUI,{currency:e.currency,data:e.data,editor:t,job_id:e.job_id,product_slot_data:e.product_slot_data,URL_MODULE_MANAGEMENT:e.URL_MODULE_MANAGEMENT})}function JobItemReaderUI(e){return[React.createElement("div",{class:"job-item-container"},React.createElement(JobItemHeadingUI,{description:e.data.description,ji_id:e.data.ji_id,part_number:e.data.part_number,product_name:e.data.product_name,quantity:e.data.quantity}),React.createElement(JobItemMoneyUI,{currency:e.currency,data:e.data,editor:e.editor}),React.createElement(JobItemAccessoriesUI,{data:e.data}),React.createElement(JobItemSpecificationUI,{data:e.data,job_id:e.job_id,URL_MODULE_MANAGEMENT:e.URL_MODULE_MANAGEMENT}),React.createElement(JobItemsProductMembers,{currency:e.currency,data:e.product_slot_data,exclude_id:e.data.ji_id,title:"Product also entered as"}),React.createElement(JobItemAssignmentsUI,{product_slot_data:e.product_slot_data}))]}function JobItemHeadingUI(e){return[React.createElement("div",{class:"subsection"},React.createElement("h5",{class:"subsection-heading what"},React.createElement(JobItemHeadingQuantitySpan,{quantity:e.quantity}),React.createElement("span",{class:"product"},e.part_number,": ",e.product_name),React.createElement(JobItemIdIcon,{ji_id:e.ji_id}),React.createElement("div",{class:"desc"},e.description)))]}function JobItemHeadingQuantitySpan(e){return null===e.quantity?null:React.createElement("span",{class:"quantity"},e.quantity," x ")}function JobItemMoneyUI(e){var t=parseFloat(e.data.selling_price);return[React.createElement("div",{class:"money subsection"},React.createElement("span",{class:"selling_price"},e.currency+nbsp()+format_money(t)),React.createElement(JobItemPriceListIconSpan,{price_list_name:e.data.price_list_name}),React.createElement("button",{class:"ji-edit edit-icon",onClick:e.editor.on},React.createElement("span",null,"edit")))]}function JobItemAccessoriesUI(e){var t;return 0==e.data.standard_accessories.length?null:(t=1<e.data.quantity?" (in total)":"",[React.createElement("div",{class:"std-accs-container subsection"},React.createElement("div",{class:"std-accs"},React.createElement("p",null,"Included accessories",t),React.createElement("ul",null,e.data.standard_accessories.map((e,t)=>React.createElement(QuantityNameLi,{key:t,name:e.product_name,quantity:e.quantity})))))])}function JobItemSpecificationUI(e){var t,a,n;return e.data.is_modular?(t=job_item_module_status_css(e.data),a=job_item_module_title_str(e.data),n=e.data.is_complete?null:"incomplete".toUpperCase(),[React.createElement("div",{class:"module-status-section subsection modules-"+t},React.createElement("div",{class:"intro-line"},React.createElement("span",{class:"display-text"},"» ",a),React.createElement(WarningMessageSpan,{message:n}),React.createElement("a",{href:e.URL_MODULE_MANAGEMENT+"#modular_jobitem_"+e.data.ji_id,class:"edit-icon"},React.createElement("span",null,"edit"))),React.createElement("ul",{class:"details"},e.data.module_list.map(e=>React.createElement(QuantityNameLi,{key:e.module_id.toString(),name:e.name,quantity:e.quantity}))))]):null}function job_item_module_status_css(e){return e.excess_modules?"excess":e.is_complete?"ok":"incomplete"}function job_item_module_status_string(e){return e.excess_modules?"special":e.is_complete?"ok":"invalid"}function job_item_module_title_str(e){var t="Specification";return e.excess_modules&&(t="Special "+t),1<e.quantity&&(t+=" (per"+nbsp()+"item)"),t}function JobItemsProductMembers(t){var e=null===t.exclude_id?t.data.members:t.data.members.filter(e=>e.ji_id!==t.exclude_id);return 0===e.length?null:React.createElement(JobItemsProductMembersUI,{currency:t.currency,members:e,title:t.title})}function JobItemsProductMembersUI(t){return[React.createElement("div",{class:"subsection product"},React.createElement("div",{class:"subsection-heading"},t.title),React.createElement("div",{class:"ji-list"},React.createElement("table",null,t.members.map(e=>React.createElement(JobItemsProductMembersRowUI,{key:e.ji_id.toString(),currency:t.currency,data:e})))))]}function JobItemsProductMembersRowUI(e){return[React.createElement("tr",null,React.createElement("td",null,React.createElement(JobItemIdIcon,{ji_id:e.data.ji_id})),React.createElement("td",{class:"desc"},e.data.quantity," for ",e.currency+nbsp()+format_money(parseFloat(e.data.selling_price))),React.createElement("td",null,React.createElement(JobItemPriceListIconSpan,{price_list_name:e.data.price_list_name})))]}function JobItemAssignmentsUI(e){return 0===e.product_slot_data.assignments.length?null:[React.createElement("div",{class:"module-status-section assignments subsection"},React.createElement("div",{class:"intro-line"},React.createElement("span",{class:"display-text"},"« Assignment"),React.createElement("div",{class:"usage-counters"},React.createElement(JobItemAssignmentsCounterUI,{display_str:"used",num:e.product_slot_data.num_assigned,total:e.product_slot_data.total_product_quantity}),React.createElement(JobItemAssignmentsCounterUI,{display_str:"unused",num:e.product_slot_data.total_product_quantity-e.product_slot_data.num_assigned,total:e.product_slot_data.total_product_quantity}))),React.createElement("ul",null,e.product_slot_data.assignments.map((e,t)=>React.createElement(JobItemAssignmentLiUI,{key:t,data:e}))))]}function JobItemAssignmentsCounterUI(e){return[React.createElement("div",{class:"assignment-icon"},React.createElement("span",{class:"label"},e.display_str),React.createElement("span",{class:"status"},e.num,"used"===e.display_str?"/"+e.total:""))]}function JobItemAssignmentLiUI(e){var t=1<e.data.parent_qty?"each ":"";return[React.createElement("li",null,e.data.quantity," ",t,"to ",e.data.parent_qty," x [",e.data.part_num,"] ",e.data.product_name,React.createElement(JobItemIdIcon,{ji_id:e.data.parent_id}))]}function slot_assignment_data_by_product(e){var t,a=initialise_products_list(e);for(t in e){var n=e[t];if(null!=n.module_list&&0<n.module_list.length)for(var c in n.module_list){var r=n.module_list[c].product_id.toString();if(!(r in a))break;c=n.module_list[c].quantity*n.quantity,c=(a[r].num_assigned+=c,{quantity:c,parent_qty:n.quantity,part_num:n.part_number,product_name:n.product_name,parent_id:n.ji_id});a[r].assignments.push(c)}}return a}function initialise_products_list(e){var t,a={};for(t in e){var n=e[t],c=n.product_id.toString();c in a||(a[c]={description:n.description,part_number:n.part_number,product_name:n.product_name,total_product_quantity:0,num_assigned:0,assignments:[],members:[]}),a[c].total_product_quantity+=parseInt(n.quantity),a[c].members.push(n)}return a}function JobItemProductUI(e){return[React.createElement("div",{class:"job-item-container product"},React.createElement(JobItemHeadingUI,{description:e.data.description,ji_id:null,part_number:e.data.part_number,product_name:e.data.product_name,quantity:null}),React.createElement(JobItemProductQuantityUI,{quantity:e.data.total_product_quantity}),React.createElement(JobItemsProductMembers,{currency:e.currency,data:e.data,exclude_id:null,title:"Entered as"}),React.createElement(JobItemAssignmentsUI,{product_slot_data:e.data}))]}function JobItemProductQuantityUI(e){return[React.createElement("div",{class:"subsection"},React.createElement("span",{class:"product-quantity"},"Total quantity: ",e.quantity))]}function JobItemsCreator(c){if(!c.editor.is_active)return null;const[n,r]=React.useState(null),[i,o]=React.useState([blank_create_jobitem_object()]);var[e,t]=React.useState(null);const s=get_backend_error_object(e,t);e={add_one:function(e){e.preventDefault(),1e3<=i.length||o([...i,blank_create_jobitem_object()])},add_multiple:function(e){if(e.preventDefault(),null!==n){for(var t=[],a=0;a<n;)t.push(blank_create_jobitem_object()),a++;o(i.concat(t)),r(null)}},num_to_add:getter_and_setter(n,function(e){(e=e.target.value)<0&&r(null),r(e)}),remove:function(a){o(i.filter((e,t)=>t!==a))},update:function(e,t){o([...i.slice(0,e),Object.assign(i[e],t),...i.slice(e+1)])}};return React.createElement(JobItemsCreatorUI,{actions_formset:e,backend_error:s,editor:c.editor,handle_submit:function(e){var t;e.preventDefault(),e=c.actions_items.url,t=getFetchHeaders("POST",function(){let e={"form-TOTAL_FORMS":""+i.length,"form-INITIAL_FORMS":"0","form-MIN_NUM_FORMS":"0","form-MAX_NUM_FORMS":"50"};for(var t in i){var a=i[t],t=`form-${t}-`;e[t+"quantity"]=a.quantity,e[t+"product"]=a.product_id,e[t+"selling_price"]=a.selling_price,e[t+"price_list"]=a.price_list_id,e[t+"job"]=c.job_id}return e}()),update_server(e,t,e=>{var t,a,n;status_is_good(e,201)?void 0!==e.id_list?(t=e.id_list,a=c.actions_items.url,n=getFetchHeaders("GET",null),t=t.join("."),a=a+"?ji_id_list="+t,update_server(a,n,e=>{status_is_good(e,200)?(c.actions_items.create_f(e.jobitems),c.editor.off()):s.set(get_error_message(e))})):s.set("Page refresh recommended."):s.set(get_error_message(e))})},input_fields:i,job_id:c.job_id,URL_GET_DATA:c.URL_GET_DATA,URL_ITEMS:c.actions_items.url})}function blank_create_jobitem_object(){return{quantity:"",product_id:"",selling_price:"",price_list_id:""}}function JobItemsCreatorUI(a){return[React.createElement("div",{id:"new_items_container",class:"form-like panel"},React.createElement("button",{id:"close_item_form_btn",class:"close",onClick:a.editor.off},React.createElement("span",null,"close")),React.createElement("h5",{class:"panel-header"},"Add New Items"),React.createElement(BackendErrorUI,{message:a.backend_error.message,turn_off_error:a.backend_error.clear}),React.createElement("form",{id:"items_form",onSubmit:a.handle_submit},React.createElement("input",{type:"hidden",name:"form-TOTAL_FORMS",value:a.input_fields.length,id:"id_form-TOTAL_FORMS"}),React.createElement("input",{type:"hidden",name:"form-INITIAL_FORMS",value:"0",id:"id_form-INITIAL_FORMS"}),React.createElement("input",{type:"hidden",name:"form-MIN_NUM_FORMS",value:"0",id:"id_form-MIN_NUM_FORMS"}),React.createElement("input",{type:"hidden",name:"form-MAX_NUM_FORMS",value:"50",id:"id_form-MAX_NUM_FORMS"}),a.input_fields.map((e,t)=>React.createElement(JobItemsCreatorRow,{key:t,form_index:t,actions_formset:a.actions_formset,data:e,job_id:a.job_id,num_forms:a.input_fields.length,URL_GET_DATA:a.URL_GET_DATA,URL_ITEMS:a.URL_ITEMS})),React.createElement("button",{id:"add_item_btn",class:"add-button",onClick:a.actions_formset.add_one},React.createElement("span",null,"add 1 more")),React.createElement("div",{class:"add-multiple"},"add ",React.createElement("input",{type:"number",id:"add_multi_items",value:a.actions_formset.num_to_add.get,onChange:a.actions_formset.num_to_add.set})," more",React.createElement("button",{id:"add_multi_items_btn",class:"button-primary",onClick:a.actions_formset.add_multiple},"ok")),React.createElement("input",{type:"submit",action:"submit",id:"items_submit_button",class:"button-primary full-width-button",value:"submit"})))]}function JobItemsCreatorRow(t){function a(e){t.actions_formset.update(t.form_index,e)}var e={quantity:getter_and_setter(t.data.quantity,function(e){a({quantity:e.target.value})}),selling_price:getter_and_setter(t.data.selling_price,function(e){a({selling_price:e.target.value})}),product_id:getter_and_setter(t.data.product_id,function(e){a({product_id:e.target.value})}),price_list_id:getter_and_setter(t.data.price_list_id,function(e){a({price_list_id:e.target.value})})};return React.createElement(JobItemsCreatorRowUI,{num_forms:t.num_forms,handle_click:function(e){e.preventDefault(),t.actions_formset.remove(t.form_index)},controlled:e,job_id:t.job_id,URL_GET_DATA:t.URL_GET_DATA,URL_ITEMS:t.URL_ITEMS,form_index:t.form_index})}function JobItemsCreatorRowUI(e){var t="form-"+e.form_index+"-",a=getFormsetFieldNames(t,"job");return[React.createElement("div",{class:"form-row panel"},React.createElement(JobItemsCreatorRowRemoveButton,{num_forms:e.num_forms,handle_click:e.handle_click}),React.createElement(JobItemSharedFormFields,{controlled:e.controlled,description:"",job_id:e.job_id,prefix:t,URL_GET_DATA:e.URL_GET_DATA,URL_ITEMS:e.URL_ITEMS}),React.createElement("input",{type:"hidden",name:a.name,value:e.job_id,id:a.id}))]}function JobItemsCreatorRowRemoveButton(e){return 1===e.num_forms?null:React.createElement("button",{class:"remove-item-btn delete-panel",onClick:e.handle_click},React.createElement("span",null,"remove"))}function JobItemEditor(n){const[c,t]=React.useState(n.data.quantity),[r,a]=React.useState(n.data.selling_price),[i,o]=React.useState(n.data.product_id),[s,l]=React.useState(n.data.price_list_id);var[e,_]=React.useState(null);const d=get_backend_error_object(e,_);e={quantity:getter_and_setter(c,function(e){t(e.target.value)}),selling_price:getter_and_setter(r,function(e){a(e.target.value)}),product_id:getter_and_setter(i,function(e){o(e.target.value)}),price_list_id:getter_and_setter(s,function(e){l(e.target.value)})};return React.createElement(JobItemEditorUI,{backend_error:d,controlled:e,description:n.data.description,editor:n.editor,handle_submit:function(e){e.preventDefault();var t=n.URL_ITEMS+"?id="+n.data.ji_id;e=getFetchHeaders("PUT",{quantity:c,selling_price:r,product:i,price_list:s}),update_server(t,e,e=>{var t,a;status_is_good(e,204)?"product_id"in(t=function(){var e={};c!=n.data.quantity&&(e.quantity=c);r!=n.data.selling_price&&(e.selling_price=r);i!=n.data.product_id&&(e.product_id=i);s!=n.data.price_list_id&&(e.price_list_id=s);return e}())||"price_list_id"in t?(a=n.URL_ITEMS+"?ji_id="+n.data.ji_id,fetch(a).then(e=>get_json_with_status(e)).then(e=>{status_is_good(e,200)?(n.update_item(n.data.ji_id,e),n.editor.off()):d.set(get_error_message(e))}).catch(e=>console.log(e))):(n.update_item(n.data.ji_id,t),n.editor.off()):d.set(get_error_message(e))})},handle_delete:function(){var e,t;e=n.URL_ITEMS+"?id="+n.data.ji_id,t=getFetchHeaders("DELETE",null),update_server(e,t,e=>{status_is_good(e,204)?(n.delete_item(n.data.ji_id),n.editor.off()):d.set(get_error_message(e))})},job_id:n.job_id,URL_GET_DATA:n.URL_GET_DATA,URL_ITEMS:n.URL_ITEMS})}function JobItemEditorUI(e){return[React.createElement("div",{id:"container_edit_item",class:"panel form-like"},React.createElement(CancelButton,{cancel:e.editor.off}),React.createElement("h5",{class:"panel-header"},"Edit Item"),React.createElement(JobItemSharedFormFields,{controlled:e.controlled,description:e.description,job_id:e.job_id,prefix:"",URL_GET_DATA:e.URL_GET_DATA,URL_ITEMS:e.URL_ITEMS}),React.createElement(BackendErrorUI,{message:e.backend_error.message,turn_off_error:e.backend_error.clear}),React.createElement(EditorControls,{delete:e.handle_delete,submit:e.handle_submit,want_delete:!0}))]}function JobItemSharedFormFields(t){const[e,a]=React.useState(t.description);return React.createElement(JobItemSharedFormFieldsUI,{controlled:t.controlled,description:e,handle_product_change:function(e){t.controlled.product_id.set(e),e=e.target.value,e=t.URL_GET_DATA+`?type=product_description&product_id=${e}&job_id=`+t.job_id,fetch(e).then(e=>e.json()).then(e=>{"desc"in e&&a(e.desc)}).catch(e=>console.log(e))},prefix:"",URL_GET_DATA:t.URL_GET_DATA})}function JobItemSharedFormFieldsUI(e){var t=getFormsetFieldNames(e.prefix,"quantity"),a=getFormsetFieldNames(e.prefix,"product"),n=getFormsetFieldNames(e.prefix,"selling_price"),c=getFormsetFieldNames(e.prefix,"price_list");return[React.createElement("div",null,React.createElement("label",{for:t.id},"Quantity"),React.createElement("input",{type:"number",name:t.name,id:t.id,value:e.controlled.quantity.get,onChange:e.controlled.quantity.set}),React.createElement("label",{for:a.id},"Item"),React.createElement(SelectBackendOptions,{api_url:e.URL_GET_DATA,get_param:"products",handle_change:e.handle_product_change,is_required:!0,select_id:a.id,select_name:a.name,selected_opt_id:e.controlled.product_id.get}),React.createElement(JobItemAutoDescUI,{description:e.description}),React.createElement("label",{for:n.id},"Selling Price"),React.createElement("input",{type:"number",name:n.name,step:"0.01",id:n.id,value:e.controlled.selling_price.get,onChange:e.controlled.selling_price.set}),React.createElement("label",{for:c.id},"Price List"),React.createElement(SelectBackendOptions,{api_url:e.URL_GET_DATA,get_param:"price_lists",handle_change:e.controlled.price_list_id.set,is_required:!0,select_id:c.id,select_name:c.name,selected_opt_id:e.controlled.price_list_id.get}))]}function JobItemAutoDescUI(e){return""===e.description||null===e.description?null:React.createElement("span",{class:"desc"},e.description)}function getFormsetFieldNames(e,t){return{name:e+t,id:"id_"+e+t}}function JobPo(e){return[React.createElement("section",{id:"job_po_section",class:"job-section"},React.createElement("h3",null,"Purchase Orders"),React.createElement(JobPoCreate,{actions_po:e.actions_po,currency:e.currency,job_id:e.job_id,URL_GET_DATA:e.URL_GET_DATA}),React.createElement(WarningSubsection,{message:"All POs should be in the same currency as the job.",show_warning:e.po_data.has_invalid_currency_po,title:"Error: Currency Mismatch"}),React.createElement(JobPoDiscrepancyUI,{currency:e.currency,data:e.po_data}),React.createElement(JobPoList,{actions_po:e.actions_po,currency:e.currency,data:e.po_data,job_id:e.job_id,URL_GET_DATA:e.URL_GET_DATA}))]}function JobPoCreate(e){var[t,a]=React.useState(null),t=get_editor_object("create_po_form",t,a);return React.createElement(JobPoAddUI,{actions_po:e.actions_po,currency:e.currency,editor:t,job_id:e.job_id,URL_GET_DATA:e.URL_GET_DATA})}function JobPoAddUI(e){return[React.createElement("div",{class:"job-po-form-container"},React.createElement(JobPoAddButtonUI,{form_visible:e.form_visible,editor:e.editor}),React.createElement(JobPoAddNew,{actions_po:e.actions_po,currency:e.currency,editor:e.editor,job_id:e.job_id,URL_GET_DATA:e.URL_GET_DATA}))]}function JobPoAddButtonUI(e){return e.editor.is_active?null:[React.createElement("button",{id:"toggle_po_form_btn",class:"add-button",onClick:e.editor.on},"New PO")]}function JobPoAddNew(a){var e;return a.editor.is_active?(e={po_id:null,currency:a.currency,date_on_po:null,date_received:null,reference:null,value:null},React.createElement(JobPoEditor,{data:e,editor:a.editor,form_id:"po_form",state_submit:function(e,t){a.actions_po.create_f(e,t)},state_delete:null,job_id:a.job_id,title:"Add PO",URL_GET_DATA:a.URL_GET_DATA})):null}function JobPoDiscrepancyUI(e){return 0===e.data.difference||0===e.data.po_list.length?null:[React.createElement("div",{class:"po-discrepancy warning subsection"},React.createElement("h4",null,"Discrepancy"),React.createElement("p",null,"Sum of PO values does not match sum of line item selling prices."),React.createElement("div",{class:"subsection"},React.createElement("h5",{class:"subsection-heading"},"Comparison: Items to PO"),React.createElement(PriceComparisonTable,{currency:e.currency,difference:e.data.difference,first_title:"PO Sum",first_value:e.data.total_po_value,second_title:"Line Items Sum",second_value:e.data.total_items_value})))]}function JobPoList(e){var t,a;return 0===e.data.po_list.length?React.createElement(EmptySectionUI,{message:"No purchase orders have been entered."}):([a,t]=React.useState(null),a=getter_and_setter(a,t),React.createElement(JobPoListUI,{po_list:e.data.po_list,actions_po:e.actions_po,currency:e.currency,editor_state:a,job_id:e.job_id,URL_GET_DATA:e.URL_GET_DATA}))}function JobPoListUI(t){return[React.createElement("div",{class:"job-po-container"},React.createElement("table",{id:"po_table",class:"banded"},React.createElement(JobPoTableHeadingUI,null),React.createElement("tbody",null,t.po_list.map(e=>React.createElement(JobPoElement,{key:e.po_id.toString(),actions_po:t.actions_po,currency:t.currency,data:e,editor_state:t.editor_state,job_id:t.job_id,URL_GET_DATA:t.URL_GET_DATA})))))]}function JobPoTableHeadingUI(e){return[React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Reference"),React.createElement("th",null,"Date on PO"),React.createElement("th",null,"Received"),React.createElement("th",null,"Value")))]}function JobPoElement(t){var e=get_editor_object(t.data.po_id,t.editor_state.get,t.editor_state.set);return e.is_active?[React.createElement("tr",null,React.createElement("td",{colspan:5},React.createElement(JobPoEditor,{data:t.data,editor:e,form_id:"po_edit_form",state_delete:function(){t.actions_po.delete_f(t.data.po_id)},state_submit:function(e){t.actions_po.update_f(t.data.po_id,e)},job_id:t.job_id,title:"Edit PO",URL_GET_DATA:t.URL_GET_DATA})))]:React.createElement(JobPoReadUI,{currency:t.currency,data:t.data,editor:e})}function JobPoReadUI(e){var t=e.data.currency===e.currency;return[React.createElement("tr",{class:t?null:"invalid"},React.createElement("td",{class:"ref"},e.data.reference),React.createElement("td",{class:"date_on_po"},e.data.date_on_po),React.createElement("td",{class:"date_received"},e.data.date_received),React.createElement("td",{class:"value"},React.createElement(InvalidIconUI,{is_valid:t,message:"job has different currency"}),React.createElement("span",{class:"display-text"},e.data.currency+nbsp()+format_money(parseFloat(e.data.value)))),React.createElement("td",{class:"edit"},React.createElement("button",{type:"button",class:"po-edit edit-icon",onClick:e.editor.on},React.createElement("span",null,"edit"))))]}function JobPoEditor(c){const[r,t]=React.useState(c.data.reference),[i,a]=React.useState(c.data.date_on_po),[o,n]=React.useState(c.data.date_received),[s,l]=React.useState(c.data.currency),[_,d]=React.useState(c.data.value);var e={reference:getter_and_setter(r,function(e){t(e.target.value)}),date_on_po:getter_and_setter(i,function(e){a(e.target.value)}),date_received:getter_and_setter(o,function(e){n(e.target.value)}),currency:getter_and_setter(s,function(e){l(e.target.value)}),po_value:getter_and_setter(_,function(e){d(e.target.value)})};const[u,m]=React.useState(""),{data:E,error:p,isLoaded:R}=useFetch(url_for_url_list(c.URL_GET_DATA));React.useEffect(()=>{set_if_ok(E,"po_url",m)},[E]);var[b,f]=React.useState(null);const g=get_backend_error_object(b,f);function I(e,t,a,n){e=getFetchHeaders(e,{reference:r,date_on_po:i,value:_,date_received:o,currency:s,job:c.job_id});update_server(a,e,e=>{status_is_good(e,t)?(n(e),c.editor.off()):g.set(get_error_message(e))})}function h(){return{reference:r,date_on_po:i,value:_,date_received:o,currency:s}}return p?React.createElement(LoadingErrorUI,{name:"form"}):R?React.createElement(JobPoEditorUI,{backend_error:g,editor:c.editor,controlled:e,form_id:c.form_id,handle_delete:function(e){e.preventDefault();var e=u+"?id="+c.data.po_id,t=getFetchHeaders("DELETE",null);update_server(e,t,e=>{status_is_good(e,204)?(c.state_delete(),c.editor.off()):g.set(get_error_message(e))})},handle_submit:function(e){e.preventDefault(),null===c.data.po_id?I("POST",201,u,e=>{var t=h();t.po_id=e.id,c.state_submit(t)}):I("PUT",204,u+"?id="+c.data.po_id,()=>{c.state_submit(h())})},title:c.title,URL_GET_DATA:c.URL_GET_DATA}):React.createElement(LoadingUI,null)}function JobPoEditorUI(e){var t="id_po_reference",a="id_date_on_po",n="id_po_date_received",c="id_po_currency",r="id_po_value";return[React.createElement("form",{class:"form-like panel",id:e.form_id},React.createElement("button",{type:"button",class:"cancel-po-form close",onClick:e.editor.off},React.createElement("span",null,"cancel")),React.createElement("h5",{class:"panel-header"},e.title),React.createElement(BackendErrorUI,{message:e.backend_error.message,turn_off_error:e.backend_error.clear}),React.createElement("label",{for:t},"Customer PO Number:"),React.createElement("input",{type:"text",name:"reference",maxlength:"50",required:"",id:t,value:e.controlled.reference.get,onChange:e.controlled.reference.set}),React.createElement("label",{for:a},"Date on PO:"),React.createElement("input",{type:"date",name:"date_on_po",required:"",id:a,value:e.controlled.date_on_po.get,onChange:e.controlled.date_on_po.set}),React.createElement("label",{for:n},"Date received:"),React.createElement("input",{type:"date",name:"date_received",required:"",id:n,value:e.controlled.date_received.get,onChange:e.controlled.date_received.set}),React.createElement("label",{for:c},"Currency:"),React.createElement(SelectBackendOptions,{select_id:c,select_name:"currency",is_required:!0,api_url:e.URL_GET_DATA,get_param:"currencies",selected_opt_id:e.controlled.currency.get,handle_change:e.controlled.currency.set}),React.createElement("label",{for:r},"Value:"),React.createElement("input",{type:"number",name:"value",step:"0.01",required:"",id:r,value:e.controlled.po_value.get,onChange:e.controlled.po_value.set}),React.createElement(EditorControls,{submit:e.handle_submit,delete:e.handle_delete,want_delete:null!==e.po_id}))]}function JobPriceCheck(e){var t=e.items_list.reduce((e,t)=>parseFloat(t.list_price_each)*parseInt(t.quantity)+e,0);return React.createElement(JobPriceCheckUI,{actions_items:e.actions_items,currency:e.currency,has_invalid_currency_po:e.has_invalid_currency_po,items_list:e.items_list,job_id:e.job_id,price_accepted_state:e.price_accepted_state,total_selling:e.total_selling,total_list:t,URL_GET_DATA:e.URL_GET_DATA})}function JobPriceCheckUI(e){let t;return t=0==e.items_list.length?React.createElement(JobPriceCheckEmptyUI,{is_empty:0==e.items_list.length}):[React.createElement(PriceAcceptanceToggle,{job_id:e.job_id,price_accepted_state:e.price_accepted_state,URL_GET_DATA:e.URL_GET_DATA}),React.createElement(WarningSubsection,{message:`The figures below assume all item selling prices are in the job currency, ${e.currency}. If a selling price is actually in a different currency, the numbers will be inaccurate.`,show_warning:e.has_invalid_currency_po,title:"Caution: PO Currency Mismatch"}),React.createElement(JobPriceCheckSummaryUI,{currency:e.currency,total_selling:e.total_selling,total_list:e.total_list}),React.createElement(JobPriceCheckDetails,{actions_items:e.actions_items,currency:e.currency,items_list:e.items_list})],[React.createElement("section",{id:"price_check_section",class:"paired-section"},React.createElement("h3",null,"Prices"),t)]}function JobPriceCheckEmptyUI(e){return e.is_empty?React.createElement(EmptySectionUI,{message:"Activates upon entering items."}):null}function PriceAcceptanceToggle(a){const[n,e]=React.useState(null),{data:t,error:c,isLoaded:r}=useFetch(url_for_url_list(a.URL_GET_DATA,a.job_id));return React.useEffect(()=>{set_if_ok(t,"price_acceptance_url",e)},[t]),c?React.createElement(LoadingErrorUI,{name:"price acceptance toggle"}):r?React.createElement(PriceAcceptanceToggleUI,{is_accepted:a.price_accepted_state.get,toggle_acceptance:function(){let t=!a.price_accepted_state.get;var e=getFetchHeaders("PUT",{new_status:t});update_server(n+"?job_id="+a.job_id,e,e=>{status_is_good(e,204)?a.price_accepted_state.set(t):alert("Error: "+get_error_message(e))})}}):React.createElement(LoadingUI,null)}function PriceAcceptanceToggleUI(e){var t=e.is_accepted?"on":"off",a=e.is_accepted?"accepted":"NOT ACCEPTED";return[React.createElement("div",{id:"price_confirmation_status"},React.createElement("div",{class:"status-indicator "+t},React.createElement("span",{class:"status-name"},"selling price is"),React.createElement("button",{id:"price_confirmation_button",onClick:e.toggle_acceptance},a)))]}function JobPriceCheckSummaryUI(e){return[React.createElement("div",{id:"price_summary",class:"subsection"},React.createElement("h4",null,"Comparison to List Price"),React.createElement(PriceComparisonTable,{currency:e.currency,difference:e.total_selling-e.total_list,first_title:"Line Items Sum",first_value:e.total_selling,second_title:"List Prices Sum",second_value:e.total_list}))]}function JobPriceCheckDetails(e){var[t,a]=React.useState(null),t=getter_and_setter(t,a);return React.createElement(JobPriceCheckDetailsUI,{actions_items:e.actions_items,currency:e.currency,items_list:e.items_list,editor_state:t})}function JobPriceCheckDetailsUI(e){return[React.createElement("div",{class:"subsection"},React.createElement("h4",null,"Details"),React.createElement("table",{id:"price_check_table",class:"banded"},React.createElement(JobPriceCheckDetailsTableHeadUI,{currency:e.currency}),React.createElement(JobPriceCheckDetailsTableBodyUI,{actions_items:e.actions_items,active_edit:e.active_edit,items_list:e.items_list,editor_state:e.editor_state})))]}function JobPriceCheckDetailsTableHeadUI(e){return[React.createElement("thead",null,React.createElement("tr",{class:"upper-h-row"},React.createElement("th",{colspan:4}),React.createElement("th",{colspan:4},"vs. Price List (",e.currency,")"),React.createElement("th",{colspan:4},"vs. Resale (",e.currency,")")),React.createElement("tr",{class:"lower-h-row"},React.createElement("th",null,"id"),React.createElement("th",null,"part #"),React.createElement("th",null,"qty"),React.createElement("th",null,"sold @"),React.createElement("th",null,"version"),React.createElement("th",null,"expected"),React.createElement("th",{colspan:2},"difference"),React.createElement("th",null,"discount"),React.createElement("th",null,"expected"),React.createElement("th",{colspan:2},"difference")))]}function JobPriceCheckDetailsTableBodyUI(t){return[React.createElement("tbody",null,t.items_list.map(e=>React.createElement(JobPriceCheckDetailsTableRow,{key:e.ji_id.toString(),actions_items:t.actions_items,active_edit:t.active_edit,data:e,editor_state:t.editor_state})))]}function JobPriceCheckDetailsTableRow(t){var e=get_editor_object(t.data.ji_id,t.editor_state.get,t.editor_state.set);var a,n,c,r,i=t.actions_items.url+"?id="+t.data.ji_id;return React.createElement(JobPriceCheckDetailsRowUI,{calc:(a=parseFloat(t.data.selling_price),n=parseFloat(t.data.list_price_each)*parseInt(t.data.quantity),c=a-n,r=(e=>{e=1-parseFloat(e)/100;return n*e})(t.data.resale_perc),{selling_price:a,list_price:n,difference_list:c,resale_price:r,difference_resale:a-r}),data:t.data,editor:e,update_item:function(e){t.actions_items.update_f(t.data.ji_id,e)},url_with_id:i})}function JobPriceCheckDetailsRowUI(e){return[React.createElement("tr",{id:"price_check_row_"+e.data.ji_id},React.createElement("td",{class:"ji_id"},React.createElement(JobItemIdIcon,{ji_id:e.data.ji_id})),React.createElement(JobPriceCheckDetailsDescription,{data:e.data}),React.createElement("td",{class:"qty"},e.data.quantity),React.createElement(JobPriceCheckDetailsSellingPrice,{calc:e.calc,data:e.data,editor:e.editor,update_item:e.update_item,url_with_id:e.url_with_id}),React.createElement("td",{class:"version"},React.createElement(JobItemPriceListIconSpan,{price_list_name:e.data.price_list_name})),React.createElement("td",{class:"list-price"},format_money(e.calc.list_price)),React.createElement("td",{class:"list-diff-val"},format_money(e.calc.difference_list)),React.createElement("td",{class:"list-diff-perc"},format_percentage(e.calc.difference_list/e.calc.list_price*100,2)),React.createElement("td",{class:"resale-percentage"},React.createElement(JobItemNameTagSpan,{name:format_percentage(parseFloat(e.data.resale_perc))})),React.createElement("td",{class:"resale-price"},format_money(e.calc.resale_price)),React.createElement("td",{class:"resale-diff-val"},format_money(e.calc.difference_resale)),React.createElement("td",{class:"resale-diff-perc"},format_percentage(e.calc.difference_resale/e.calc.resale_price*100,2)))]}function JobPriceCheckDetailsDescription(e){const[t,a]=React.useState(!1);return React.createElement(JobPriceCheckDetailsDescriptionUI,{data:e.data,toggle_name:function(){var e=!t;a(e)},name_is_visible:t})}function JobPriceCheckDetailsDescriptionUI(e){return[React.createElement("td",{class:"description"},React.createElement("span",{class:"details-toggle",onClick:e.toggle_name},e.data.part_number),React.createElement(JobPriceCheckProductNameSpanUI,{product_name:e.data.product_name,is_visible:e.name_is_visible}))]}function JobPriceCheckProductNameSpanUI(e){return e.is_visible?React.createElement("span",{class:"details"},e.product_name):null}function JobPriceCheckDetailsSellingPrice(e){var[t,a]=React.useState(null),t=get_backend_error_object(t,a);return React.createElement(JobPriceCheckDetailsSellingPriceUI,{backend_error:t,calc:e.calc,data:e.data,editor:e.editor,update_item:e.update_item,url_with_id:e.url_with_id})}function JobPriceCheckDetailsSellingPriceUI(e){return[React.createElement("td",{class:"selling-price-container"},React.createElement(BackendErrorUI,{message:e.backend_error.message,turn_off_error:e.backend_error.clear}),React.createElement("span",{class:"selling-price"},format_money(e.calc.selling_price)),React.createElement(JobPriceCheckEditButtonUI,{editor:e.editor}),React.createElement(JobPriceCheckPriceEditor,{editor:e.editor,calc:e.calc,data:e.data,update_item:e.update_item,url_with_id:e.url_with_id,backend_error:e.backend_error}))]}function JobPriceCheckEditButtonUI(e){return null!==e.editor.active_id?null:React.createElement("button",{class:"edit-btn edit-icon",onClick:e.editor.on},React.createElement("span",null,"edit"))}function JobPriceCheckPriceEditor(a){return a.editor.is_active?React.createElement(JobPriceCheckPriceEditorUI,{calc:a.calc,cancel:a.editor.off,data:a.data,handle_list_click:function(){e(a.calc.list_price)},handle_resale_click:function(){e(a.calc.resale_price)},update_price:e}):null;function e(e){const t={selling_price:e};e=getFetchHeaders("PUT",t);update_server(a.url_with_id,e,e=>{status_is_good(e,204)?a.update_item(t):a.backend_error.set(get_error_message(e)),a.editor.off()})}}function JobPriceCheckPriceEditorUI(e){return[React.createElement("div",{class:"price-checker-edit-window form-like panel popout"},React.createElement(CancelButton,{cancel:e.cancel}),React.createElement("h5",{class:"panel-header"},"Edit Price"),React.createElement("p",null,e.data.quantity," x [",e.data.part_number,"] ",e.data.product_name),React.createElement("div",{class:"price-options-container"},React.createElement("h6",null,"Click new price"),React.createElement(PresetPriceButtonUI,{handle_click:e.handle_list_click,price_preset:e.calc.list_price,price_type:"list"}),React.createElement(PresetPriceButtonUI,{handle_click:e.handle_resale_click,price_preset:e.calc.resale_price,price_type:"resale"})),React.createElement(ManualPriceInput,{handle_submit:e.update_price}))]}function PresetPriceButtonUI(e){return React.createElement("button",{class:"button-primary-hollow",onClick:e.handle_click},e.price_type," (",format_money(parseFloat(e.price_preset)),")")}function ManualPriceInput(e){const[t,a]=React.useState("");return React.createElement(ManualPriceInputUI,{custom_price:t,handle_change:function(e){a(e.target.value)},handle_submit:function(){e.handle_submit(t)}})}function ManualPriceInputUI(e){return[React.createElement("div",{class:"combo-input-and-button"},React.createElement("span",null,"Or enter your own and submit"),React.createElement("input",{type:"number",step:.01,name:"new_price",value:e.custom_price,onChange:e.handle_change}),React.createElement(SubmitButton,{submit:e.handle_submit}))]}function JobPage(){const a=window.JOB_ID,n=window.URL_GET_DATA,[c,e]=React.useState({currency:"",doc_quantities:[],URL_MODULE_MANAGEMENT:""}),[t,r]=React.useState(""),[i,o]=React.useState(""),[s,l]=React.useState([]),[_,d]=React.useState([]),[u,m]=React.useState([]),[E,p]=React.useState(!1),{data:R,error:b,isLoaded:f}=useFetch(url_for_page_load(n,a,"job_page_root"));function g(e,t){null!==t&&!item_quantity_has_changed(s,e,t)||fetch(url_for_page_load(n,a,"documents")).then(e=>e.json()).then(e=>{set_if_ok(e,"doc_list",m)}).catch(e=>console.log(e))}React.useEffect(()=>{set_if_ok(R,"item_list",l),set_if_ok(R,"po_list",d),set_if_ok(R,"doc_list",m),set_if_ok(R,"price_accepted",p),set_if_ok(R,"main",e),set_if_ok(R,"items_url",r),set_if_ok(R,"docbuilder_url",o)},[R]);var I=s.reduce((e,t)=>parseInt(t.quantity)+e,0),h=_.reduce((e,t)=>t.currency==c.currency?parseFloat(t.value)+e:e,0),U=s.reduce((e,t)=>parseFloat(t.selling_price)+e,0),T=h-U,v=invalid_currency_po_exists(_,c.currency),y=get_status_data_object(E,_.length,T,c.doc_quantities,I,s,u,v),T=get_po_data_object(T,U,h,_,v),h=get_documents_data_object(i,u,c.doc_quantities,I),I=get_actions_object(t,function(e){e=s.concat(e),l(e)},function(e,t){g(e,t),update_list_state(s,l,"ji_id",e,t)},function(e){g(e,null),remove_from_list_state(s,l,"ji_id",e)}),A=get_actions_object(null,function(e){add_to_list_state(d,e)},function(e,t){update_list_state(_,d,"po_id",e,t)},function(e){remove_from_list_state(_,d,"po_id",e)}),D=getter_and_setter(E,p);return React.createElement(JobPageUI,{actions_items:I,actions_po:A,currency:c.currency,data:R,doc_data:h,error:b,has_invalid_currency_po:v,isLoaded:f,items_list:s,job_id:a,po_data:T,po_list:_,price_accepted_state:D,status_data:y,total_selling:U,URL_GET_DATA:n,URL_MODULE_MANAGEMENT:c.URL_MODULE_MANAGEMENT})}function JobPageUI(e){return e.error||e.isLoaded&&e.data,[React.createElement("div",null,React.createElement(JobHeadingSubsectionUI,{job_id:e.job_id,status_data:e.status_data,URL_GET_DATA:e.URL_GET_DATA}),React.createElement(JobContentsUI,{actions_items:e.actions_items,actions_po:e.actions_po,currency:e.currency,doc_data:e.doc_data,has_invalid_currency_po:e.has_invalid_currency_po,items_list:e.items_list,job_id:e.job_id,po_data:e.po_data,po_list:e.po_list,price_accepted_state:e.price_accepted_state,total_selling:e.total_selling,URL_GET_DATA:e.URL_GET_DATA,URL_MODULE_MANAGEMENT:e.URL_MODULE_MANAGEMENT}))]}function JobContentsUI(e){return[React.createElement("div",{class:"job-page-sections-wrapper"},React.createElement(JobDetails,{currency:e.currency,job_id:e.job_id,URL_GET_DATA:e.URL_GET_DATA}),React.createElement(JobComments,{job_id:e.job_id,URL_GET_DATA:e.URL_GET_DATA}),React.createElement(JobDocumentsUI,{doc_data:e.doc_data,job_id:e.job_id}),React.createElement(JobPo,{actions_po:e.actions_po,currency:e.currency,job_id:e.job_id,po_data:e.po_data,URL_GET_DATA:e.URL_GET_DATA}),React.createElement(JobItems,{actions_items:e.actions_items,currency:e.currency,items_list:e.items_list,job_id:e.job_id,URL_GET_DATA:e.URL_GET_DATA,URL_MODULE_MANAGEMENT:e.URL_MODULE_MANAGEMENT}),React.createElement(JobPriceCheck,{actions_items:e.actions_items,currency:e.currency,has_invalid_currency_po:e.has_invalid_currency_po,items_list:e.items_list,job_id:e.job_id,price_accepted_state:e.price_accepted_state,total_selling:e.total_selling,URL_GET_DATA:e.URL_GET_DATA}))]}function get_status_data_object(e,t,a,n,c,r,i,o){return{price_accepted:e,po_count:t,value_difference_po_vs_items:a,doc_quantities:n,total_qty_all_items:c,items_list:r,doc_list:i,has_invalid_currency_po:o}}function get_po_data_object(e,t,a,n,c){return{difference:e,total_items_value:t,total_po_value:a,po_list:n,has_invalid_currency_po:c}}function get_documents_data_object(e,t,a,n){return{URL_DOCS:e,doc_list:t,doc_quantities:a,total_quantity_items:n}}function item_quantity_has_changed(e,t,a){var n;return"quantity"in a&&(!("ji_id"in a)||(a=a.quantity,-1===(n=e.findIndex(e=>e.ji_id===parseInt(t)))||(e=e[n].quantity,parseInt(e)!==parseInt(a))))}function invalid_currency_po_exists(t,a){for(let e=0;e<t.length;e++)if(t[e].currency!==a)return!0;return!1}ReactDOM.render(React.createElement(JobPage,null),document.querySelector(".job-page"));