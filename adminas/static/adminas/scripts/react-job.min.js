function nbsp(){return" "}function capitaliseFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function format_money(e){return isNaN(e)?"-":e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}function format_percentage(e,t=0){return isNaN(e)?"-%":e.toLocaleString(void 0,{minimumFractionDigits:t,maximumFractionDigits:2})+"%"}function format_timestamp(e){const t=new Date(e);return`${t.getFullYear()}-${t.getMonth().toString().padStart(2,"0")}-`+t.getDate().toString().padStart(2,"0")}function getter_and_setter(e,t){return{get:e,set:t}}function url_for_page_load(e,t){return window.URL_GET_DATA+`?job_id=${e}&type=page_load&name=`+t}function url_for_url_list(){return`${window.URL_GET_DATA}?job_id=${window.JOB_ID}&type=urls`}function url_for_product_description(e,t){return window.URL_GET_DATA+`?type=product_description&product_id=${e}&job_id=`+t}function url_for_select_options(e){return window.URL_GET_DATA+"?type=select_options_list&name="+e}const useFetchWithLoading=e=>{const[t,a]=React.useState([]),[n,c]=React.useState(null),[r,o]=React.useState(!1);return React.useEffect(()=>{(async()=>{await fetch(e).then(e=>get_json_with_status(e)).then(e=>{status_is_good(e)||c(get_error_message(e)),a(e),o(!0)}).catch(e=>{c(e),o(!0)})})()},[e]),{data:t,error:n,isLoaded:r}};async function fetchAndJSON(e,t,a){e=await fetch(e,t),t=await get_json_with_status(e);if(status_is_good(t,a))return t;throw new Error(get_error_message(t))}function set_if_ok(e,t,a){return void 0!==e[t]&&(a(e[t]),!0)}function getUpdatedObjectFromList(e,t,a,n,c){var r=t.findIndex(e=>e[a]===n);if(-1===r)throw Error(`Unrecognised ${e} cannot be edited`);return{...t[r],...c}}function getUpdatedList(e,t,a,n){return e.map(e=>e[t]===a?n:e)}function useAsyncWithError(t){const a=useErrorWithClear();return{asyncError:a,handleAsync:async function(e){try{!0===await e()&&t()}catch(e){a.set(e)}}}}function useComments(n,c,r){const o="comments",[i,e]=React.useState(""),t=useFetchWithLoading(url_for_url_list())["data"];return React.useEffect(()=>{set_if_ok(t,"api_comments",e)},[t]),{create:async function(e,t){return""===i?(r("Creation of comments is not currently available, sorry!"),!1):(t=await fetchAndJSON(i+"?job_id="+window.JOB_ID,getRequestOptions("POST",t),201),e={...e,id:t.id,user_is_owner:!0,created_by:"You",created_on:t.created_on,created_on_str:t.created_on_str},c(o,n?[...n,e]:[e]),!0)},update:async function(e,t,a){return""===i?(r("Editing comments is not currently available, sorry!"),!1):(await fetchAndJSON(i+"?id="+e,getRequestOptions("PUT",a),204),a=getUpdatedObjectFromList("comment",n,"id",e,t),c(o,getUpdatedList(n,"id",e,a)),!0)},remove:async function(t){return""===i?(r("Deleting comments is not currently available, sorry!"),!1):(await fetchAndJSON(i+"?id="+t,getRequestOptions("DELETE",null),204),c(o,n.filter(e=>e.id!==t)),!0)}}}function useEditor(){const[t,a]=React.useState(null);function n(){return null!==t}return{open:function(e){if(n())throw new Error("Close the existing editor before opening a new one.");a(e)},close:function(){a(null)},isOpen:n,isOpenedBy:function(e){return n()&&e===t}}}function useJobItems(a,n,c,r){const o="itemsList",i="ji_id",[l,e]=React.useState(""),t=useFetchWithLoading(url_for_url_list())["data"];function s(e,t){t=getUpdatedObjectFromList("item",a,i,e,t);n(o,getUpdatedList(a,i,e,t))}function m(e,t){null!==t&&!function(e,t,a){if(!("quantity"in a))return;if(!("ji_id"in a))return 1;a=a.quantity;var n=e.findIndex(e=>e.ji_id===parseInt(t));if(-1===n)return 1;e=e[n].quantity;return parseInt(e)!==parseInt(a)}(a,e,t)||fetch(url_for_page_load(c,"documents")).then(e=>e.json()).then(e=>{if(void 0===e.doc_list)throw Error("Document status failed to update on screen and is unreliable. Try refreshing the page.");n("docList",e.doc_list)})}return React.useEffect(()=>{set_if_ok(t,"api_items",e)},[t]),{create:async function(e){if(""===l)return r("Creating items is not currently available, sorry!"),!1;var t,e=getRequestOptions("POST",e);if(void 0===(e=await fetchAndJSON(l,e,201)).id_list)throw new Error("Page refresh recommended.");return e=(e=e.id_list).join("."),e=l+"?ji_id_list="+e,t=getRequestOptions("GET",null),e=await fetchAndJSON(e,t,200),t=a.concat(e.jobitems),await!n(o,t),!0},update:async function(e,t,a){return""===l?(r("Updating items is not currently available, sorry!"),!1):(await fetchAndJSON(l+"?id="+e,getRequestOptions("PUT",a),204),"product_id"in t||"price_list_id"in t?await async function(e){if(""===l)return r("Creating items is not currently available, sorry!"),!1;const t=l+"?ji_id="+e,a=await fetchAndJSON(t,null,200);return delete a.http_code,delete a.location,s(e,a),!0}(e):s(e,t),m(e,t),!0)},remove:async function(t){return""===l?(r("Deletion of items is not currently available, sorry!"),!1):(await fetchAndJSON(l+"?id="+t,getRequestOptions("DELETE",null),204),m(t,null),n(o,a.filter(e=>e[i]!==t)),!0)}}}function useJobState(){var e=window.JOB_ID;const t={id:e,itemsList:[],poList:[],docList:[],priceAccepted:[],currency:"",timestamp:null,doc_quantities:[],URL_MODULE_MANAGEMENT:"",URL_ITEMS:"",URL_DOCS:"",API_COMMENTS:"",comments:[],names:{customer_via_agent:"",customer:"",job:""}},[n,c]=React.useState(t),{data:a,error:r,isLoaded:o}=useFetchWithLoading(url_for_page_load(e,"job_page_root"));function i(e,t,a){return void 0!==e[t]?e[t]:a}return React.useEffect(()=>{var e={id:window.JOB_ID,itemsList:i(a,"item_list",t.itemsList),poList:i(a,"po_list",t.poList),docList:i(a,"doc_list",t.docList),priceAccepted:i(a,"price_accepted",t.priceAccepted),currency:i(a,"currency",t.currency),timestamp:i(a,"timestamp",t.timestamp),doc_quantities:i(a,"doc_quantities",t.doc_quantities),URL_MODULE_MANAGEMENT:i(a,"URL_MODULE_MANAGEMENT",t.URL_MODULE_MANAGEMENT),URL_ITEMS:i(a,"items_url",t.URL_ITEMS),URL_DOCS:i(a,"docbuilder_url",t.URL_DOCS),API_COMMENTS:i(a,"comments_api",t.API_COMMENTS),comments:i(a,"comments",t.comments),names:i(a,"names",t.names)};c(e)},[a]),{job:n,updateKey:function(t,a){if(!(t in n))throw Error("Failed to update Job");c(e=>({...e,[t]:a}))},fetchProps:{data:a,error:r,isLoaded:o}}}function useJobStateUpdater(e,a,n){const c="jobState_update_error",{message:t,set:r,clear:o}=useErrorWithClear();function i(t,e){try{a(t,e)}catch(e){t=e,r(t),n.open(c)}}return{comments:useComments(e.comments,i,r),jobItems:useJobItems(e.itemsList,i,e.id,r),po:usePOs(e.poList,i,r),priceAccepted:usePriceAcceptanceToggle(e.priceAccepted,i,e.id),errors:{clear:function(){n.close(),o()},message:t,showError:n.isOpenedBy(c)}}}function usePOs(n,c,r){const o="poList",i="po_id",[l,e]=React.useState(""),t=useFetchWithLoading(url_for_url_list())["data"];return React.useEffect(()=>{set_if_ok(t,"api_po",e)},[t]),{create:async function(e,t){if(""===l)return r("Creation of POs is not currently available, sorry!"),!1;t=getRequestOptions("POST",t),t=await fetchAndJSON(l,t,201);const a=e;return a.po_id=t.id,c(o,[...n,a]),!0},update:async function(e,t,a){return""===l?(r("Updating POs is not currently available, sorry!"),!1):(await fetchAndJSON(l+"?id="+e,getRequestOptions("PUT",a),204),a=getUpdatedObjectFromList("PO",n,i,e,t),c(o,getUpdatedList(n,i,e,a)),!0)},remove:async function(t){return""===l?(r("Deleting POs is not currently available, sorry!"),!1):(await fetchAndJSON(l+"?id="+t,getRequestOptions("DELETE",null),204),c(o,n.filter(e=>e[i]!==t)),!0)}}}function useSortByDate(){const a=[{id:"newestFirst",displayStr:"Newest first",f:(e,t)=>t-e},{id:"oldestFirst",displayStr:"Oldest first",f:(e,t)=>e-t}],[e,n]=React.useState(0);return{activeID:a[e].id,activeSortByDate:a[e].f,options:a,update:function(t){var e=a.findIndex(e=>e.id===t);-1!==e&&n(e)},heading:a[e].displayStr}}function AddButton({css:e,disabled:t,label:a,onClick:n}){return React.createElement("button",{class:"add-button"+(" "+e??""),onClick:n,disabled:t??!1},a)}function CancelButton({css:e,cancel:t}){return React.createElement("button",{className:"close"+(void 0===e?"":" "+e),onClick:t},React.createElement("span",null,"close"))}function EditorControls({bemClass:e,handleDelete:t,handleSubmit:a,wantDelete:n}){return[React.createElement("div",{className:"controls formControls"+(void 0===e?"":" "+e)},React.createElement(SubmitButton,{submit:a,cssClasses:"formControls_submit"}),React.createElement(DeleteButton,{handleDelete:t,user_has_permission:n}))]}function DeleteButton({handleDelete:e,user_has_permission:t}){return t?React.createElement("button",{type:"button",class:"button-warning delete-btn formControls_button",onClick:e},"delete"):null}function SubmitButton({submit:e,cssClasses:t}){return React.createElement("button",{className:"button-primary "+(t??""),onClick:e},"submit")}function FormLabel(e){return React.createElement("label",{for:e.inputID,className:"formy_label"},e.children)}function LabelFieldContainer({children:e}){return React.createElement("div",{className:"formy_labelFieldContainer"},e)}function JobItemIdIcon({ji_id:e}){return React.createElement(JobItemNameTagSpan,{css:"id",name:e})}function JobItemPriceListIconSpan({price_list_name:e}){return React.createElement(JobItemNameTagSpan,{name:e??"TBC"})}function JobItemNameTagSpan({css:e,name:t}){return null===t?null:React.createElement("span",{class:"name-tag"+(e?" "+e:"")},t)}function JobStatusStrip({statusData:e}){const a=jobStatusHelper(),t=a.getStatuses(e);return[React.createElement("div",{class:"jobSummaryStatus_container"},t.map((e,t)=>React.createElement(JobStatusElementUI,{key:t,message:e[1],statusCode:e[0],symbol:a.getSymbol(e[0])})))]}function JobStatusElementUI({message:e,statusCode:t,symbol:a}){return[React.createElement("div",{class:"status-ele "+t},React.createElement("span",{class:"icon"},a),React.createElement("span",{class:"message"},e))]}function jobStatusHelper(){const o="status_ok",i="status_action",c="status_attn";return{getSymbol:function(e){return e===o?"ok":e===c?"!":e===i?"?":"-"},getStatuses:function(e){var t,a,n=[];return n=(n=(n=(n=(n=n.concat(function(e){if(e.price_accepted)return[[o,"Price accepted"]];return[[i,"Price not accepted"]]}(e))).concat((a=[],0==(t=e).total_qty_all_items?a.push([i,"No items"]):(t.items_list.some(e=>!0===e.excess_modules)&&a.push([c,"Special item/s"]),t.items_list.some(e=>!0===e.is_modular&&!1===e.is_complete)?a.push([i,"Item/s incomplete"]):a.push([o,"Items ok"])),a))).concat(function(e){{if(0==e.po_count)return[[i,"PO missing"]];if(!0===e.has_invalid_currency_po)return[[i,"PO currency mismatch"]];if(0!=e.value_difference_po_vs_items)return[[i,"PO discrepancy"]]}return[[o,"PO ok"]]}(e))).concat(function(e){var t,a=[];for(t in e.doc_quantities){var n=e.doc_quantities[t],c=n.doc_type+" ",r=parseInt(n.qty_on_issued),n=parseInt(n.qty_on_draft);0<r&&e.total_qty_all_items==r?a.push([o,c+"ok"]):0<r+n&&e.total_qty_all_items==r+n?a.push([i,c+"pending"]):a.push([i,c+"needed"])}return a}(e))).concat(function(e){let t={},a=[];for(var n in e.doc_list){var n=e.doc_list[n],c=n.doc_type;c in t||n.is_valid||(t[c]=1,a.push([i,"Invalid "+c]))}return a}(e))}}}function LoadingUI(){return React.createElement("div",{class:"loading"},"Loading...")}function LoadingErrorUI({name:e}){return React.createElement("div",{class:"loading error"},"Error loading ",e??"content")}function EmptySectionUI({css:e,message:t}){return React.createElement("p",{className:"empty-section-notice"+(void 0!==e?" "+e:"")},t??"There's nothing to display here")}function Modal({children:e,close:t}){const a=React.useRef();return React.useLayoutEffect(()=>{a.current.show()},[]),React.createElement("div",{className:"modalWrapper"},React.createElement("dialog",{className:"modal",ref:a},React.createElement("button",{className:"modal_closeButton close",onClick:()=>{a.current.close(),t()}},React.createElement("span",null,"close")),e))}function PriceComparisonTable(e){let t=0;return 0!==e.second_value&&(t=e.difference/e.second_value*100),React.createElement(PriceComparisonTableUI,{currency:e.currency,difference:e.difference,difference_as_perc:t,first_title:e.first_title,first_value:e.first_value,second_title:e.second_title,second_value:e.second_value})}function PriceComparisonTableUI(e){return[React.createElement("table",{id:"po-discrepancy",class:"price-comparison"},React.createElement("tr",null,React.createElement("th",null,e.first_title),React.createElement("td",null,e.currency),React.createElement("td",{class:"po-total-price-f number"},format_money(e.first_value)),React.createElement("td",null)),React.createElement("tr",null,React.createElement("th",null,e.second_title),React.createElement("td",null,e.currency),React.createElement("td",{class:"selling-price number"},format_money(e.second_value)),React.createElement("td",null)),React.createElement("tr",{class:"conclusion"},React.createElement("th",null,"Difference"),React.createElement("td",null,e.currency),React.createElement("td",{class:"diff-val number"},format_money(e.difference)),React.createElement("td",null,React.createElement("span",{class:"diff-perc"},format_percentage(e.difference_as_perc)))))]}function QuantityNameLi(e){return[React.createElement("li",null,e.quantity," x ",e.name)]}function SelectBackendOptions({cssClasses:e,get_param:t,handle_change:a,is_required:n,select_id:c,select_name:r,selected_opt_id:o}){t=url_for_select_options(t);const{data:i,error:l,isLoaded:s}=useFetchWithLoading(t);return l?React.createElement(LoadingErrorUI,{name:"dropdown"}):s&&void 0!==i.opt_list?React.createElement(SelectWrapper,{cssClasses:e,data:i,handle_change:a,is_required:n,select_id:c,select_name:r,selected_opt_id:o},React.createElement(OptionEmptyDefaultUI,null),i.opt_list.map(e=>React.createElement(OptionIdAndNameUI,{key:e.id.toString(),value:e.id,name:e.display_str}))):React.createElement(LoadingUI,null)}function SelectWrapper({cssClasses:e,handle_change:t,is_required:a,select_id:n,select_name:c,selected_opt_id:r,children:o}){return React.createElement("select",{className:"formy_select"+(void 0===e?"":" "+e),name:c,id:n,required:a,onChange:t,value:r??""},o)}function OptionEmptyDefaultUI(){return React.createElement("option",{value:""},"---------")}function OptionIdAndNameUI({name:e,value:t}){return React.createElement("option",{value:t},e)}function InvalidIconUI({message:e}){return React.createElement("div",{class:"invalid-icon"},React.createElement("span",null,e))}function WarningSubsection({css:e,message:t,show_warning:a,title:n}){return a?[React.createElement("div",{className:"warning subsection"+(void 0!==e?" "+e:"")},React.createElement("h4",null,n??"Warning"),React.createElement("p",null,t))]:null}function WarningSubSubsectionUI({css:e,message:t,title:a,children:n}){return[React.createElement("div",{className:"warningSubSubsection"+(void 0!==e?" "+e:"")},React.createElement("h4",{className:"warningSubSubsection_heading"},React.createElement("img",{src:window.PATH_IMAGES+"i-warning.svg",height:"18px","aria-hidden":"true"}),a||"Warning"),React.createElement("p",{className:"warningSubSubsection_text"},t),void 0===n?null:n)]}function useCommentReaderToggles(t,a){const n=useAsyncWithError();function e(e){n.handleAsync(()=>t.update(a.id,e,e))}return{backend_error:n.asyncError,toggle_highlighted:function(){e({highlighted:!a.highlighted})},toggle_pinned:function(){e({pinned:!a.pinned})}}}function CommentsWrapper({actions:t,comments:e,css:a,emptyMessage:n,heading:c,modalKit:r,wantCollapsable:o}){return[React.createElement("section",{className:"subsection jobCommentSection"+(void 0!==a?" "+a:"")},React.createElement("h4",null,c),React.createElement("div",{className:"subsection_contentWrapper commentContainer"},null==e||0===e.length?React.createElement(EmptySectionUI,{css:"commentSection_empty",message:n??"No comments on this job"}):e.map(e=>React.createElement(Comment,{key:e.id.toString(),actions:t,comment:e,modalKit:r,wantCollapsable:o}))))]}function Comment({actions:e,comment:t,modalKit:a,wantCollapsable:n}){const c="job_comment_edit_"+t.id;return React.createElement(React.Fragment,null,a.isOpenedBy(c)?React.createElement(CommentEditor,{actions:e,closeFn:a.close,comment:t,title:"Edit Comment"}):null,React.createElement(CommentReader,{actions:e,comment:t,commentEditorIsUnavailable:a.isOpen(),openCommentEditor:()=>a.open(c),wantCollapsable:n}))}function CommentReader({actions:e,comment:t,commentEditorIsUnavailable:a,openCommentEditor:n,wantCollapsable:c}){var r="one-comment",o=(r=(r+=t.private?" private":" public")+(t.highlighted?" highlighted":""),c?"details":"div");return React.createElement("article",{class:r},React.createElement(o,{class:"wrapper"},React.createElement(c?"summary":"section",{class:"comment-body"},React.createElement(CommentReaderBodyUI,{comment:t})),React.createElement(CommentReaderFooter,{actions:e,comment:t,commentEditorIsUnavailable:a,openCommentEditor:n})))}function CommentReaderBodyUI({comment:e}){var t=e.user_is_owner&&e.private?{css:"privacy-status",srStr:"PRIVATE"}:{css:"public-status",srStr:"public"};return[React.createElement("span",{class:"main"},React.createElement("div",{class:t.css},"[",t.srStr,"]"),React.createElement(CommentContentsWithLinebreaks,{text:e.contents}))]}function CommentContentsWithLinebreaks({text:e}){return e=e.includes("\n")?e.split("\n").map(e=>React.createElement("span",null,e,React.createElement("br",null))):React.createElement("p",null,e),[React.createElement("span",{class:"contents"},e)]}function CommentReaderFooter({actions:e,comment:t,commentEditorIsUnavailable:a,openCommentEditor:n}){var{backend_error:e,toggle_highlighted:c,toggle_pinned:r}=useCommentReaderToggles(e,t);return React.createElement(CommentReaderFooterUI,{backendError:e,comment:t,commentEditorIsUnavailable:a,openCommentEditor:n,togglePinned:r,toggleHighlighted:c})}function CommentReaderFooterUI({backendError:e,comment:t,commentEditorIsUnavailable:a,openCommentEditor:n,togglePinned:c,toggleHighlighted:r}){return[React.createElement("section",{class:"footer"},React.createElement("div",{class:"ownership"},t.created_by," on ",t.created_on_str),React.createElement("div",{class:"controls"},e.message?React.createElement(ErrorWithClearUI,{message:e.message,close:e.clear}):null,React.createElement(CommentPinnedButtonUI,{handle_toggle:c,pinned:t.pinned}),React.createElement(CommentHighlightButtonUI,{handle_toggle:r}),t.user_is_owner?React.createElement(CommentEditButtonUI,{commentEditorIsUnavailable:a,openCommentEditor:n}):null))]}function CommentPinnedButtonUI({pinned:e,handle_toggle:t}){return React.createElement("button",{class:"pinned-toggle pin-"+(e?"on":"off"),onClick:t},e?"unpin":"pin")}function CommentHighlightButtonUI({handle_toggle:e}){return React.createElement("button",{class:"highlighted-toggle",onClick:e},"+/- highlight")}function CommentEditButtonUI({commentEditorIsUnavailable:e,openCommentEditor:t}){return React.createElement("button",{class:"edit-comment",disabled:e,onClick:t},"edit")}function useCommentEditor(e,t,a){const[n,c]=React.useState(a.contents),[r,o]=React.useState(a.private),[i,l]=React.useState(a.pinned),[s,m]=React.useState(a.highlighted);var d={contents:getter_and_setter(n,function(e){c(e.target.value)}),private:getter_and_setter(r,function(e){o(e.target.checked)}),pinned:getter_and_setter(i,function(e){l(e.target.checked)}),highlighted:getter_and_setter(s,function(e){m(e.target.checked)})};const u=useAsyncWithError(t);function _(){return{contents:n,private:r,pinned:i,highlighted:s}}return{backend_error:u.asyncError,controlled:d,handle_delete:function(){u.handleAsync(()=>e.remove(a.id))},handle_submit:function(){void 0===a.id||0===a.id||"0"===a.id?u.handleAsync(()=>e.create(_(),_())):u.handleAsync(()=>e.update(a.id,_(),_()))}}}function CommentEditor({actions:e,comment:t,closeFn:a,title:n}){const{backend_error:c,controlled:r,handle_delete:o,handle_submit:i}=useCommentEditor(e,a,t);return[React.createElement(Modal,{close:a},React.createElement("div",{class:"commentEditor"},React.createElement("h3",{className:"modal_heading"},n),React.createElement("div",{className:"modal_contents"},c.message?React.createElement(ErrorWithClearUI,{message:c.message,clear:c.clear}):null,React.createElement("form",{className:"commentEditor_form"},React.createElement("label",{for:"id_comment_contents",className:"sr-only"},"Contents"),React.createElement("textarea",{id:"id_comment_contents",className:"commentEditor_editText",name:"contents",cols:"30",rows:"5",value:r.contents.get,onChange:r.contents.set}),React.createElement(CommentEditorCheckboxes,{controlled:r}),React.createElement(EditorControls,{handleDelete:o,handleSubmit:e=>{e.preventDefault(),i()},wantDelete:void 0!==t.id})))))]}function CommentEditorCheckboxes({controlled:e}){return React.createElement("div",{class:"commentEditor_checkboxesContainer"},React.createElement(CheckboxWithLabel,{idStr:"id_private_checkbox",labelStr:"Private",isChecked:e.private.get,onChange:e.private.set}),React.createElement(CheckboxWithLabel,{idStr:"id_pinned_checkbox",labelStr:"Pin",isChecked:e.pinned.get,onChange:e.pinned.set}),React.createElement(CheckboxWithLabel,{idStr:"id_highlighted_checkbox",labelStr:"Highlight",isChecked:e.highlighted.get,onChange:e.highlighted.set}))}function CheckboxWithLabel({idStr:e,labelStr:t,isChecked:a,onChange:n}){return React.createElement("div",{className:"checkboxWithLabel"},React.createElement("label",{for:e,className:"checkboxWithLabel_label"},t),React.createElement("input",{type:"checkbox",id:e,checked:a,onChange:n}))}function useCommentsFilter(){const n={false:0,true:1,both:2},[c,e]=React.useState(n.both),[r,t]=React.useState(n.both),[o,a]=React.useState(n.both);function i(e){return{setTrue:()=>e(n.true),setFalse:()=>e(n.false),setBoth:()=>e(n.both)}}return{pinned:{current:c,actions:i(e)},highlighted:{current:r,actions:i(t)},private:{current:o,actions:i(a)},STATE_LIST:n,heading:function(){const e=[a(c,"Pinned","Unpinned"),a(r,"Highlighted","Unhighlighted"),a(o,"Private","Public")];var t=e.reduce((e,t)=>""===t?e:""===e?t:e+", "+t,"");return""!==t?t:"All Comments";function a(e,t,a){return e===n.true?t:e===n.false?a:""}}(),reset:function(){e(n.both),t(n.both),a(n.both)},applyTo:function(e){return null===e?[]:(c===n.true?e=e.filter(e=>e.pinned):c===n.false&&(e=e.filter(e=>!e.pinned)),r===n.true?e=e.filter(e=>e.highlighted):r===n.false&&(e=e.filter(e=>!e.highlighted)),o===n.true?e=e.filter(e=>e.private):o===n.false&&(e=e.filter(e=>!e.private)),e)}}}function JobCommentsFilterModal({closeFn:e,filterKit:t,title:a}){return React.createElement(Modal,{close:e},React.createElement("div",{class:"commentFilterEditor"},React.createElement("h3",{className:"modal_heading"},a),React.createElement("div",{className:"modal_contents"},React.createElement("form",{className:"commentFilterEditor_form"},React.createElement(CommentsRadioFilter,{legendStr:"Pinned",groupName:"filterByPinned",filterStatus:t.pinned.current,FILTER_STATES:t.STATE_LIST,trueStr:"Pinned Only",falseStr:"Unpinned Only",bothStr:"Both",filterActions:t.pinned.actions}),React.createElement(CommentsRadioFilter,{legendStr:"Highlighted",groupName:"filterByHiglighted",filterStatus:t.highlighted.current,FILTER_STATES:t.STATE_LIST,trueStr:"Highlighted Only",falseStr:"Unhighlighted Only",bothStr:"Both",filterActions:t.highlighted.actions}),React.createElement(CommentsRadioFilter,{legendStr:"Private",groupName:"filterByPrivacy",filterStatus:t.private.current,FILTER_STATES:t.STATE_LIST,trueStr:"Private Only",falseStr:"Public Only",bothStr:"Both",filterActions:t.private.actions})))))}function CommentsRadioFilter({bothStr:e,filterStatus:t,falseStr:a,filterActions:n,FILTER_STATES:c,groupName:r,legendStr:o,trueStr:i}){return React.createElement("fieldset",{class:"radioFilter"},React.createElement("legend",null,o),React.createElement(RadioFilterOption,{isChecked:t===c.true,display_text:i,name:r,handleChange:n.setTrue}),React.createElement(RadioFilterOption,{isChecked:t===c.false,display_text:a,name:r,handleChange:n.setFalse}),React.createElement(RadioFilterOption,{isChecked:t===c.both,display_text:e,name:r,handleChange:n.setBoth}))}function RadioFilterOption({display_text:e,handleChange:t,isChecked:a,name:n}){return React.createElement("label",{className:`radioFilter_optionLabel radioFilter_optionLabel-${a?"":"un"}checked`},React.createElement("input",{hidden:!0,checked:a,type:"radio",disabled:!1,name:n,value:e,onChange:()=>t()}),React.createElement("span",{class:"radioFilter_optionStr"},e))}function useErrorWithClear(){const[e,t]=React.useState(null);return{message:e,set:function(e){t("string"==typeof(e=e)?e:"object"==typeof e&&"message"in e?e.message:"Something has gone wrong. Try refreshing the page.")},clear:function(){t(null)}}}function ErrorWithClearUI({message:e,clear:t}){return[React.createElement("div",{class:CLASS_ERROR_MESSAGE},React.createElement("div",{class:"message"},e),React.createElement(CancelButton,{cancel:t}))]}function ErrorModal({message:e,clear:t}){return React.createElement(Modal,{close:t},React.createElement("section",{className:"bigErrorMessage"},React.createElement("h2",{className:"bigErrorMessage_heading"},"Error"),React.createElement("p",{className:"bigErrorMessage_genericText"},"The following error has occurred:"),React.createElement("p",{className:"bigErrorMessage_specificError"},e),React.createElement("p",{className:"bigErrorMessage_genericText"},"If the error did not contain any specific instructions to resolve the issue, try refreshing the page.")))}function useExpandableWrapper(){const[e,t]=React.useState(!1);return{isExpanded:e,toggle:function(){t(e=>{})}}}function ExpandableWrapper({css:e,children:t}){var{isExpanded:a,toggle:n}=useExpandableWrapper();return React.createElement("div",{className:"expandableWrapper expandableWrapper-"+(a?"expanded":"retracted")+(null===e?"":" "+e)},t,React.createElement(ExpandCollapseToggle,{isExpanded:a,handle_click:n}))}function ExpandCollapseToggle({isExpanded:e,handle_click:t}){e=e?"collapse":"expand";return React.createElement("div",{className:"expandableWrapper_toolbar"},React.createElement("button",{class:"expandableWrapper_button expandableWrapper_button-"+e,onClick:t},React.createElement("span",{class:"sr-only"},e)))}function useFormSet(o,t,e,i=10){const n=o.reduce((e,t)=>({...e,[t.fe]:t.init}),{}),[c,r]=React.useState(0),[l,s]=React.useState([n]);var a={add_one:function(e){e.preventDefault(),l.length>=i||s([...l,n])},add_multiple:function(e){if(e.preventDefault(),0!==c){for(var t=[],a=0;a<c;)t.push(n),a++;s(l.concat(t)),r(0)}},num_to_add:getter_and_setter(c,function(e){(e=e.target.value)<0?r(0):r(e)}),remove:function(a){s(l.filter((e,t)=>t!==a))},update:function(a,e){if(l.length<=a)throw Error("Formset fields were not updated");const n={...l[a],...e};e=l.map((e,t)=>t===a?n:e),s(e)}};const m=useAsyncWithError(e);return{formSetForms:l,actionsFormSet:a,backendError:m.asyncError,handleSubmit:function(e){e.preventDefault(),m.handleAsync(()=>t.create(function(){const e={"form-TOTAL_FORMS":""+l.length,"form-INITIAL_FORMS":"0","form-MIN_NUM_FORMS":"0","form-MAX_NUM_FORMS":""+i};for(var t in l){var a,n=l[t],c=`form-${t}-`;for(a in o){var r=o[a];e[c+r.be]=n[r.fe]}}return e}()))},MAX_FORMS:i}}function FormSet({actionsFormSet:e,MAX_FORMS:t,totalForms:a,children:n}){return[React.createElement(React.Fragment,null,React.createElement("input",{type:"hidden",name:"form-TOTAL_FORMS",value:a,id:"id_form-TOTAL_FORMS"}),React.createElement("input",{type:"hidden",name:"form-INITIAL_FORMS",value:"0",id:"id_form-INITIAL_FORMS"}),React.createElement("input",{type:"hidden",name:"form-MIN_NUM_FORMS",value:"0",id:"id_form-MIN_NUM_FORMS"}),React.createElement("input",{type:"hidden",name:"form-MAX_NUM_FORMS",value:t,id:"id_form-MAX_NUM_FORMS"}),React.createElement("div",{className:"formSet_formRowsContainer"},n),React.createElement("div",{className:"formSet_addMoreContainer"},React.createElement("button",{class:"formSet_addOne add-button",onClick:e.add_one},React.createElement("span",null,"add 1 more")),React.createElement("div",{class:"formSet_addNMore"},React.createElement("label",{className:"formSet_addNMoreLabel"},"add more",React.createElement("input",{type:"number",className:"formSet_inputNMore",id:"add_multi_items",value:e.num_to_add.get,onChange:e.num_to_add.set})),React.createElement("button",{type:"button",class:"formSet_submitNMore button-primary",onClick:e.add_multiple},"add"))))]}function getFormsetFieldNames(e,t){return{name:e+t,id:"id_"+e+t}}function createOneJobItemFormsetKit(t,e,a){function n(e){t.update(a,e)}return{controlled:{quantity:getter_and_setter(e.quantity,function(e){n({quantity:e.target.value})}),selling_price:getter_and_setter(e.selling_price,function(e){n({selling_price:e.target.value})}),product_id:getter_and_setter(e.product_id,function(e){n({product_id:e.target.value})}),price_list_id:getter_and_setter(e.price_list_id,function(e){n({price_list_id:e.target.value})})},handle_click_remove:function(e){e.preventDefault(),t.remove(a)}}}function JobItemsCreator({actions_items:e,closeEditor:t,job_id:a}){const{formSetForms:n,actionsFormSet:c,backendError:r,handleSubmit:o}=useFormSet([{be:"quantity",fe:"quantity",init:""},{be:"product",fe:"product_id",init:""},{be:"selling_price",fe:"selling_price",init:""},{be:"price_list",fe:"price_list_id",init:""},{be:"job",fe:"job_id",init:""+a}],e,t,10);return[React.createElement(Modal,{close:t},React.createElement("div",{className:"jobItemsCreator"},React.createElement("h3",{className:"modal_heading"},"Add New Items"),React.createElement("div",{className:"modal_contents"},r.message?React.createElement(ErrorWithClearUI,{message:r.message,clear:r.clear}):null,React.createElement("form",{className:"jobItemsCreator_form",onSubmit:o},React.createElement(FormSet,{totalForms:n.length,MAX_FORMS:10,actionsFormSet:c},n.map((e,t)=>React.createElement(JobItemsCreatorRow,{key:t,form_index:t,actions_formset:c,data:e,job_id:a,num_forms:n.length}))),React.createElement("input",{type:"submit",action:"submit",class:"button-primary jobItemsCreator_submit",value:"submit"})))))]}function JobItemsCreatorRow({actions_formset:e,data:t,form_index:a,job_id:n,num_forms:c}){var{controlled:e,handle_click_remove:t}=createOneJobItemFormsetKit(e,t,a);return React.createElement(JobItemsCreatorRowUI,{controlled:e,form_index:a,handle_click:t,job_id:n,num_forms:c})}function JobItemsCreatorRowUI({controlled:e,form_index:t,handle_click:a,job_id:n,num_forms:c}){var t="form-"+t+"-",r=getFormsetFieldNames(t,"job");return[React.createElement("div",{class:"formSet_formRow"},1<c?React.createElement(JobItemsCreatorRowRemoveButton,{handle_click:a}):null,React.createElement(JobItemSharedFormFields,{controlled:e,initDescription:"",job_id:n,prefix:t}),React.createElement("input",{type:"hidden",name:r.name,value:n,id:r.id}))]}function JobItemsCreatorRowRemoveButton({handle_click:e}){return React.createElement("button",{class:"delete-panel formSet_removeItemButton",onClick:e,type:"button"},React.createElement("span",null,"remove"))}function useJobItemDetails(a){const[t,e]=React.useState(null);function n(){var e;return null===t||null==a||0===a.length||-1===(e=a.findIndex(e=>e.ji_id===parseInt(t)))?null:a[e]}const c={active:"active",slotFiller:"slotFiller",productMatch:"productMatch"};return{activeItem:t,updateActive:function(t){a.some(e=>e.ji_id===t)?e(t):e(null)},getActiveData:n,statusKeys:c,getStatusKey:function(t){const e=n();return null===e?null:e.ji_id===t.ji_id?c.active:e.product_id===t.product_id?c.productMatch:-1===e.module_list.findIndex(e=>e.product_id===t.product_id)?null:c.slotFiller}}}function JobItemsDetailsContainer({actions_items:e,currency:t,detailsKit:a,job_id:n,modalKit:c,product_slot_assignments:r,URL_MODULE_MANAGEMENT:o}){const i=a.getActiveData();return[React.createElement(ExpandableWrapper,{css:"jobItems_detailsWrapper jobItems_detailsWrapper-"+(null===i?"inactive":"active")},React.createElement("div",{class:"jobItems_detailsHeaderStrip"},React.createElement("h4",{className:"jobItems_detailsHeader"},"item details"),React.createElement(CancelButton,{cancel:()=>a.updateActive(null),css:"jobItems_closeDetailsButton"})),React.createElement("div",{class:"jobItems_detailsContent"},null===i?React.createElement("p",{className:"jobItems_noSelectionMessage"},"Select an item to view details"):React.createElement(React.Fragment,null,React.createElement(JobItem,{actions_items:e,currency:t,data:i,job_id:n,modalKit:c,product_slot_data:r[i.product_id.toString()],URL_MODULE_MANAGEMENT:o}),i.module_list.map(e=>React.createElement(JobItemSlotFillerUI,{key:String(e.product_id),currency:t,data:r[e.product_id.toString()]})))))]}function JobItem({actions_items:e,currency:t,data:a,job_id:n,modalKit:c,product_slot_data:r,URL_MODULE_MANAGEMENT:o}){const i="jobItem_edit_"+a.ji_id;return c.isOpenedBy(i)?React.createElement(JobItemEditor,{closeEditor:c.close,data:a,delete_item:e.remove,job_id:n,update_item:e.update}):React.createElement(JobItemReaderUI,{currency:t,data:a,job_id:n,openJobItemEditor:()=>c.open(i),product_slot_data:r,URL_MODULE_MANAGEMENT:o})}function JobItemReaderUI({currency:e,data:t,job_id:a,openJobItemEditor:n,product_slot_data:c,URL_MODULE_MANAGEMENT:r}){return[React.createElement("div",{class:"jobItems_detailsJobItem"},React.createElement(JobItemHeadingUI,{description:t.description,ji_id:t.ji_id,part_number:t.part_number,product_name:t.product_name,quantity:t.quantity}),React.createElement(JobItemMoneyUI,{currency:e,data:t,openJobItemEditor:n}),void 0===t.standard_accessories.length||null===t.standard_accessories.length||0===t.standard_accessories.length?null:React.createElement(JobItemAccessoriesUI,{data:t}),t.is_modular?React.createElement(JobItemSpecificationUI,{data:t,job_id:a,URL_MODULE_MANAGEMENT:r}):null,React.createElement(JobItemsWithMatchingProduct,{currency:e,data:c,exclude_id:t.ji_id,title:"Product also entered as"}),0===c.assignments.length?null:React.createElement(JobItemAssignmentsUI,{product_slot_data:c}))]}function JobItemHeadingUI({description:e,ji_id:t,part_number:a,product_name:n,quantity:c}){return[React.createElement("div",{class:"subsection"},React.createElement("h5",{class:"subsection_heading what"},0===c||null==c?null:React.createElement(JobItemHeadingQuantitySpan,{quantity:c}),React.createElement("span",{class:"product"},a,": ",n),React.createElement(JobItemIdIcon,{ji_id:t}),React.createElement("div",{class:"desc"},e)))]}function JobItemHeadingQuantitySpan({quantity:e}){return React.createElement("span",{class:"quantity"},e," x ")}function JobItemMoneyUI({currency:e,data:t,openJobItemEditor:a}){var n=parseFloat(t.selling_price);return[React.createElement("div",{class:"money subsection"},React.createElement("span",{class:"selling_price"},e+nbsp()+format_money(n)),React.createElement(JobItemPriceListIconSpan,{price_list_name:t.price_list_name}),React.createElement("button",{class:"ji-edit edit-icon",onClick:a},React.createElement("span",null,"edit")))]}function JobItemAccessoriesUI({data:e}){var t=1<e.quantity?" (in total)":"";return[React.createElement("div",{class:"std-accs-container subsection"},React.createElement("div",{class:"std-accs"},React.createElement("p",null,"Included accessories",t),React.createElement("ul",null,e.standard_accessories.map((e,t)=>React.createElement(QuantityNameLi,{key:t,name:e.product_name,quantity:e.quantity})))))]}function JobItemSpecificationUI({data:e,URL_MODULE_MANAGEMENT:t}){var a=e.is_complete?null:"incomplete".toUpperCase(),n=`${e.excess_modules?"Special ":""}Specification`+(1<e.quantity?" (per"+nbsp()+"item)":""),c=getJobItemModularStatusCSS(e);return[React.createElement("div",{class:"module-status-section subsection modules-"+c},React.createElement("div",{class:"intro-line"},React.createElement("span",{class:"display-text"},"» ",n),null===a?null:React.createElement(WarningMessageSpan,{message:a}),React.createElement("a",{href:t+"#modular_jobitem_"+e.ji_id,class:"edit-icon"},React.createElement("span",null,"edit"))),React.createElement("ul",{class:"details"},e.module_list.map(e=>React.createElement(QuantityNameLi,{key:e.module_id.toString(),name:e.name,quantity:e.quantity}))))]}function WarningMessageSpan({message:e}){return React.createElement("span",{class:"warning-msg"},React.createElement("span",{class:"invalid-icon"}),React.createElement("span",{class:"msg"},e))}function JobItemsWithMatchingProduct({currency:e,data:t,exclude_id:a,title:n}){t=null===a?t.members:t.members.filter(e=>e.ji_id!==a);return 0===t.length?null:React.createElement(JobItemsWithMatchingProductUI,{currency:e,members:t,title:n})}function JobItemsWithMatchingProductUI({currency:t,members:e,title:a}){return[React.createElement("div",{class:"subsection product"},React.createElement("div",{class:"subsection_heading"},a),React.createElement("div",{class:"ji-list"},React.createElement("table",null,e.map(e=>React.createElement(JobItemWithMatchingProductRowUI,{key:e.ji_id.toString(),currency:t,data:e})))))]}function JobItemWithMatchingProductRowUI({currency:e,data:t}){return[React.createElement("tr",null,React.createElement("td",null,React.createElement(JobItemIdIcon,{ji_id:t.ji_id})),React.createElement("td",{class:"desc"},t.quantity," for ",e+nbsp()+format_money(parseFloat(t.selling_price))),React.createElement("td",null,React.createElement(JobItemPriceListIconSpan,{price_list_name:t.price_list_name})))]}function JobItemAssignmentsUI({product_slot_data:e}){return[React.createElement("div",{class:"module-status-section assignments subsection"},React.createElement("div",{class:"intro-line"},React.createElement("span",{class:"display-text"},"« Assignment"),React.createElement("div",{class:"usage-counters"},React.createElement(JobItemAssignmentsCounterUI,{display_str:"used",num:e.num_assigned,total:e.total_product_quantity}),React.createElement(JobItemAssignmentsCounterUI,{display_str:"unused",num:e.total_product_quantity-e.num_assigned,total:e.total_product_quantity}))),React.createElement("ul",null,e.assignments.map((e,t)=>React.createElement(JobItemAssignmentLiUI,{key:t,data:e}))))]}function JobItemAssignmentsCounterUI({display_str:e,num:t,total:a}){return[React.createElement("div",{class:"assignment-icon"},React.createElement("span",{class:"label"},e),React.createElement("span",{class:"status"},t,"used"===e?"/"+a:""))]}function JobItemAssignmentLiUI({data:e}){var t=1<e.parent_qty?"each ":"";return[React.createElement("li",null,e.quantity," ",t,"to ",e.parent_qty," x [",e.part_num,"] ",e.product_name,React.createElement(JobItemIdIcon,{ji_id:e.parent_id}))]}function JobItemSlotFillerUI({currency:e,data:t}){return[React.createElement("div",{class:"jobItems_detailsJobItem product"},React.createElement(JobItemHeadingUI,{description:t.description,ji_id:null,part_number:t.part_number,product_name:t.product_name,quantity:null}),React.createElement(JobItemSlotFillerQuantityUI,{quantity:t.total_product_quantity}),React.createElement(JobItemsWithMatchingProduct,{currency:e,data:t,exclude_id:null,title:"Entered as"}),React.createElement(JobItemAssignmentsUI,{product_slot_data:t}))]}function JobItemSlotFillerQuantityUI({quantity:e}){return[React.createElement("div",{class:"subsection"},React.createElement("span",{class:"product-quantity"},"Total quantity: ",e))]}function useJobItemEditor(e){const{data:t,closeEditor:a,delete_item:n,update_item:c}=e.current,[r,o]=React.useState(t.quantity),[i,l]=React.useState(t.selling_price),[s,m]=React.useState(t.product_id),[d,u]=React.useState(t.price_list_id);e={quantity:getter_and_setter(r,function(e){o(e.target.value)}),selling_price:getter_and_setter(i,function(e){l(e.target.value)}),product_id:getter_and_setter(s,function(e){m(e.target.value)}),price_list_id:getter_and_setter(d,function(e){u(e.target.value)})};const _=useAsyncWithError(a);return{backendError:_.backendError,controlled:e,handleSubmit:function(e){e.preventDefault(),_.handleAsync(()=>c(t.ji_id,function(){var e={};r!=t.quantity&&(e.quantity=r);i!=t.selling_price&&(e.selling_price=i);s!=t.product_id&&(e.product_id=s);d!=t.price_list_id&&(e.price_list_id=d);return e}(),{quantity:r,selling_price:i,product:s,price_list:d}))},handleDelete:async function(){_.handleAsync(()=>n(t.ji_id))}}}function JobItemEditor({closeEditor:e,data:t,delete_item:a,job_id:n,update_item:c}){const r=React.useRef();r.current={data:t,closeEditor:e,delete_item:a,update_item:c};var{backendError:a,controlled:c,handleSubmit:o,handleDelete:i}=useJobItemEditor(r);return[React.createElement(Modal,{close:e},React.createElement("div",null,React.createElement("h3",{class:"modal_heading"},"Edit Item"),React.createElement("div",{className:"modal_contents"},React.createElement("div",{className:"formy"},React.createElement(JobItemSharedFormFields,{controlled:c,initDescription:t.description,job_id:n,prefix:""}),a.message?React.createElement(ErrorWithClearUI,{message:a.message,clear:a.clear}):null,React.createElement(EditorControls,{handleDelete:i,handleSubmit:o,wantDelete:!0})))))]}function useProductDescription(e,t){const[a,n]=React.useState(e);return{description:a,update_product_description:function(e){e=url_for_product_description(e,t),fetch(e).then(e=>e.json()).then(e=>{"desc"in e&&n(e.desc)}).catch(e=>n(""))}}}function JobItemSharedFormFields({controlled:t,initDescription:e,job_id:a,prefix:n}){const{description:c,update_product_description:r}=useProductDescription(e,a);return React.createElement(JobItemSharedFormFieldsUI,{controlled:t,description:c,handle_product_change:function(e){t.product_id.set(e),r(e.target.value)},prefix:n})}function JobItemSharedFormFieldsUI({controlled:e,description:t,handle_product_change:a,prefix:n}){var c=getFormsetFieldNames(n,"quantity"),r=getFormsetFieldNames(n,"product"),o=getFormsetFieldNames(n,"selling_price"),n=getFormsetFieldNames(n,"price_list");return[React.createElement("div",{className:"formy_inputsContainer"},React.createElement(LabelFieldContainer,null,React.createElement(FormLabel,{inputID:c.id},"Quantity"),React.createElement("input",{className:"formy_input",id:c.id,name:c.name,onChange:e.quantity.set,type:"number",value:e.quantity.get})),React.createElement("div",{className:"formy_labelFieldContainerWithAutoDesc"},React.createElement(LabelFieldContainer,null,React.createElement(FormLabel,{inputID:r.id},"Item"),React.createElement(SelectBackendOptions,{get_param:"products",handle_change:a,is_required:!0,select_id:r.id,select_name:r.name,selected_opt_id:e.product_id.get})),""===t||null==t?null:React.createElement("span",{class:"formy_productDesc"},t)),React.createElement(LabelFieldContainer,null,React.createElement(FormLabel,{inputID:o.id},"Selling Price"),React.createElement("input",{className:"formy_input",id:o.id,name:o.name,onChange:e.selling_price.set,step:"0.01",type:"number",value:e.selling_price.get})),React.createElement(LabelFieldContainer,null,React.createElement(FormLabel,{inputID:n.id},"Price List"),React.createElement(SelectBackendOptions,{get_param:"price_lists",handle_change:e.price_list_id.set,is_required:!0,select_id:n.id,select_name:n.name,selected_opt_id:e.price_list_id.get})))]}function useJobMenu(){var e={summary:"Summary",detailsAndPO:"Details & PO",comments:"Comments",docs_out:"Documents",items:"Items",pricecheck:"Price Check"};const a=[e.summary,e.comments,e.detailsAndPO,e.docs_out,e.items,e.pricecheck],[t,n]=React.useState(!0),[c,r]=React.useState(a[0]);function o(){n(!1)}return{isOpen:t,open:function(){n(!0)},close:o,activeTab:c,updateActiveTab:function(t){-1!==a.findIndex(e=>e===t)&&r(t),window.innerWidth<1200&&o()},TABS:a,TAB_NAMES:e}}function BurgerMenuIcon({open:e}){return[React.createElement("div",{className:"burgerMenu"},React.createElement("button",{className:"burgerMenu_button",onClick:e},React.createElement("span",{className:"buttonSpan"},"open menu")))]}function JobSideNav({activeTab:t,close:e,isOpen:a,job_id:n,names:c,TABS:r,updateActiveTab:o}){return[React.createElement("section",{className:"jobSideNav jobSideNav-"+(a?"open":"closed")},React.createElement("button",{className:"jobSideNav_closeButton close",onClick:()=>e()},React.createElement("span",null,"close")),React.createElement(JobSidebarHeadingUI,{job_id:n,names:c}),React.createElement("ul",{className:"jobSideNav_list"},r.map(e=>React.createElement("li",null,React.createElement("button",{className:"jobSideNav_button"+(e===t?" jobSideNav_button-on":""),onClick:()=>o(e),disabled:e===t},e)))))]}function JobSidebarHeadingUI({job_id:e,names:t}){return[React.createElement("div",{className:"jobSideNav_topWrapper"},React.createElement("div",null,React.createElement("h3",{className:"jobSideNav_heading"},t.job_name),React.createElement(JobSidebarSubHeadingUI,{customer_name:t.customer_name})),React.createElement(JobToDoToggle,{job_id:e}))]}function JobSidebarSubHeadingUI({customer_name:e}){return""!=e?React.createElement("div",{class:"jobSideNav_subheading"},"for ",e):null}function usePagination(t,a){const[m,n]=React.useState(1),[d,c]=React.useState(1);return React.useEffect(()=>{var e=null!=t&&0<t.length?t.length:-1;-1!==e&&c(Math.ceil(e/a))},[t]),{currentPage:m,numPages:d,page:(e=(m-1)*a,t.slice(e,e+a)),changePageTo:function(e){var t,e=parseInt(e,10);t=e,Number.isInteger(t)&&0<t&&t<=d&&e!==m&&n(e)},getDisplayPageNumbersForNav:function(e,t,a,n){e=s(e),n=s(n);var c=e+(t=s(t))+1+(a=s(a))+n;if(d<=c)return l(1,d);var c=t+1+a,r=d+1-n,o=m<=e+t+1,a=m>=r-a-1;const i=o?l(1,e+c):0===e?[]:l(1,e);return e=a?l(r-c,n+c):0===n?[]:l(r,n),(o||a?i:(r=l(m-t,c),i.concat(r))).concat(e);function l(t,e){return Array.from(Array(e).keys()).map(e=>t+e)}function s(e){var t;return Number.isNaN(e)?(t=parseInt(e),Number.isNaN(t)?0:Math.max(t,0)):Math.max(e,0)}}};var e}function PaginationControls({changePageTo:a,css:e,currentPage:n,pageNumsForButtons:c}){return[React.createElement("div",{className:"pagination pagination-"+e},React.createElement("span",{class:"sr-only"},"pages"),c.map((e,t)=>{t=t<c.length-1&&1<c[t+1]-e;return React.createElement(React.Fragment,null,React.createElement(PaginationPageButton,{pageNum:e,onClick:()=>a(e),disabled:e===n}),t?React.createElement(PaginationSeparator,null):null)}))]}function PaginationPageButton(e){return React.createElement("button",{className:"pagination_button",onClick:e.onClick,disabled:e.disabled},e.pageNum)}function PaginationSeparator(){return React.createElement("span",{className:"pagination_separator"},"...")}function usePOEditor(e,t,a,n){const[c,r]=React.useState(t.reference),[o,i]=React.useState(t.date_on_po),[l,s]=React.useState(t.date_received),[m,d]=React.useState(t.currency),[u,_]=React.useState(t.value);t={reference:getter_and_setter(c,function(e){r(e.target.value)}),date_on_po:getter_and_setter(o,function(e){i(e.target.value)}),date_received:getter_and_setter(l,function(e){s(e.target.value)}),currency:getter_and_setter(m,function(e){d(e.target.value)}),po_value:getter_and_setter(u,function(e){_(e.target.value)})};const p=useAsyncWithError(e);return{backend_error:p.asyncError,controlled:t,handle_delete:function(e){e.preventDefault(),p.handleAsync(n())},handle_submit:function(e){e.preventDefault(),p.handleAsync(a({reference:c,date_on_po:o,value:u,date_received:l,currency:m},{reference:c,date_on_po:o,value:u,date_received:l,currency:m,job:window.JOB_ID}))}}}function JobPoEditor({closeFn:e,data:t,form_id:a,onDelete:n,onSubmit:c,title:r}){var{backend_error:c,controlled:n,handle_delete:o,handle_submit:i}=usePOEditor(e,t,c,n);return React.createElement(JobPoEditorUI,{backend_error:c,closeFn:e,controlled:n,form_id:a,po_id:t.po_id,handle_delete:o,handle_submit:i,title:r})}function JobPoEditorUI({backend_error:e,controlled:t,closeFn:a,form_id:n,handle_delete:c,handle_submit:r,po_id:o,title:i}){var l="id_po_reference",s="id_date_on_po",m="id_po_date_received",d="id_po_currency",u="id_po_value";return[React.createElement(Modal,{close:a},React.createElement("div",{className:"poEditor"},React.createElement("h3",{class:"modal_heading"},i),React.createElement("div",{className:"modal_contents"},e.message?React.createElement(ErrorWithClearUI,{message:e.message,clear:e.clear}):null,React.createElement("form",{class:"poEditor_form formy",id:n},React.createElement("div",{className:"formy_inputsContainer"},React.createElement(LabelFieldContainer,null,React.createElement(FormLabel,{inputID:l},"Customer PO Number:"),React.createElement("input",{className:"poEditor_poNumInput formy_input",type:"text",name:"reference",maxlength:"50",required:"",id:l,value:t.reference.get,onChange:t.reference.set})),React.createElement(LabelFieldContainer,null,React.createElement(FormLabel,{inputID:s},"Date on PO:"),React.createElement("input",{className:"formy_date",type:"date",name:"date_on_po",required:"",id:s,value:t.date_on_po.get,onChange:t.date_on_po.set})),React.createElement(LabelFieldContainer,null,React.createElement(FormLabel,{inputID:m},"Date received:"),React.createElement("input",{className:"formy_date",type:"date",name:"date_received",required:"",id:m,value:t.date_received.get,onChange:t.date_received.set})),React.createElement(LabelFieldContainer,null,React.createElement(FormLabel,{inputID:d},"Currency:"),React.createElement(SelectBackendOptions,{cssClass:"formy_currencySelect",get_param:"currencies",handle_change:t.currency.set,is_required:!0,select_id:d,select_name:"currency",selected_opt_id:t.currency.get})),React.createElement(LabelFieldContainer,null,React.createElement(FormLabel,{inputID:u},"Value:"),React.createElement("input",{className:"formy_input",type:"number",name:"value",step:"0.01",required:"",id:u,value:t.po_value.get,onChange:t.po_value.set}))),React.createElement(EditorControls,{handleSubmit:r,handleDelete:c,wantDelete:null!==o})))))]}function usePriceAcceptanceToggle(n,c,r){const[o,e]=React.useState(null),{data:t,error:a,isLoaded:i}=useFetchWithLoading(url_for_url_list());return React.useEffect(()=>{set_if_ok(t,"price_acceptance_url",e)},[t]),{error:a,isLoaded:i,toggle_acceptance:async function(){if(null!==o){var e=!n,t=getRequestOptions("PUT",{new_status:e}),a=o+"?job_id="+r;try{await fetchAndJSON(a,t,204);c("priceAccepted",e)}catch(e){alert(getErrorMessage(e))}}}}}function PriceAcceptanceToggle({priceAccepted:e,priceAcceptedActions:t}){return t.error?React.createElement(LoadingErrorUI,{name:"price acceptance toggle"}):t.isLoaded?React.createElement(PriceAcceptanceToggleUI,{is_accepted:e,toggle_acceptance:t.toggle_acceptance}):React.createElement(LoadingUI,null)}function PriceAcceptanceToggleUI({is_accepted:e,toggle_acceptance:t}){return[React.createElement("div",{id:"price_confirmation_status",className:"jobNarrowSection_content"},React.createElement("div",{class:"status-indicator "+(e?"on":"off")},React.createElement("span",{class:"status-name"},"selling price is"),React.createElement("button",{id:"price_confirmation_button",onClick:t},e?"accepted":"NOT ACCEPTED")))]}function usePriceCheckEditor(e,t,a,n){const[c,r]=React.useState("");const o=useAsyncWithError(t);function i(e){const t={selling_price:e};o.handleAsync(()=>a.update(n,t,t))}return{backend_error:o.asyncError,customPrice:c,handle_change:function(e){r(e.target.value)},handle_list_click:function(){i(e.list_price)},handle_resale_click:function(){i(e.resale_price)},handle_submit:function(){i(c)}}}function JobPriceCheckPriceEditorUI({calc:e,cancel:t,controlledPrice:a,data:n,handle_change:c,handle_list_click:r,handle_resale_click:o,handle_submit:i}){return[React.createElement("div",{class:"priceCheckEditor panel popout"},React.createElement(CancelButton,{cancel:t}),React.createElement("h5",{class:"panel-header"},"Edit Price"),React.createElement("p",{className:"priceCheckEditor_description"},n.quantity," x [",n.part_number,"] ",n.product_name),React.createElement("div",{class:"priceCheckEditor_optionsContainer"},React.createElement("h6",{className:"priceCheckEditor_optionsHeading"},"Click new price"),React.createElement(PresetPriceButtonUI,{handle_click:r,price_preset:e.list_price,price_type:"list"}),React.createElement(PresetPriceButtonUI,{handle_click:o,price_preset:e.resale_price,price_type:"resale"})),React.createElement(ManualPriceInput,{controlledPrice:a,handle_change:c,handle_submit:i}))]}function PresetPriceButtonUI({handle_click:e,price_type:t,price_preset:a}){return React.createElement("button",{class:"priceCheckEditor_presetPriceButton buttonSecondary",onClick:e,type:"button"},t," (",format_money(parseFloat(a)),")")}function ManualPriceInput({customPrice:e,handle_change:t,handle_submit:a}){return[React.createElement("form",{class:"priceCheckEditor_customPrice singleInputWithButton"},React.createElement("label",{className:"singleInputWithButton_label",htmlFor:"id_new_price"},"Or enter your own and submit"),React.createElement("input",{className:"singleInputWithButton_input",id:"id_new_price",type:"number",step:.01,name:"new_price",value:e,onChange:t}),React.createElement(SubmitButton,{submit:a,cssClasses:"singleInputWithButton_submit formControls_submit"}))]}function useTodoToggle(a){const[n,c]=React.useState(!1),[r,e]=React.useState(""),{data:t,error:o,isLoaded:i}=useFetchWithLoading(url_for_page_load(a,"todo"));return React.useEffect(()=>{set_if_ok(t,"on_todo",c),set_if_ok(t,"url",e)},[t]),{error:o,isLoaded:i,todo:n,toggle_todo:async function(){var e=!n,t=getFetchHeaders(e?"PUT":"DELETE",{job_id:a});try{await fetchAndJSON(r,t,204);c(e)}catch(e){alert(get_error_message(e))}}}}function JobToDoToggle({job_id:e}){var{error:e,isLoaded:t,todo:a,toggle_todo:n}=useTodoToggle(e);return e?React.createElement(LoadingErrorUI,{name:"todo status"}):t?React.createElement(JobToDoToggleUI,{todo:a,toggle_todo:n}):React.createElement(LoadingUI,null)}function JobToDoToggleUI({todo:e,toggle_todo:t}){return[React.createElement("label",{className:"jobSideNav_toggleWrapper"},React.createElement("input",{hidden:!0,checked:e,disabled:!1,name:"onToDo",onChange:()=>t(),type:"checkbox",value:e?"on":"off"}),React.createElement("span",{className:"toggle_labelText"},"todo"),React.createElement(Toggle,{isOn:e,displayStrOn:"on",displayStrOff:"off"}))]}function Toggle({isOn:e}){var t=e?"on":"off";return React.createElement("div",{className:"toggle toggle-"+t},React.createElement("span",{className:"toggle_statusText toggle_statusText-"+t},e?"on":"off"),React.createElement("div",{className:"toggle_ball toggle_ball-"+t,"aria-hidden":!0}))}function JobComments({comments:e,commentsActions:t,modalKit:a}){const n=useSortByDate(),c=useCommentsFilter();e=usePagination(c.applyTo(e).sort((e,t)=>{e=new Date(e.created_on),t=new Date(t.created_on);return n.activeSortByDate(e,t)}),5);return React.createElement(JobCommentsUI,{commentsActions:t,filterKit:c,modalKit:a,orderByKit:n,paginated:e})}function JobCommentsUI({commentsActions:e,filterKit:t,modalKit:a,orderByKit:n,paginated:c}){const r="job_comments_filter",o="job_comments_create";return[React.createElement("section",{class:"jobComments jobNarrowSection"},a.isOpen()?React.createElement(JobCommentModals,{closeFn:a.close,commentsActions:e,createCommentIsOpen:a.isOpenedBy(o),filterIsOpen:a.isOpenedBy(r),filterKit:t}):null,React.createElement(JobSectionHeadingNarrowUI,{text:"Comments"}),React.createElement(AddButton,{label:"comment",css:"jobComments_addButton jobNarrowSection_content",onClick:()=>a.open(o)}),React.createElement(JobCommentsContentWrapperWithControls,{openFilterEditor:()=>a.open(r),orderByKit:n,paginated:c},React.createElement(CommentsWrapper,{actions:e,comments:c.page,css:"jobComments_container",emptyMessage:"No comments on this job match the current filter settings",heading:`${t.heading} (${n.heading.toLowerCase()})`,modalKit:a,wantCollapsable:!1})))]}function JobCommentModals({closeFn:e,commentsActions:t,createCommentIsOpen:a,filterIsOpen:n,filterKit:c}){return n?React.createElement(JobCommentsFilterModal,{closeFn:e,filterKit:c,title:"Filter Comments"}):a?React.createElement(CommentEditor,{actions:t,comment:{contents:"",private:!0,pinned:!1,highlighted:!1},closeFn:e,title:"Add Comment"}):null}function JobCommentsContentWrapperWithControls({openFilterEditor:e,orderByKit:t,paginated:a,children:n}){return[React.createElement("div",{class:"jobComments_viewExistingWrapper jobNarrowSection_content"},React.createElement("div",{class:"jobComments_viewExisting"},React.createElement(JobCommentsSortAndFilterControls,{openFilterEditor:e,orderByKit:t}),React.createElement(PaginationControls,{css:"above",currentPage:a.currentPage,numPages:a.numPages,changePageTo:a.changePageTo,pageNumsForButtons:a.getDisplayPageNumbersForNav(1,1,1,1)}),n,React.createElement(PaginationControls,{css:"below",currentPage:a.currentPage,numPages:a.numPages,changePageTo:a.changePageTo,pageNumsForButtons:a.getDisplayPageNumbersForNav(1,1,1,1)})))]}function JobCommentsSortAndFilterControls({openFilterEditor:e,orderByKit:t}){var a="id_commentOrderSelect";return React.createElement("div",{class:"jobComments_controls"},React.createElement("button",{class:"jobComments_filterButton",onClick:function(){e()}},React.createElement("span",{class:"jobComments_filterButtonText"},"filter")),React.createElement("form",{class:"orderByForm jobComments_orderByForm"},React.createElement("label",{htmlFor:a,className:"sr-only"},"Order by"),React.createElement("select",{className:"jobComments_orderBySelect",id:a,onChange:e=>{void 0!==e.target.value&&t.update(e.target.value)}},t.options.map(e=>React.createElement("option",{key:e.id,value:e.id,selected:e.id===t.activeID},e.displayStr)))))}function JobDetailsAndPO({actions_po:e,currency:t,difference:a,has_invalid_currency_po:n,job_id:c,modalKit:r,poList:o,total_items_value:i,total_po_value:l}){return React.createElement("div",{class:"jobDetailsPO jobNarrowSection"},React.createElement(JobSectionHeadingNarrowUI,{text:"Details & Purchase Orders"}),React.createElement("div",{class:"jobDetailsPO_wrapper"},React.createElement(JobDetails,{currency:t,job_id:c}),React.createElement(JobPo,{actions_po:e,poList:o,currency:t,difference:a,job_id:c,modalKit:r,total_po_value:l,total_items_value:i,has_invalid_currency_po:n})))}function JobDocumentsUI({docList:e,docQuantities:t,totalQuantityAllItems:a,URL_DOCS:n}){return[React.createElement("section",{class:"jobDocsOut jobNarrowSection"},React.createElement(JobSectionHeadingNarrowUI,{text:"Documents"}),React.createElement("div",{className:"jobDocsOut_contentWrapper"},React.createElement(JobDocumentsSubsection,{docList:e,docQuantities:t,totalQuantityAllItems:a,URL_DOCS:n,doc_type:"WO",title:"Works Order"}),React.createElement(JobDocumentsSubsection,{docList:e,docQuantities:t,totalQuantityAllItems:a,URL_DOCS:n,doc_type:"OC",title:"Order Confirmation"})))]}function JobDocumentsSubsection({docList:e,docQuantities:t,doc_type:a,title:n,totalQuantityAllItems:c,URL_DOCS:r}){r=r+"&type="+a,t=function(e,t,a){let n=parseInt(a);for(var c in t){c=t[c];if(c.doc_type==e)return n=(n-=parseInt(c.qty_on_issued))-parseInt(c.qty_on_draft)}return n}(a,t,c),c=e.filter(e=>e.doc_type==a);return React.createElement(JobDocumentsSubsectionUI,{doc_list:c,doc_type:a,title:n,unassigned_qty:t,url_builder:r})}function JobDocumentsSubsectionUI({doc_list:e,doc_type:t,title:a,unassigned_qty:n,url_builder:c}){return[React.createElement("div",{className:"subsection jobDocsOut_subsection"},React.createElement("h4",{className:"jobDocsOut_subsectionHeading"},a),React.createElement("a",{href:c,class:"add-button jobDocsOut_subsectionAddButton"},"New ",t),null==n||isNaN(n)||n<=0?React.createElement(JobDocumentsUnassignedItemsUI,null):null,null==e||0==e.length?React.createElement(EmptySectionUI,{message:`No ${t} documents yet`,css:"jobDocsOut_emptySection"}):React.createElement(JobDocumentsOutgoingTable,{doc_list:e}))]}function JobDocumentsUnassignedItemsUI(){return[React.createElement("div",{class:"jobDocsOut_unassignedWrapper"},React.createElement("span",{class:"jobDocsOut_unassignedIcon"},"?"),React.createElement("span",{class:"jobDocsOut_unassignedMsg"},"unassigned items"))]}function JobDocumentsOutgoingTable({doc_list:e}){return[React.createElement("table",{className:"documentsOutTable banded"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Reference"),React.createElement("th",null,"Date"),React.createElement("th",null,"Status"))),React.createElement("tbody",null,e.map(e=>React.createElement(JobDocumentsOutgoingTableRow,{key:e.doc_version_id,data:e}))))]}function JobDocumentsOutgoingTableRow({data:e}){var t=null===e.issue_date?e.created_on:e.issue_date;const a=null===e.issue_date?"draft":"issued";return React.createElement("tr",null,React.createElement("td",{className:"documentsOutTable_referenceCol"},e.reference),React.createElement("td",{className:"documentsOutTable_dateCol"},t),React.createElement("td",{className:"documentsOutTable_statusCol documentsOutTable_statusCol-"+a.toLowerCase()},React.createElement("div",{className:"documentsOutTable_status documentsOutTable_status-"+a.toLowerCase()},e.is_valid?null==e.issue_date?"Draft":"Issued":React.createElement(InvalidIconUI,{message:"invalid item assignments"}))),React.createElement("td",{className:"documentsOutTable_editCol"},React.createElement("a",{href:e.url,className:"edit-icon"},React.createElement("span",null,"edit"))))}function JobItemsUI({actions_items:e,currency:t,items_list:a,job_id:n,modalKit:c,URL_MODULE_MANAGEMENT:r}){const o="create_items_form";return[React.createElement("section",{class:"jobItems jobNarrowSection"},React.createElement(JobSectionHeadingNarrowUI,{text:"Items"}),React.createElement("div",{class:"jobItems_contentWrapper"},React.createElement("button",{id:"open_item_form_btn",class:"add-button",onClick:()=>c.open(o),disabled:c.isOpen()},"Add Items"),c.isOpenedBy(o)?React.createElement(JobItemsCreator,{actions_items:e,closeEditor:c.close,job_id:n}):null,null==a||0===a.length?React.createElement(EmptySectionUI,{css:"jobPage_emptySection",message:"No items have been entered"}):React.createElement(JobItemsExisting,{actions_items:e,currency:t,items_list:a,job_id:n,modalKit:c,URL_MODULE_MANAGEMENT:r})))]}function JobItemsExisting({actions_items:e,currency:t,items_list:a,job_id:n,modalKit:c,URL_MODULE_MANAGEMENT:r}){var o=useJobItemDetails(a),i=slot_assignment_data_by_product(a);return React.createElement(JobItemsExistingUI,{actions_items:e,currency:t,detailsKit:o,items_list:a,job_id:n,modalKit:c,product_slot_assignments:i,URL_MODULE_MANAGEMENT:r})}function JobItemsExistingUI({actions_items:e,currency:t,detailsKit:a,items_list:n,job_id:c,modalKit:r,product_slot_assignments:o,URL_MODULE_MANAGEMENT:i}){return[React.createElement("div",{class:"jobItems_existingAndDetailsContainer"},React.createElement(JobItemsExistingTable,{currency:t,detailsKit:a},n.map(e=>React.createElement(JobItemRow,{key:e.ji_id.toString(),data:e,detailsKit:a}))),React.createElement(JobItemsDetailsContainer,{actions_items:e,currency:t,detailsKit:a,job_id:c,modalKit:r,product_slot_assignments:o,URL_MODULE_MANAGEMENT:i}))]}function JobItemsExistingTable({currency:e,detailsKit:t,children:a}){t=null===t.activeItem?"banded":"details-visible";return[React.createElement("table",{id:"jobitems_table",class:"jobItems_existing "+t},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"id"),React.createElement("th",null,"qty"),React.createElement("th",null,"part #"),React.createElement("th",null,"name"),React.createElement("th",null,"modular"),React.createElement("th",null,"sold @ ",e),React.createElement("th",null,"price list"))),React.createElement("tbody",null,a))]}function JobItemRow({data:e,detailsKit:t}){return React.createElement(JobItemRowUI,{data:e,detailsKit:t,toggle_details:function(){t.activeItem===e.ji_id?(t.updateActive(null),document.activeElement.blur()):t.updateActive(e.ji_id)}})}function JobItemRowUI({data:e,detailsKit:t,toggle_details:a}){var n=t.getStatusKey(e),t=t.statusKeys,c=n===t.active?"dark":null,n=n===t.active?"details-active":n===t.slotFiller?"details-slotFiller":n===t.productMatch?"details-sameProduct":null,t="content-highlight-wrapper",r=e.is_modular?"":" not-modular";return[React.createElement("tr",{class:n},React.createElement("td",{class:"ji_id"},React.createElement("div",{class:t},React.createElement(JobItemIdIcon,{ji_id:e.ji_id}))),React.createElement("td",{class:"quantity"},e.quantity),React.createElement("td",{class:"part_no"},React.createElement("div",{class:t},e.part_number)),React.createElement("td",{class:"product_name"},e.product_name),React.createElement("td",{class:"modular"+r},React.createElement(JobItemRowModularContentsUI,{css:t,data:e})),React.createElement("td",{class:"selling_price"},format_money(parseFloat(e.selling_price))),React.createElement("td",{class:"price_list"},React.createElement(JobItemPriceListIconSpan,{price_list_name:e.price_list_name})),React.createElement("td",{class:"more_info"},React.createElement("button",{class:"more-icon"+(null===c?"":" "+c),onClick:a,type:"button"},React.createElement("span",null,"more info"))))]}function JobItemRowModularContentsUI({css:e,data:t}){var a=t.is_modular?"modules-"+getJobItemModularStatusCSS(t):null,t=t.is_modular?t.excess_modules?"special":t.is_complete?"ok":"invalid":"-";return React.createElement("div",{class:""+(null!==e&&null!==a?e+" "+a:null!==e?e:a)},t)}function getJobItemModularStatusCSS(e){return e.excess_modules?"excess":e.is_complete?"ok":"incomplete"}function slot_assignment_data_by_product(e){const t=function(e){const t={};for(var a in e){const n=e[a];a=n.product_id.toString();a in t||(t[a]={description:n.description,part_number:n.part_number,product_name:n.product_name,total_product_quantity:0,num_assigned:0,assignments:[],members:[]}),t[a].total_product_quantity+=parseInt(n.quantity),t[a].members.push(n)}return t}(e);for(var a in e){const r=e[a];if(null!=r.module_list&&0<r.module_list.length)for(var n in r.module_list){var c=r.module_list[n].product_id.toString();if(!(c in t))break;n=r.module_list[n].quantity*r.quantity,n=(t[c].num_assigned+=n,{quantity:n,parent_qty:r.quantity,part_num:r.part_number,product_name:r.product_name,parent_id:r.ji_id});t[c].assignments.push(n)}}return t}function JobDetails({currency:e,job_id:t}){var{data:t,error:a,isLoaded:n}=useFetchWithLoading(url_for_page_load(t,"details"));return a?React.createElement(LoadingErrorUI,{name:"details"}):n?React.createElement(JobDetailsUI,{currency:e,data:t}):React.createElement(LoadingUI,null)}function JobDetailsUI({currency:e,data:t}){return[React.createElement("section",{className:"jobDetails jobPanelSection"},React.createElement("h3",{className:"jobPanelSection_headingWrapper"},React.createElement("span",{className:"jobDetails_headerContent jobPanelSection_headingContent"},"General Details",React.createElement("a",{href:t.url,class:"edit-icon sectionHeadingWrapper_editIcon"},React.createElement("span",null,"edit")))),React.createElement(JobDetailsIdSectionUI,{data:t}),React.createElement(JobDetailsPaymentSectionUI,{currency:e,data:t}),React.createElement(JobDetailsDeliverySectionUI,{data:t}))]}function JobDetailsIdSectionUI({data:e}){return[React.createElement("section",{class:"jobDetails_subsection"},React.createElement("h4",{className:"jobDetails_subsectionHeading jobPanelSection_subsectionHeading"},"Identification"),React.createElement(JobDetailsReadRowUI,{heading:"Name",value:e.name}),React.createElement(JobDetailsReadRowUI,{heading:"Agent",value:e.agent}),React.createElement(JobDetailsReadRowUI,{heading:"Customer",value:e.customer}),React.createElement(JobDetailsReadRowUI,{heading:"Quote ref",value:e.quote_ref}),React.createElement(JobDetailsReadRowUI,{heading:"Country",value:e.country_name}),React.createElement(JobDetailsReadRowUI,{heading:"Language",value:e.language}))]}function JobDetailsPaymentSectionUI({currency:e,data:t}){return[React.createElement("section",{class:"jobDetails_subsection"},React.createElement("h4",{className:"jobDetails_subsectionHeading jobPanelSection_subsectionHeading"},"Payment"),React.createElement(JobDetailsReadRowUI,{heading:"Invoice address",value:t.invoice_to,cssModifier:"wrap"}),React.createElement(JobDetailsReadRowUI,{heading:"Currency",value:e,cssModifier:"wrap"}),React.createElement(JobDetailsReadRowUI,{heading:"Payment terms",value:t.payment_terms,cssModifier:"wrap"}))]}function JobDetailsDeliverySectionUI({data:e}){return[React.createElement("section",{class:"jobDetails_subsection"},React.createElement("h4",{className:"jobDetails_subsectionHeading jobPanelSection_subsectionHeading"},"Delivery"),React.createElement(JobDetailsReadRowUI,{heading:"Delivery address",value:e.delivery_to,cssModifier:"wrap"}),React.createElement(JobDetailsReadRowUI,{heading:"Incoterm",value:e.incoterm_code+" "+e.incoterm_location,cssModifier:"wrap"}))]}function JobDetailsReadRowUI({cssModifier:e,heading:t,value:a}){return[React.createElement("div",{className:"jobDetails_row"+(void 0===e?"":" jobDetails_row-"+e)},React.createElement("span",{class:"jobDetails_rowLabel"},t,": "),React.createElement("span",{className:"jobDetails_rowContent"+(void 0===e?"":" jobDetails_rowContent-"+e)},a))]}function JobPo({actions_po:e,currency:t,difference:a,has_invalid_currency_po:n,job_id:c,modalKit:r,poList:o,total_items_value:i,total_po_value:l}){return[React.createElement("section",{class:"jobPO jobPanelSection"},React.createElement("h3",{className:"jobPanelSection_headingWrapper"},React.createElement("span",{className:"jobPO_headerContent jobPanelSection_headingContent"},"Purchase Orders")),React.createElement("div",{className:"jobPO_content"},React.createElement(JobPoCreate,{actions_po:e,currency:t,modalKit:r}),n?React.createElement(WarningSubSubsectionUI,{message:"All POs should be in the same currency as the job.",title:"Error: Currency Mismatch"}):null,0===a||0===o.length?null:React.createElement(WarningSubSubsectionUI,{message:"Sum of PO values does not match sum of line item selling prices.",title:"Discrepancy"},React.createElement(JobPoDiscrepancyUI,{currency:t,difference:a,poList:o,total_po_value:l,total_items_value:i})),React.createElement(JobPOReceived,{actions_po:e,currency:t,modalKit:r,poList:o,job_id:c})))]}function JobPoCreate({actions_po:e,currency:t,modalKit:a}){const n="create_po_form";return[React.createElement("div",{class:"jobPO_addPO"},React.createElement("button",{id:"toggle_po_form_btn",class:"add-button",onClick:()=>{console.log("click!"),a.open(n)},disabled:a.isOpen()},"New PO"),a.isOpenedBy(n)?React.createElement(JobPoAddNew,{actions_po:e,closePOCreator:()=>a.close(),currency:t}):null)]}function JobPoAddNew({actions_po:e,closePOCreator:t,currency:a}){return React.createElement(JobPoEditor,{closeFn:t,data:{po_id:null,currency:a,date_on_po:null,date_received:null,reference:null,value:null},form_id:"po_form",onDelete:null,onSubmit:e.create,title:"Add PO"})}function JobPoDiscrepancyUI({currency:e,difference:t,total_items_value:a,total_po_value:n}){return[React.createElement("div",{class:"jobPO_comparisonTableWrapper"},React.createElement("h5",{class:"jobPO_comparisonTableHeading"},"Comparison: Items to PO"),React.createElement(PriceComparisonTable,{currency:e,difference:t,first_title:"PO Sum",first_value:n,second_title:"Line Items Sum",second_value:a}))]}function JobPOReceived({actions_po:e,currency:t,modalKit:a,poList:n}){return React.createElement("div",{className:"jobPO_receivedSection"},React.createElement("h4",{className:"jobPO_subsectionHeading jobPanelSection_subsectionHeading"},"Received"),null==n||0===n.length?React.createElement(EmptySectionUI,{css:"jobPage_emptySection",message:"No purchase orders have been entered"}):React.createElement(JobPoTableUI,{actions_po:e,currency:t,modalKit:a,poList:n}))}function JobPoTableUI({actions_po:t,currency:a,modalKit:n,poList:e}){return[React.createElement("div",{class:"jobPO_poListWrapper"},React.createElement("table",{id:"po_table",class:"banded"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Reference"),React.createElement("th",null,"Date on PO"),React.createElement("th",null,"Received"),React.createElement("th",null,"Value"))),React.createElement("tbody",null,e.map(e=>React.createElement(JobPoRow,{key:e.po_id.toString(),actions_po:t,currency:a,data:e,modalKit:n})))))]}function JobPoRow({actions_po:a,currency:e,data:n,modalKit:t}){const c="po_editor_for_id_"+n.po_id;return t.isOpenedBy(c)?React.createElement(JobPoRowEditUI,{data:n,closePOEditor:()=>t.close(),onDelete:async function(){return a.remove(n.po_id)},onSubmit:async function(e,t){return a.update(n.po_id,e,t)}}):React.createElement(JobPoRowReadUI,{currency:e,data:n,openPOEditor:()=>t.open(c),poEditorIsUnavailable:t.isOpen()})}function JobPoRowReadUI({currency:e,data:t,openPOEditor:a,poEditorIsUnavailable:n}){e=t.currency===e;return[React.createElement("tr",{class:e?null:"invalid"},React.createElement("td",{class:"ref"},t.reference),React.createElement("td",{class:"date_on_po"},t.date_on_po),React.createElement("td",{class:"date_received"},t.date_received),React.createElement("td",{class:"value"},e?null:React.createElement(InvalidIconUI,{message:"job has different currency"}),React.createElement("span",{class:"display-text"},t.currency+nbsp()+format_money(parseFloat(t.value)))),React.createElement("td",{class:"edit"},React.createElement("button",{type:"button",class:"po-edit edit-icon",disabled:n,onClick:a},React.createElement("span",null,"edit"))))]}function JobPoRowEditUI({closePOEditor:e,data:t,handle_delete:a,handle_edit:n}){return[React.createElement("tr",null,React.createElement("td",{colspan:5},React.createElement(JobPoEditor,{closeFn:e,data:t,form_id:"po_edit_form",onDelete:a,onSubmit:n,title:"Edit PO"})))]}function JobPriceCheck({currency:e,has_invalid_currency_po:t,itemsActions:a,items_list:n,job_id:c,priceAccepted:r,priceAcceptedActions:o,total_selling:i}){var l=n.reduce((e,t)=>parseFloat(t.list_price_each)*parseInt(t.quantity)+e,0);return React.createElement(JobPriceCheckUI,{itemsActions:a,currency:e,has_invalid_currency_po:t,items_list:n,job_id:c,priceAccepted:r,priceAcceptedActions:o,total_selling:i,total_list:l})}function JobPriceCheckUI({itemsActions:e,currency:t,has_invalid_currency_po:a,items_list:n,priceAccepted:c,priceAcceptedActions:r,total_selling:o,total_list:i}){return[React.createElement("section",{id:"price_check_section",class:"jobPriceCheck jobNarrowSection"},React.createElement(JobSectionHeadingNarrowUI,{text:"Prices"}),0==n.length?React.createElement(EmptySectionUI,{message:"Activates upon entering items",css:"jobPage_emptySection jobNarrowSection_content"}):React.createElement(React.Fragment,null,React.createElement(PriceAcceptanceToggle,{priceAccepted:c,priceAcceptedActions:r}),React.createElement(WarningSubsection,{message:`The figures below assume all item selling prices are in the job currency, ${t}. If a selling price is actually in a different currency, the numbers will be inaccurate.`,show_warning:a,title:"Caution: PO Currency Mismatch"}),React.createElement(JobPriceCheckSummaryUI,{currency:t,total_selling:o,total_list:i}),React.createElement(JobPriceCheckDetails,{itemsActions:e,currency:t,items_list:n})))]}function JobPriceCheckSummaryUI({currency:e,total_list:t,total_selling:a}){return[React.createElement("div",{class:"subsection jobPriceCheckComparison jobNarrowSection_content"},React.createElement("h4",null,"Comparison to List Price"),React.createElement(PriceComparisonTable,{currency:e,difference:a-t,first_title:"Line Items Sum",first_value:a,second_title:"List Prices Sum",second_value:t}))]}function JobPriceCheckDetails({itemsActions:e,currency:t,items_list:a}){var n=useEditor();return[React.createElement("div",{class:"subsection jobPriceCheckDetails jobNarrowSection_content"},React.createElement("h4",null,"Details"),React.createElement("div",{class:"subsection_contentWrapper"},React.createElement("table",{id:"price_check_table",class:"banded"},React.createElement(JobPriceCheckDetailsTableHeadUI,{currency:t}),React.createElement(JobPriceCheckDetailsTableBodyUI,{itemsActions:e,editor:n,items_list:a}))))]}function JobPriceCheckDetailsTableHeadUI({currency:e}){return[React.createElement("thead",null,React.createElement("tr",{class:"upper-h-row"},React.createElement("th",{colspan:4}),React.createElement("th",{colspan:4},"vs. Price List (",e,")"),React.createElement("th",{colspan:4},"vs. Resale (",e,")")),React.createElement("tr",{class:"lower-h-row"},React.createElement("th",null,"id"),React.createElement("th",null,"part #"),React.createElement("th",null,"qty"),React.createElement("th",null,"sold @"),React.createElement("th",null,"version"),React.createElement("th",null,"expected"),React.createElement("th",{colspan:2},"difference"),React.createElement("th",null,"discount"),React.createElement("th",null,"expected"),React.createElement("th",{colspan:2},"difference")))]}function JobPriceCheckDetailsTableBodyUI({itemsActions:t,editor:a,items_list:e}){return[React.createElement("tbody",null,e.map(e=>React.createElement(JobPriceCheckDetailsTableRow,{key:e.ji_id.toString(),data:e,editor:a,itemsActions:t})))]}function JobPriceCheckDetailsTableRow({data:c,editor:e,itemsActions:t}){return React.createElement(JobPriceCheckDetailsRowUI,{calc:(()=>{var e=parseFloat(c.selling_price);const t=parseFloat(c.list_price_each)*parseInt(c.quantity);var a=e-t,n=(e=>{e=1-parseFloat(e)/100;return t*e})(c.resale_perc);return{selling_price:e,list_price:t,difference_list:a,resale_price:n,difference_resale:e-n}})(),data:c,editor:e,itemsActions:t})}function JobPriceCheckDetailsRowUI({calc:e,data:t,editor:a,itemsActions:n}){return[React.createElement("tr",{id:"price_check_row_"+t.ji_id},React.createElement("td",{class:"ji_id"},React.createElement(JobItemIdIcon,{ji_id:t.ji_id})),React.createElement(JobPriceCheckDetailsDescription,{data:t}),React.createElement("td",{class:"qty"},t.quantity),React.createElement(JobPriceCheckDetailsSellingPrice,{calc:e,data:t,editor:a,itemsActions:n}),React.createElement("td",{class:"version"},React.createElement(JobItemPriceListIconSpan,{price_list_name:t.price_list_name})),React.createElement("td",{class:"list-price"},format_money(e.list_price)),React.createElement("td",{class:"list-diff-val"},format_money(e.difference_list)),React.createElement("td",{class:"list-diff-perc"},format_percentage(e.difference_list/e.list_price*100,2)),React.createElement("td",{class:"resale-percentage"},React.createElement(JobItemNameTagSpan,{name:format_percentage(parseFloat(t.resale_perc))})),React.createElement("td",{class:"resale-price"},format_money(e.resale_price)),React.createElement("td",{class:"resale-diff-val"},format_money(e.difference_resale)),React.createElement("td",{class:"resale-diff-perc"},format_percentage(e.difference_resale/e.resale_price*100,2)))]}function JobPriceCheckDetailsDescription({data:e}){const[t,a]=React.useState(!1);return[React.createElement("td",{class:"description"},React.createElement("span",{class:"details-toggle",onClick:function(){var e=!t;a(e)}},e.part_number),t?React.createElement("span",{class:"details"},e.product_name):null)]}function JobPriceCheckDetailsSellingPrice({calc:e,data:t,editor:a,itemsActions:n}){var{backend_error:n,handle_list_click:c,handle_resale_click:r,customPrice:o,handle_change:i,handle_submit:l}=usePriceCheckEditor(e,a.close,n,t.ji_id);const s="job_pricecheck_editor_"+t.ji_id;return[React.createElement("td",{class:"selling-price-container"},n.message?React.createElement(ErrorWithClearUI,{message:n.message,clear:n.clear}):null,React.createElement("span",{class:"selling-price"},format_money(e.selling_price)),React.createElement(JobPriceCheckEditButtonUI,{priceEditorOn:()=>a.open(s),priceEditorIsUnavailable:a.isOpen()}),a.isOpenedBy(s)?React.createElement(JobPriceCheckPriceEditorUI,{calc:e,cancel:a.close,customPrice:o,data:t,handle_change:i,handle_list_click:c,handle_resale_click:r,handle_submit:l}):null)]}function JobPriceCheckEditButtonUI({priceEditorOn:e,priceEditorIsUnavailable:t}){return React.createElement("button",{class:"edit-btn edit-icon",onClick:e,disabled:t},React.createElement("span",null,"edit"))}function JobSummary({actions_comments:e,comments:t,currency:a,items_list:n,modalKit:c,po_list:r,status_data:o,timestamp:i,value:l}){return[React.createElement("section",{id:"job_summary",class:"job-section jobSummary"},React.createElement(JobSectionHeadingUI,{text:"Summary"}),React.createElement("div",{className:"jobSummary_contentsLayout"},React.createElement(SubsectionWrapper,{css:"jobSummaryStatus"},React.createElement("h4",null,"Status"),React.createElement(JobStatusStrip,{statusData:o})),React.createElement("div",{className:"timeValueContainer"},React.createElement(JobSummary_TimeStamp,{timestamp:format_timestamp(i)}),React.createElement(JobSummary_OrderValue,{currency:a,value:l})),React.createElement(CommentsWrapper,{actions:e,comments:null===t?[]:t.filter(e=>e.pinned),css:"jobCommentSection-summary",emptyMessage:"No comments have been pinned",heading:"Pinned",modalKit:c,wantCollapsable:!0}),React.createElement(JobSummary_Items,{currency:a,items_list:n}),React.createElement(JobSummary_CustomerReference,{po_list:r})))]}function SubsectionWrapper({css:e,children:t}){return React.createElement("section",{className:"subsection "+(e??"")},t)}function JobSummary_TimeStamp({timestamp:e}){return React.createElement(SubsectionWrapper,{css:"jobSummaryTimestamp"},React.createElement("h4",null,"Job Opened"),React.createElement("p",{className:"jobSummaryTimestamp_text"},e))}function JobSummary_OrderValue({currency:e,value:t}){return React.createElement(SubsectionWrapper,{css:"jobSummaryOrderValue"},React.createElement("h4",null,"Order Value"),React.createElement("p",{className:"jobSummaryOrderValue_text"},e," ",format_money(t)))}function JobSummary_CustomerReference({po_list:e}){return React.createElement(SubsectionWrapper,{css:"jobSummaryCustomerRef"},React.createElement("h4",null,"Customer Reference",1<e.length?"s":""),React.createElement("ul",{className:"jobSummaryCustomerRef_list"},0===e.length?React.createElement("li",{className:"empty-section-notice"},"TBC"):e.map((e,t)=>React.createElement("li",{key:e+"_"+t,className:"jobSummaryCustomerRef_listItem"},React.createElement("span",{className:"jobSummaryCustomerRef_poRef"},e.reference),React.createElement("span",{className:"jobSummaryCustomerRef_poDated"}," dated "+e.date_on_po)))))}function JobSummary_Items({currency:t,items_list:e}){var a=null!=e&&5<e.length;let n=[];if(null!=e&&0<e.length){const c=e.toSorted((e,t)=>t.selling_price-e.selling_price);n=n=a?c.slice(0,5):c}return React.createElement(SubsectionWrapper,{css:"jobSummaryItems"},React.createElement("h4",null,a?"Top ":"","Items"),React.createElement("ul",{className:"jobSummaryItems_list"},0===n.length?React.createElement("li",{className:"empty-section-notice"},"No items have been entered"):n.map(e=>React.createElement("li",{key:""+e.ji_id,className:"jobSummaryItems_item"},`${e.quantity} x [${e.part_number}] `+e.product_name,React.createElement("span",{className:"jobSummaryItems_price"},` @ ${t} `+format_money(parseFloat(e.selling_price)))))),a?React.createElement("p",{className:"jobSummaryItems_moreItems"},"And more..."):null)}function JobPage(){var{job:e,updateKey:t,fetchProps:a}=useJobState(),n=useEditor(),t=useJobStateUpdater(e,t,n),c=jobCalc(e.poList,e.itemsList,e.currency),r=useJobMenu();return a.error?React.createElement(LoadingErrorUI,{name:"page"}):a.isLoaded&&null!==a.data?React.createElement(JobPageUI,{calc:c,job:e,jobMenu:r,modalKit:n,jobStateUpdaterKit:t}):React.createElement(LoadingUI,null)}function JobPageUI({calc:e,job:t,jobMenu:a,modalKit:n,jobStateUpdaterKit:c}){return[React.createElement(JobPageWrapperUI,{job:t,jobMenu:a},c.errors.showError?React.createElement(ErrorModal,{message:c.errors.message,clear:c.errors.clear}):null,React.createElement(JobContentsUI,{calc:e,job:t,jobMenu:a,modalKit:n,jobStateUpdaterKit:c}))]}function JobPageWrapperUI({job:e,jobMenu:t,children:a}){return[React.createElement("div",{className:"jobPage"},React.createElement(JobSideNav,{activeTab:t.activeTab,close:t.close,isOpen:t.isOpen,job_id:e.id,names:e.names,TABS:t.TABS,updateActiveTab:t.updateActiveTab}),t.isOpen?null:React.createElement(BurgerMenuIcon,{open:t.open}),React.createElement(JobPageContentsWrapper,null,React.createElement(JobHeadingUI,{customer_via_agent:e.names.customer_via_agent,job_name:e.names.job_name}),a))]}function JobPageContentsWrapper({children:e}){return React.createElement("div",{className:"jobPageContentsWrapper"},e)}function JobHeadingUI({customer_via_agent:e,job_name:t}){return[React.createElement("div",{class:"jobPageHeading"},React.createElement("h2",{className:"pageHeading jobPageHeading_heading"},"Job ",t),React.createElement(JobSubHeadingUI,{customer_via_agent:e}))]}function JobSubHeadingUI({customer_via_agent:e}){return""===e?null:React.createElement("div",{class:"jobPageHeading_subheading subheading"},e)}function JobSectionHeadingUI({text:e}){return React.createElement("h3",{className:"sectionHeading"},e)}function JobSectionHeadingNarrowUI({text:e}){return React.createElement("h3",{className:"sectionHeading jobNarrowSection_header"},React.createElement("span",{className:"jobNarrowSection_headerText"},e))}function JobContentsUI({calc:e,job:t,jobMenu:a,modalKit:n,jobStateUpdaterKit:c}){var r=a.TAB_NAMES;return a.activeTab===r.detailsAndPO?React.createElement(JobDetailsAndPO,{actions_po:c.po,currency:t.currency,difference:e.difference,has_invalid_currency_po:e.has_invalid_currency_po,job_id:t.id,modalKit:n,poList:t.poList,total_po_value:e.total_po_value,total_items_value:e.total_items_value}):a.activeTab===r.comments?React.createElement(JobComments,{comments:t.comments,commentsActions:c.comments,modalKit:n}):a.activeTab===r.docs_out?React.createElement(JobDocumentsUI,{docList:t.docList,docQuantities:t.doc_quantities,totalQuantityAllItems:e.total_qty_all_items,URL_DOCS:t.URL_DOCS}):a.activeTab===r.items?React.createElement(JobItemsUI,{actions_items:c.jobItems,items_list:t.itemsList,job_id:t.id,currency:t.currency,modalKit:n,URL_MODULE_MANAGEMENT:t.URL_MODULE_MANAGEMENT}):a.activeTab===r.pricecheck?React.createElement(JobPriceCheck,{currency:t.currency,has_invalid_currency_po:e.has_invalid_currency_po,itemsActions:c.jobItems,items_list:t.itemsList,job_id:t.id,priceAccepted:t.priceAccepted,priceAcceptedActions:c.priceAccepted,total_selling:e.total_items_value}):React.createElement(JobSummary,{actions_comments:c.comments,currency:t.currency,comments:t.comments,items_list:t.itemsList,modalKit:n,po_list:t.poList,status_data:createStatusData(e,t),timestamp:t.timestamp,username:t.username,value:e.total_items_value})}function jobCalc(e,t,a){var n=e.reduce((e,t)=>t.currency===a?parseFloat(t.value)+e:e,0),c=t.reduce((e,t)=>parseFloat(t.selling_price)+e,0);return{difference:n-c,total_items_value:c,total_po_value:n,has_invalid_currency_po:!e.every(e=>e.currency===a),total_qty_all_items:t.reduce((e,t)=>parseInt(t.quantity)+e,0)}}function createStatusData(e,t){return{po_count:t.poList.length,value_difference_po_vs_items:e.value_difference_po_vs_items,total_qty_all_items:e.total_qty_all_items,has_invalid_currency_po:e.has_invalid_currency_po,price_accepted:t.priceAccepted,items_list:t.itemsList,doc_list:t.docList,doc_quantities:t.doc_quantities}}console.log(window),console.log(ReactRouterDOM);const{createBrowserRouter,RouterProvider}=window.ReactRouterDOM,router=createBrowserRouter([{path:"/",element:React.createElement("div",null,"hello world")}]);ReactDOM.createRoot(document.querySelector(".job-page")).render(React.createElement(React.StrictMode,null,React.createElement(RouterProvider,{router:router})));