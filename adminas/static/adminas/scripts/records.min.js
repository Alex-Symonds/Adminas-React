const ID_BEGIN_FILTER_BUTTON="id_filter_records",ID_FILTER_OPTIONS_ELE="id_filter_options",CLASS_FILTER_OPTIONS_BODY="filter-options-body",ID_FILTER_CONTROLS_CONTAINER="filter_controls",ID_PREFIX_FILTER_FIELDS="id_filter_",FALLBACK_STR="-",RANGE_START="s",RANGE_END="e",RECORDS_FILTER_SETTINGS=[{title:"Job Reference",input_type:"single-text",id:"ref_job"},{title:"PO Reference",input_type:"single-text",id:"ref_po"},{title:"Quote Reference",input_type:"single-text",id:"ref_quote"},{title:"Customer",input_type:"select",id:"customer"},{title:"Agent",input_type:"select",id:"agent"},{title:"Date of Entry",input_type:"range-date",id:"date"}];async function open_filter_options(){let e=document.getElementById(ID_FILTER_CONTROLS_CONTAINER);var t=await create_ele_filter_options(),t=create_generic_modal(t);e.append(t),open_modal(t)}async function create_ele_filter_options(){let e=document.createElement("form");e.id=ID_FILTER_OPTIONS_ELE,e.append(create_ele_filter_options_heading());const t=document.createElement("div");return t.classList.add(CSS_MODAL_CONTENTS),t.classList.add("recordsFilter_formContents"),t.classList.add("formy"),t.append(await create_ele_filter_options_body()),t.append(create_ele_filter_options_submit()),e.append(t),e}function create_ele_filter_options_heading(){let e=document.createElement("h4");return e.classList.add(CSS_MODAL_HEADING),e.innerHTML="Filter Options",e}async function create_ele_filter_options_body(){let t=document.createElement("div");t.classList.add("formy_inputsContainer");for(let e=0;e<RECORDS_FILTER_SETTINGS.length;e++)"single-text"===RECORDS_FILTER_SETTINGS[e].input_type?t.append(create_ele_filter_option_text_input(RECORDS_FILTER_SETTINGS[e])):"select"===RECORDS_FILTER_SETTINGS[e].input_type?t.append(await create_filter_option_select(RECORDS_FILTER_SETTINGS[e])):"range-date"===RECORDS_FILTER_SETTINGS[e].input_type&&t.append(create_ele_filter_option_date_range(RECORDS_FILTER_SETTINGS[e]));return t}function create_ele_filter_options_submit(){const e=document.createElement("div"),t=(e.classList.add("formControls"),create_generic_ele_submit_button());return t.classList.add("button-primary"),t.classList.add("formControls_submit"),t.classList.add("recordsFilter_submit"),t.type="button",t.innerHTML="apply filter",t.addEventListener("click",()=>{reload_page_with_filters()}),t}function create_ele_filter_option_base(e){const t=create_formy_labelFieldContainer(),_=create_generic_ele_label(e.title,ID_PREFIX_FILTER_FIELDS+e.id);return _.classList.add("formy_label"),t.append(_),t}function create_formy_labelFieldContainer(){const e=document.createElement("div");return e.classList.add("formy_labelFieldContainer"),e}function create_ele_filter_option_text_input(e){let t=create_ele_filter_option_base(e),_=document.createElement("input");return _.type="text",_.id=ID_PREFIX_FILTER_FIELDS+e.id,t.append(_),t}function create_ele_filter_option_date_range(e){let t=document.createElement("fieldset"),_=document.createElement("legend");_.classList.add("formy_label"),_.innerHTML=e.title,t.append(_);const n=document.createElement("div"),r=(n.classList.add("recordsFilter_fieldsetContainer"),create_formy_labelFieldContainer());var i=""+ID_PREFIX_FILTER_FIELDS+RANGE_START+e.id;r.append(create_generic_ele_label("From",i)),r.append(create_ele_filter_option_date_input(i)),n.append(r);const a=create_formy_labelFieldContainer();i=""+ID_PREFIX_FILTER_FIELDS+RANGE_END+e.id;return a.append(create_generic_ele_label("To",i)),a.append(create_ele_filter_option_date_input(i)),n.append(a),t.append(n),t}function create_ele_filter_option_date_input(e){let t=document.createElement("input");return t.type="date",t.id=e,t}async function create_filter_option_select(e){let t=create_ele_filter_option_base(e),_=document.createElement("select"),n=(_.id=ID_PREFIX_FILTER_FIELDS+e.id,document.createElement("option"));n.selected=!0,n.value="0",n.innerHTML="---------",_.append(n);e=await get_options_from_server(e.id);if(status_is_good(e,200)){var r=e.opt_list;for(let e=0;e<r.length;e++){var i=document.createElement("option");i.value=r[e].id,i.innerHTML=r[e].display_str,_.append(i)}t.append(_)}else{e=create_generic_ele_dismissable_error(e,"Error: failed to load dropdown.");t.append(e)}return t}async function get_options_from_server(e){e=await fetch(URL_SELECT_OPTIONS+`?type=select_options_list&name=${e}s`).catch(e=>{console.log("Error: ",e)});return get_json_with_status(e)}function reload_page_with_filters(){var e=get_parameters_string_from_records_filter_inputs();window.location.href=""+URL_RECORDS+e}function get_parameters_string_from_records_filter_inputs(){var _=format_records_filter_options_as_list();if(0<_.length){let t="?"+_[0];for(let e=1;e<_.length;e++)t+="&"+_[e];return t}return""}function format_records_filter_options_as_list(){let t=[];for(let e=0;e<RECORDS_FILTER_SETTINGS.length;e++){var _="",n=document.getElementById(ID_PREFIX_FILTER_FIELDS+RECORDS_FILTER_SETTINGS[e].id);null!==n?"single-text"===RECORDS_FILTER_SETTINGS[e].input_type?_=get_param_from_input(RECORDS_FILTER_SETTINGS[e].id,n.value):"select"===RECORDS_FILTER_SETTINGS[e].input_type&&(_=get_param_from_select(RECORDS_FILTER_SETTINGS[e].id,n.value)):"range-date"===RECORDS_FILTER_SETTINGS[e].input_type&&(_=get_param_from_range(ID_PREFIX_FILTER_FIELDS,RECORDS_FILTER_SETTINGS[e].id)),""!==_&&t.push(_)}return console.log("get_param_list",t),t}function get_param_from_input(e,t){return""!==t?create_string_get_param(e,t):""}function get_param_from_select(e,t){return"0"!==t?create_string_get_param(e,t):""}function get_param_from_range(e,t){let _="",n=document.getElementById(e+RANGE_START+t);return null!==n&&(_+=get_param_from_input(RANGE_START+t,n.value)),null!==(n=document.getElementById(e+RANGE_END+t))&&(""!==_&&(_+="&"),_+=get_param_from_input(RANGE_END+t,n.value)),_}function create_string_get_param(e,t){return e+"="+t}document.addEventListener("DOMContentLoaded",()=>{document.getElementById(ID_BEGIN_FILTER_BUTTON).addEventListener("click",()=>{open_filter_options()})});const CLASS_BTN_SHOW_PRODUCT_LIST="list-show-btn",CLASS_BTN_HIDE_PRODUCT_LIST="list-hide-btn",CLASS_PRODUCT_LIST="records-list";function toggle_hide_product_list_panel(e,t){let _=e.closest("td"),n=_.querySelector("."+CLASS_PRODUCT_LIST);e=n.classList.contains(CSS_HIDE);e&&!t?n.classList.remove(CSS_HIDE):!e&&t&&n.classList.add(CSS_HIDE)}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("."+CLASS_BTN_SHOW_PRODUCT_LIST).forEach(e=>{e.addEventListener("click",e=>{toggle_hide_product_list_panel(e.target,!1)})}),document.querySelectorAll("."+CLASS_BTN_HIDE_PRODUCT_LIST).forEach(e=>{e.addEventListener("click",e=>{toggle_hide_product_list_panel(e.target,!0)})})});