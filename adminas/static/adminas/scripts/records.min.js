const ID_BEGIN_FILTER_BUTTON="id_filter_records",ID_FILTER_OPTIONS_ELE="id_filter_options",CLASS_FILTER_OPTIONS_BODY="filter-options-body",ID_FILTER_CONTROLS_CONTAINER="filter_controls",ID_PREFIX_FILTER_FIELDS="id_filter_",CSS_CLASS_RECORDS_FILTER_WRAPPER="recordsFilterWrapper",FALLBACK_STR="-",RANGE_START="s",RANGE_END="e",RECORDS_FILTER_SETTINGS=[{title:"Job Reference",input_type:"single-text",id:"ref_job"},{title:"PO Reference",input_type:"single-text",id:"ref_po"},{title:"Quote Reference",input_type:"single-text",id:"ref_quote"},{title:"Customer",input_type:"select",id:"customer"},{title:"Agent",input_type:"select",id:"agent"},{title:"Date of Entry",input_type:"range-date",id:"date"}];async function open_filter_options(){const e=document.querySelector("."+CSS_CLASS_RECORDS_FILTER_WRAPPER);var t=await create_ele_filter_options(),t=create_generic_modal(t);e.append(t),open_modal(t)}async function create_ele_filter_options(){let e=document.createElement("form");e.id=ID_FILTER_OPTIONS_ELE,e.append(create_ele_filter_options_heading());const t=document.createElement("div");return t.classList.add(CSS_MODAL_CONTENTS),t.classList.add("recordsFilter_formContents"),t.classList.add("formy"),t.append(await create_ele_filter_options_body()),t.append(create_ele_filter_options_submit()),e.append(t),e}function create_ele_filter_options_heading(){let e=document.createElement("h4");return e.classList.add(CSS_MODAL_HEADING),e.innerHTML="Filter Options",e}async function create_ele_filter_options_body(){let t=document.createElement("div");t.classList.add("formy_inputsContainer");for(let e=0;e<RECORDS_FILTER_SETTINGS.length;e++)"single-text"===RECORDS_FILTER_SETTINGS[e].input_type?t.append(create_ele_filter_option_text_input(RECORDS_FILTER_SETTINGS[e])):"select"===RECORDS_FILTER_SETTINGS[e].input_type?t.append(await create_filter_option_select(RECORDS_FILTER_SETTINGS[e])):"range-date"===RECORDS_FILTER_SETTINGS[e].input_type&&t.append(create_ele_filter_option_date_range(RECORDS_FILTER_SETTINGS[e]));return t}function create_ele_filter_options_submit(){const e=document.createElement("div"),t=(e.classList.add("formControls"),create_generic_ele_submit_button());return t.classList.add("button-primary"),t.classList.add("formControls_submit"),t.classList.add("recordsFilter_submit"),t.type="button",t.innerHTML="apply filter",t.addEventListener("click",()=>{reload_page_with_filters()}),t}function create_ele_filter_option_base(e){const t=create_formy_labelFieldContainer(),n=create_generic_ele_label(e.title,ID_PREFIX_FILTER_FIELDS+e.id);return n.classList.add("formy_label"),t.append(n),t}function create_formy_labelFieldContainer(){const e=document.createElement("div");return e.classList.add("formy_labelFieldContainer"),e}function create_ele_filter_option_text_input(e){let t=create_ele_filter_option_base(e),n=document.createElement("input");return n.type="text",n.id=ID_PREFIX_FILTER_FIELDS+e.id,t.append(n),t}function create_ele_filter_option_date_range(e){let t=document.createElement("fieldset"),n=(t.classList.add("recordsFilter_fieldset"),document.createElement("legend"));n.classList.add("formy_label"),n.innerHTML=e.title,t.append(n);const _=document.createElement("div"),r=(_.classList.add("recordsFilter_fieldsetContainer"),create_formy_labelFieldContainer());var i=""+ID_PREFIX_FILTER_FIELDS+RANGE_START+e.id;r.append(create_generic_ele_label("From",i)),r.append(create_ele_filter_option_date_input(i)),_.append(r);const o=create_formy_labelFieldContainer();i=""+ID_PREFIX_FILTER_FIELDS+RANGE_END+e.id;return o.append(create_generic_ele_label("To",i)),o.append(create_ele_filter_option_date_input(i)),_.append(o),t.append(_),t}function create_ele_filter_option_date_input(e){let t=document.createElement("input");return t.type="date",t.id=e,t}async function create_filter_option_select(e){let t=create_ele_filter_option_base(e),n=document.createElement("select"),_=(n.id=ID_PREFIX_FILTER_FIELDS+e.id,document.createElement("option"));_.selected=!0,_.value="0",_.innerHTML="---------",n.append(_);e=await get_options_from_server(e.id);if(status_is_good(e,200)){var r=e.opt_list;for(let e=0;e<r.length;e++){var i=document.createElement("option");i.value=r[e].id,i.innerHTML=r[e].display_str,n.append(i)}t.append(n)}else{e=create_generic_ele_dismissable_error(e,"Error: failed to load dropdown.");t.append(e)}return t}async function get_options_from_server(e){e=await fetch(URL_SELECT_OPTIONS+`?type=select_options_list&name=${e}s`).catch(e=>{console.log("Error: ",e)});return get_json_with_status(e)}function reload_page_with_filters(){var e=get_parameters_string_from_records_filter_inputs();window.location.href=""+URL_RECORDS+e}function get_parameters_string_from_records_filter_inputs(){var n=format_records_filter_options_as_list();if(0<n.length){let t="?"+n[0];for(let e=1;e<n.length;e++)t+="&"+n[e];return t}return""}function format_records_filter_options_as_list(){let t=[];for(let e=0;e<RECORDS_FILTER_SETTINGS.length;e++){var n="",_=document.getElementById(ID_PREFIX_FILTER_FIELDS+RECORDS_FILTER_SETTINGS[e].id);null!==_?"single-text"===RECORDS_FILTER_SETTINGS[e].input_type?n=get_param_from_input(RECORDS_FILTER_SETTINGS[e].id,_.value):"select"===RECORDS_FILTER_SETTINGS[e].input_type&&(n=get_param_from_select(RECORDS_FILTER_SETTINGS[e].id,_.value)):"range-date"===RECORDS_FILTER_SETTINGS[e].input_type&&(n=get_param_from_range(ID_PREFIX_FILTER_FIELDS,RECORDS_FILTER_SETTINGS[e].id)),""!==n&&t.push(n)}return t}function get_param_from_input(e,t){return""!==t?create_string_get_param(e,t):""}function get_param_from_select(e,t){return"0"!==t?create_string_get_param(e,t):""}function get_param_from_range(e,t){let n="",_=document.getElementById(e+RANGE_START+t);return null!==_&&(n+=get_param_from_input(RANGE_START+t,_.value)),null!==(_=document.getElementById(e+RANGE_END+t))&&(""!==n&&(n+="&"),n+=get_param_from_input(RANGE_END+t,_.value)),n}function create_string_get_param(e,t){return e+"="+t}document.addEventListener("DOMContentLoaded",()=>{document.getElementById(ID_BEGIN_FILTER_BUTTON).addEventListener("click",()=>{open_filter_options()})}),document.addEventListener("DOMContentLoaded",()=>{{const e=document.querySelectorAll(".recordsTable_productsButton");null!==e&&e.forEach(t=>{t.addEventListener("click",()=>{var e=findModalWrapperFromParent(t.parentNode);open_modal(e)})})}findAllModalCloseButtons().forEach(e=>{setupModalCloseButton(e)})}),document.addEventListener("DOMContentLoaded",()=>{const e="scrollingShadowsWrapper",t="scrollingShadowsWrapper_scrollable",_="--opacityStart",r="--opacityEnd";let i=!1;function n(){var e=null!==(e=d())&&e.scrollWidth>e.clientWidth;if(e&&!i){const t=d();null!==t&&(l(),t.addEventListener("scroll",()=>{l()}),i=!0)}else if(!e&&i){o(0,0);const n=d();null!==n&&n.removeEventListener("scroll",()=>{l()});i=!1}}function o(e,t){const n=a();null!==n&&(n.style.setProperty(_,e),n.style.setProperty(r,t))}function l(){var e,t=d(),n=(n=t,e=a(),null!==n&&null!==e?n.scrollWidth-e.offsetWidth:0);0!=n&&o(e=t.scrollLeft/n,1-e)}function a(){return document.querySelector("."+e)}function d(){return document.querySelector("."+t)}n(),window.addEventListener("resize",()=>{n()})});