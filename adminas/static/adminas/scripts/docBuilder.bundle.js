(()=>{"use strict";var e={450:(e,t,n)=>{n.d(t,{B:()=>u,T:()=>i});var o=n(686),c=n(60);const r={itemWrapper:"docItemEditor",maxButton:"docItemEditor_maxBtn",minButton:"docItemEditor_minBtn",qtyInput:"docItemEditor_qtyInput",itemWrapperExcluded:"docItemEditor-excluded",invalidMessage:"documentPageItems_invalidIcon",invalidMinBtn:"docItemEditor_minBtn-invalid",invalidMaxBtn:"docItemEditor_maxBtn-invalid",itemDisplayText:"docItemEditor_itemDisplayText",itemQtySpan:"docItemEditor_itemDisplayQty",itemPartNo:"docItemEditor_itemDisplayPartNo",itemPartNoExcluded:"partNumber-disabled",inputsContainer:"docItemEditor_itemInputsContainer",inputErrorTooltip:"docItemEditor_qtyErrorTooltip"},i=r.itemWrapper;function s(e){(0,o.Tk)().on();const t=function(e){return{value:""===e.value?0:parseInt(e.value),max:parseInt(e.max),min:parseInt(e.min)}}(e),n=d(e);e.checkValidity()||(function(e,t){const n=e.querySelector(`.${r.inputsContainer}`),o=function(e,t){const n=parseInt(e.dataset.totalqty),o=parseInt(e.dataset.availableqty),c=parseInt(t);let r=`${t} is an invalid input`;return""===t&&(r="Invalid input, setting to 0."),c>o&&c<=n?r+=` (${n-o}/${n} are assigned to other documents)`:c>n&&(r+=` (there are only ${n} in total on the job)`),r}(e,t),i=(0,c.Me)(o);i.classList.add(r.inputErrorTooltip),n.append(i)}(n,e.value),function(e,t){const{value:n,max:o,min:c}=t;let r=0;isNaN(n)||isNaN(o)||isNaN(c)?""===e.value&&(r=0):r=n>o?o:c,e.value=r.toString()}(e,t));const{maxBtn:i,minBtn:s}=l(n);!function(e,t,n){const{value:o,max:c,min:r}=n;return i(e,o>=c),void i(t,o<=r);function i(e,t){t&&!e.disabled?e.disabled=!0:!t&&e.disabled&&(e.disabled=!1)}}(i,s,t),function(e,t){e.querySelector(`.${r.itemQtySpan}`).textContent=t}(n,e.value),function(e,t){const{value:n}=t,o=e.querySelector(`.${r.itemPartNo}`);a({ele:o,hasCSS:o.classList.contains(r.itemPartNoExcluded),wantCSS:0===n,oneCSSClass:r.itemPartNoExcluded})}(n,t),function(e,t){const{value:n}=t;a({ele:e,hasCSS:e.classList.contains(r.itemWrapperExcluded),wantCSS:0===n,oneCSSClass:r.itemWrapperExcluded})}(n,t),function(e){e.dataset.isinvalid&&(function(e){const{maxBtn:t,minBtn:n}=l(e);t.classList.remove(r.invalidMaxBtn),n.classList.remove(r.invalidMinBtn)}(e),function(e){const t=function(e){const t=e.querySelectorAll(`.${r.invalidMessage}`);return 0===t.length?null:t[0]}(e);null!==t&&t.remove()}(e),e.setAttribute("data-isinvalid",!1))}(n)}function a(e){let{ele:t,hasCSS:n,wantCSS:o,oneCSSClass:c}=e;n&&!o?t.classList.remove(c):!n&&o&&t.classList.add(c)}function u(e){return e.querySelector(`.${r.qtyInput}`)}function d(e){return e.closest(`.${r.itemWrapper}`)}function l(e){return{maxBtn:e.querySelector(`.${r.maxButton}`),minBtn:e.querySelector(`.${r.minButton}`)}}document.addEventListener("DOMContentLoaded",(()=>{document.querySelectorAll(`.${r.maxButton}`).forEach((e=>e.addEventListener("click",(()=>{!function(e){const t=u(d(e));t.value=t.max,s(t)}(e)})))),document.querySelectorAll(`.${r.minButton}`).forEach((e=>e.addEventListener("click",(()=>{!function(e){const t=u(d(e));t.value=t.min,s(t)}(e)})))),document.querySelectorAll(`.${r.qtyInput}`).forEach((e=>e.addEventListener("input",(()=>{s(e)}))))}))},686:(e,t,n)=>{n.d(t,{Tk:()=>h});var o=n(60),c=n(669),r=n(450);const i="modal",s="closeButton",a="modalWrapper",u="modal_heading";function d(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const c=function(){let e=document.createElement("div");return e.classList.add(a),e.classList.add(o.XL),e}();""!==t&&null!=t&&(c.className=`${c.className} ${t}`);const r=function(){let e=document.createElement("dialog");return e.classList.add(i),e}(),u=(0,o.Qp)();return u.classList.add(`${i}_${s}`),u.addEventListener("click",(()=>{null!==n&&n(),function(e){let{dialog:t,wrapper:n}=e;null==n||n?.classList.contains(o.XL)||n?.classList.add(o.XL),null!=t&&t?.close()}({dialog:r,wrapper:c})})),r.append(u),r.append(e),c.append(r),c}function l(e){let t;return t="number"!=typeof e||e>6||e<1?document.createElement("h2"):document.createElement(`h${e}`),t.classList.add(u),t}function m(e){e.classList.remove(o.XL),e.querySelector(`.${i}`).show()}const p="no-special-instructions",f="editSpecialInstructionModal",v="editSpecialInstructionModal_contents",L="documentPageSpecialInstructions_specialInstructionContainer",S="documentPageSpecialInstructions_specialInstructionContents";function y(e){const t=function(e){const t={};t.reference=document.querySelector("#id_doc_reference").value,t.issue_date=e,t.assigned_items=function(){const e=document.querySelectorAll(`.${r.T}`),t={};return e.forEach((e=>{const n=String(e.dataset.jiid),o=(0,r.B)(e),c=parseInt(o.value);t[n]=isNaN(c)?0:c})),t}(),t.special_instructions=function(){const e=[],t=document.querySelector(".documentPageSpecialInstructions").querySelector(".existing");return Array.from(t.children).forEach((t=>{if(!t.classList.contains(p)){let n={};n.id=t.hasAttribute("data-siid")?t.dataset.siid:0,n.contents=t.querySelector(`.${S}`).innerHTML,e.push(n)}})),e}();const n=g("id_req_prod_date");null!==n&&(t.req_prod_date=n);const o=g("id_sched_prod_date");return null!==o&&(t.sched_prod_date=o),t}(e);"0"===DOC_ID?E("POST",201,t,`job=${JOB_ID}&type=${DOC_CODE}`):E("PUT",204,t,`id=${DOC_ID}`)}async function E(e,t,n,r){const i=(0,o.YG)(e,n),s=await(0,o.Fl)(`${URL_DOCBUILDER}?${r}`,i);(0,o.au)(s,t)?201===t?window.location.href=s[o.Sx]:async function(e){const t=await(0,o.m8)(e);if((0,o.au)(t,200)&&"doc_is_issued"in t){if(!0===t.doc_is_issued)return void(window.location.href=window.URL_DOCMAIN);if(h().off(),"doc_is_valid"in t&&"item_is_valid"in t)return n=t.doc_is_valid,r=t.item_is_valid,function(e){const t=document.querySelector(".documentPageWarnings_invalid");!0===e&&null!==t&&(t.remove(),document.querySelector(".issueFinalIconTextButton").removeAttribute("disabled"))}(n),function(e){const t="invalid";document.querySelectorAll(`.${t}`).forEach((n=>{const o=n.dataset.jiid;o in e&&!0===e[o]&&(n.classList.remove(t),n.querySelector(".invalid-icon").remove())}))}(r),void(0,c.t)("Document saved")}var n,r;(0,c.t)("Page display error: refresh is recommended.",!0)}(`${URL_DOCBUILDER}?${r}`):(0,c.t)(s,!0)}function g(e){const t=document.getElementById(e);if(t){var n=t.value;return""==n?"":n}return null}function _(){return document.querySelector(".saveIconTextButton")}function h(){const e="documentPageWarnings_unsavedChanges",t=`${e}-off`,n=`${e}-on`;function o(){return document.querySelector(`.${e}`)}return{on:function(){const e=o();e.classList.contains(t)&&(e.classList.remove(t),e.classList.add(n),e.innerHTML="Warning: unsaved changes exist");const c=_();null!==c&&(c.disabled=!1)},off:function(){const e=o();e.classList.contains(n)&&(e.classList.remove(n),e.classList.add(t),e.innerHTML="");const c=_();null!==c&&(c.disabled=!0)}}}function I(e){(0,o.X7)(o.lJ);const t=e.parentElement,n=function(e){let t=document.createElement("div");t.classList.add(v);const n=l(2);n.textContent="Special Instructions",t.append(n);const c="id_specialInstructionContentInEditMode",r=function(){let e=document.createElement("form");return e.classList.add("documentPageSpecialInstructions_form"),e.method="post",e}();return r.append(function(e){const t=document.createElement("label");return t.classList.add("documentPageSpecialInstructions_label"),t.htmlFor=e,t.textContent="Edit special instruction",t}(c)),r.append(function(e,t){let n=document.createElement("textarea");return n.id=t,n.classList.add("documentPageSpecialInstructions_textarea"),n.innerHTML=e,n}(e,c)),r.append(function(){let e=document.createElement("div");return e.classList.add("documentPageSpecialInstructions_controlsContainer"),e.append(function(){let e=(0,o.O9)();return e.innerHTML="change",e.type="button",e.classList.add("documentPageSpecialInstructions_button"),e.addEventListener("click",(e=>{!function(e){const t=e.closest(`.${v}`).querySelector("textarea").value,n=e.closest(`.${L}`).querySelector(`.${S}`);n.innerHTML=t,n.classList.remove(o.XL),q(),h().on()}(e.target)})),e}()),e.append(function(){let e=(0,o.N$)();return e.type="button",e.classList.add("documentPageSpecialInstructions_button"),e.setAttribute("data-siid","0"),e.addEventListener("click",(e=>{!function(e){e.closest("."+L).remove(),$(),h().on()}(e.target)})),e}()),e}()),t.append(r),t}(t.querySelector(`.${S}`).innerHTML),c=d(n,f,q);t.prepend(c),m(c)}function q(){const e=document.querySelectorAll(`.${f}`);1===e.length&&e[0].remove(),(0,o.kB)(o.lJ)}function $(){let e=document.querySelector(".documentPageSpecialInstructions"),t=e.querySelector(`.${p}`),n=null==e.querySelector("."+L),o=null!=t;n&&!o?document.querySelector(".existing").append(function(){let e=document.createElement("p");return e.classList.add(p),e.innerHTML="No special instructions on this document",e}()):!n&&o&&t.remove()}document.addEventListener("DOMContentLoaded",(()=>{!function(){_()?.addEventListener("click",(()=>{y(null)})),document.querySelector(".issueFinalIconTextButton").addEventListener("click",(e=>{!function(e){const t=d(function(){const e=document.createElement("div");e.classList.add("docBuilderIssueDoc");const t=l(2);t.textContent="Issue Final",e.append(t);const n=function(){const e=document.createElement("form");return e.classList.add("docBuilderIssueDoc_form"),e.append(function(){const e=document.createElement("div");e.classList.add("docBuilderIssueDoc_formRow");const t="id_docBuilder_issueDate";return e.append(function(e){const t=document.createElement("label");return t.htmlFor=e,t.textContent="Issue Date",t}(t)),e.append(function(e){const t=document.createElement("input");t.id=e,t.classList.add("issue-date"),t.type="date";const n=new Date,o=`${n.getFullYear()}-${n.getMonth()+1}-${n.getDate()}`;return t.value=o,t}(t)),e}()),e.append(function(){const e=(0,o.O9)();return e.classList.add("docBuilderIssueDoc_submitBtn"),e.type="button",e.innerHTML="issue",e.addEventListener("click",(e=>{y(e.target.parentElement.querySelector("input").value)})),e}()),e}();return e.append(n),e}(),"",null);e.target.after(t),m(t)}(e)})),document.querySelector(".deleteIconTextButton").addEventListener("click",(()=>{!async function(){if(window.confirm("Deleting a document cannot be undone except by a system administrator. Are you sure?")){let e=(0,o.YG)("DELETE");try{let t=await(0,o.Fl)(`${URL_DOCBUILDER}?id=${DOC_ID}`,e);(0,o.au)(t,204)?window.location.href=JOB_DOCTAB_URL:(0,c.t)(t)}catch(e){(0,c.t)("Delete failed. Try again later.",!0)}}}()})),null!=document.querySelector(".documentPageGeneral")&&document.querySelectorAll("input").forEach((e=>{e.addEventListener("input",(()=>{h().on()}))}));const e="addNewSpecialInstructionModal";function t(){(0,o.kX)(e);const t=document.querySelectorAll(`.${e}`);if(1===t.length){const e=t[0].querySelectorAll(`.${i}`)[0];e?.close()}}document.querySelector(".openCreateSpecialInstruction")?.addEventListener("click",(()=>{(0,o.xY)(e);const t=document.querySelectorAll(`.${e}`);if(1===t.length){const e=t[0].querySelectorAll(`.${i}`)[0];e?.show()}})),document.querySelector(".close-new-instr")?.addEventListener("click",(()=>{t()})),document.querySelector(".add-special-instruction-btn").addEventListener("click",(()=>{!function(){const e=document.querySelector(".addNewSpecialInstructionModal").querySelector("textarea"),t=e.value;e.value="";const n=document.querySelector(".existing"),c=function(e){const t=function(){const e=document.createElement("div");return e.classList.add(L),e}();return t.append(function(e){const t=document.createElement("div");return t.classList.add(S),t.innerHTML=e,t}(e)),t.append(function(){const e=(0,o.gA)();return e.classList.add("documentPageSpecialInstructions_specialInstructionEditBtn"),e.setAttribute("data-siid","0"),e.addEventListener("click",(e=>{I(e.target)})),e}()),t.append(function(){const e=document.createElement("div");e.classList.add("documentPageSpecialInstructions_specialInstructionWhoAndWhen");const t=document.createElement("span");t.classList.add("username"),t.innerHTML="You",e.append(t);const n=document.createTextNode(" on ");e.append(n);const c=document.createElement("span");return c.classList.add("when"),c.innerHTML=(0,o.sT)(),e.append(c),e}()),t}(t);n.prepend(c),$(),h().on()}(),t()})),document.querySelectorAll(".documentPageSpecialInstructions_specialInstructionEditBtn").forEach((e=>{e.addEventListener("click",(e=>{I(e.target)}))}))}()}))},669:(e,t,n)=>{n.d(t,{t:()=>c});var o=n(60);function c(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n="documentResponseMessage",c="documentResponseMessage-error",r="documentResponseMessage-neutral",i="documentResponseMessage_content",s="documentResponseMessage_timestamp",a=document.querySelector(".documentWarnings"),u=function(){let e=document.querySelector(`.${n}`);return null===e&&(e=function(){const e=function(){const e=document.createElement("div");return e.classList.add(n),e}(),t=function(){const e=document.createElement("p");return e.classList.add(i),e}();e.append(t);const c=function(){const e=document.createElement("p");return e.classList.add(s),e}();e.append(c);const r=function(){const e=(0,o.Qp)();return e.classList.add("documentResponseMessage_closeBtn"),e}();return r.addEventListener("click",(()=>{e.remove()})),e.append(r),e}(),a.append(e)),e}(),d=function(){let n="Something went wrong, try refreshing the page",o=c;return"string"==typeof e?(n=e,o=t?c:r):"message"in e?(n=e.message,o=r):get_error_message().responded_with_error_reason(e)&&(n=`Error: ${get_error_message(e)}`,o=c),{contentStr:n,statusModifierCSS:o}}();!function(e,t){(function(e){e.classList.remove(c),e.classList.remove(r)})(e),e.classList.add(t.statusModifierCSS);const n=function(e){return e.querySelector(`.${i}`)}(u);null!==n&&(n.textContent=t.contentStr);const a=function(e){return e.querySelector(`.${s}`)}(u);null!==a&&(a.textContent=(0,o.sT)())}(u,d)}document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector(".replaceIconTextButton");null!==e&&e.addEventListener("click",(()=>{!async function(){const e=(0,o.YG)("POST"),t=await(0,o.Fl)(`${URL_DOC_MAIN}?doc_id=${DOC_ID}&task=replace`,e);(0,o.au)(t,201)?window.location.href=t[o.Sx]:c(t)}()}));const t=document.querySelector(".revertIconTextButton");null!==t&&t.addEventListener("click",(()=>{!async function(){const e=(0,o.YG)("POST"),t=await(0,o.Fl)(`${URL_DOC_MAIN}?doc_id=${DOC_ID}&task=revert`,e);(0,o.au)(t,200)?window.location.href=t[o.Sx]:c(t)}()}))}))},60:(e,t,n)=>{n.d(t,{Fl:()=>l,Me:()=>_,N$:()=>q,O9:()=>I,Qp:()=>h,Sx:()=>s,X7:()=>E,XL:()=>r,YG:()=>d,au:()=>f,gA:()=>$,kB:()=>g,kX:()=>S,lJ:()=>c,m8:()=>m,sT:()=>L,xY:()=>y});const o="temp-warning-msg",c="edit-icon",r="hide",i="http_code",s="location",a=new Set([200,201,204]),u=-1;function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n={method:e,headers:(o=function(e){let t=null;if(document.cookie&&""!==document.cookie){const n=document.cookie.split(";");for(let o=0;o<n.length;o++){const c=n[o].trim();if(c.substring(0,10)===e+"="){t=decodeURIComponent(c.substring(10));break}}}return t}("csrftoken"),c=new Headers,c.append("X-CSRFToken",o),c),credentials:"include"};var o,c;return null!=t&&(n.body=JSON.stringify(t)),n}async function l(e,t){let n=await fetch(e,t).catch((e=>{console.log("Error: ",e)}));return await p(n)}async function m(e){let t=await fetch(e).catch((e=>{console.log("Error: ",e)}));return await p(t)}async function p(e){const t=e.headers.get("content-type");if(t&&-1!==t.indexOf("application/json"))var n=await e.json();else n={};return n[i]=e.status,n[s]=e.headers.get("Location"),n}function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=v(e);return n!==u&&(null===t?a.has(n):n===t)}function v(e){return"object"!=typeof e?u:i in e?"string"==typeof e[i]?parseInt(e[i]):e[i]:u}function L(){return(new Date).toLocaleString("en-GB")}function S(e){document.querySelectorAll("."+e).forEach((e=>{e.classList.add(r)}))}function y(e){document.querySelectorAll("."+e).forEach((e=>{e.classList.remove(r)}))}function E(e){document.querySelectorAll("."+e).forEach((e=>{e.disabled=!0}))}function g(e){document.querySelectorAll("."+e).forEach((e=>{e.disabled=!1}))}function _(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=document.createElement("div");n.classList.add(o);let c=document.createElement("div");c.innerHTML=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n="error";if("string"==typeof e)return e;if("object"==typeof e){if(null!==t){let n=!0,o=v(e);if(o!==u&&(n=!function(e){return!!a.has(e)||401==e||403==e||409==e}(o)),n)return t}return function(e){if(f(e))return"Page refresh recommended.";switch(v(e)){case 400:return"Invalid inputs.";case 401:return"You must be logged in.";case 403:return o(e)?e[n]:"Request was forbidden by the server.";case 404:return"Requested information was not found.";case 409:return o(e)?e[n]:"Request clashed with information on server. (The server won.)";case 500:return"A server error has occurred.";default:return"Error: something went wrong."}}(e)}return null!==t?t:"Error: something went wrong.";function o(e){return"object"==typeof e&&n in e}}(e,t),n.append(c);let r=h();return r.addEventListener("click",(e=>{e.target.closest(`.${o}`).remove()})),n.append(r),n}function h(){let e=document.createElement("button");e.classList.add("close");let t=document.createElement("span");return t.innerHTML="close",e.append(t),e}function I(){let e=document.createElement("button");return e.classList.add("button-primary"),e.innerHTML="submit",e}function q(){let e=document.createElement("button");return e.innerHTML="delete",e.classList.add("button-warning"),e.classList.add("delete-btn"),e}function $(){let e=document.createElement("button");e.classList.add(c);let t=document.createElement("span");return t.innerHTML="edit",e.append(t),e}}},t={};function n(o){var c=t[o];if(void 0!==c)return c.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,n),r.exports}n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n(686),n(450)})();