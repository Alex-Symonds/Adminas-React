(()=>{"use strict";var e={450:(e,t,n)=>{n.d(t,{Kc:()=>o,op:()=>u,ut:()=>i});var r=n(113),c=n(60);const o="included",i="excluded",d="included",a="excluded",u="none",l="split-docitem-btn",s="toggle-docitem-btn",m="display",p="split-docitem-window",f="split-direction-setter",L="split-direction-strip",v="docitem-split-status-container",y="id_split_includes_arrows",E="id_split_excludes_arrows",q="id_split_controls",S="&laquo; incl.",g="excl. &raquo;",h="&laquo; split &raquo;",w="invalid",_="invalid-icon";function T(e){const t=e.target.closest("li"),n=t.parentElement,c=H(n);null!=c&&(M(c,n,t),(0,r.Gy)())}function M(e,t,n){if(Y(n)&&!G(n))return n.remove(),void b(t,e);!function(e,t){const n=x(e,t.dataset.jiid);if(null!=n)!function(e,t){const n=t.querySelector("."+m),r=e.querySelector("."+m);n.innerHTML=I(r.innerHTML,n.innerHTML),e.remove()}(t,n);else{const n=function(e){let t="toggle";return e.id===i?t=S:e.id===o&&(t=g),t}(e);t.querySelector("."+s).innerHTML=n,e.append(t)}}(e,n),b(t,e)}function H(e){if(e.id===o)var t=document.querySelector("#"+i);else{if(e.id!==i)return null;t=document.querySelector("#"+o)}return t}function b(e,t){k(t),function(e){for(let t=0;t<e.children.length;t++)if("LI"===e.children[t].nodeName)return!0;return!1}(e)||e.append(function(){const e=document.createElement("li");return e.classList.add(u),e.append(document.createTextNode("None")),e}())}function k(e){const t=e.querySelector("."+u);null!=t&&t.remove()}function x(e,t){for(let n=0;n<e.children.length;n++)if(e.children[n].dataset.jiid&&t===e.children[n].dataset.jiid)return e.children[n];return null}function I(e,t){let n=parseInt(e.match(c.fF)[0])+parseInt(t.match(c.fF)[0]);return t.replace(c.fF,n)}function $(e){!function(e){D();const t=e.closest("li"),n=t.parentElement.id;t.append(function(e,t){let n=e.dataset.jiid,r=document.createElement("div");return r.classList.add(p),r.classList.add(c.fd),r.classList.add(c.fS),r.append(function(){let e=document.createElement("div");e.classList.add(c.yt);let t=document.createElement("h5");return t.innerHTML="Edit Split",e.append(function(){let e=(0,c.Qp)();return e.addEventListener("click",(()=>{D()})),e}()),e.append(t),e}()),function(e){return Y(x(document.querySelector("#"+o),e))}(n)&&r.append(function(){let e=document.createElement("div");e.classList.add("invalid");let t=document.querySelector(`.${_}`).cloneNode(!0);e.append(t);let n=document.createTextNode("Invalid quantity detected and corrected");return e.append(n),e}()),r.append(function(e){let t=document.createElement("p");return t.innerHTML="Splitting "+O(e),t}(n)),r.append(function(e,t,n){const r=document.createElement("div");if(r.classList.add(f),r.append(function(e){const t=document.createElement("div");t.classList.add(L);const n=document.createElement("div"),r=document.createElement("div");if(n.id=y,r.id=E,e===o){n.innerHTML="&laquo;&laquo;&laquo;",r.innerHTML="";var c=d}else e===i&&(n.innerHTML="",r.innerHTML="&raquo;&raquo;&raquo;",c=a);t.append(n);const u=document.createElement("div");return u.id=q,u.innerHTML=c,u.addEventListener("click",(e=>{!function(e){let t=e.target.innerHTML,n=document.querySelector("#"+y),r=document.querySelector("#"+E),c=document.querySelector("#"+q);t===o?(n.innerHTML="",r.innerHTML="&raquo;&raquo;&raquo;",c.innerHTML=i):t===i&&(n.innerHTML="&laquo;&laquo;&laquo;",r.innerHTML="",c.innerHTML=o)}(e)})),t.append(u),t.append(r),t}(t)),Y(n))var c=n.dataset.max_available;else c=F(t,e);const u=function(e){let t=function(){const e=document.createElement("input");return e.type="number",e}();return t.min=0,t.value=e,t.addEventListener("change",(e=>{C(e.target)})),t.addEventListener("keydown",(e=>{"Enter"===e.key&&(C(e.target),R(e.target))})),t}(c);return r.append(u),r}(n,t,e)),r.append(function(e){let t=document.createElement("div");return t.classList.add(v),t.append(j(d,e)),t.append(j(a,e)),t}(n)),r.append(function(){let e=(0,c.O9)();return e.classList.add("full-width-button"),e.innerHTML="split",e.addEventListener("click",(e=>{R(e.target)})),e}()),r}(t,n)),(0,c.kX)(l),(0,c.kX)(s)}(e.target)}function D(){let e=document.querySelector("."+p);e&&e.remove(),(0,c.xY)(l),(0,c.xY)(s)}function O(e){let t=A(o,e),n=A(i,e);return""===t?n:""===n?t:I(t,n)}function A(e,t){let n=x(document.querySelector("#"+e),t);return null!=n?B(n):""}function j(e,t){const n=document.createElement("div");n.classList.add(e),n.classList.add("container");const r=document.createElement("h5");r.innerHTML=e[0].toUpperCase()+e.substring(1),n.append(r);let c=F(e,t),o=document.createElement("span");return o.innerHTML=c,n.append(o),n}function C(e){let t=function(){let e=document.querySelector("#"+q).innerHTML.toLowerCase();return e.includes(a)?a:e.includes(d)?d:void 0}(),n=t===d?a:d,r=X(t),c=X(n),u=parseInt(e.value);!function(e,t,n,r){r<=0?(e.innerHTML=0,t.innerHTML=n):r<=n?(e.innerHTML=r,t.innerHTML=n-r):r>n&&(e.innerHTML=n,t.innerHTML=0)}(r,c,function(e){let t=0;return t+=F(o,e),t+=F(i,e),t}(e.closest("li").dataset.jiid),u)}function F(e,t){const n=x(document.querySelector("#"+e),t);if(Y(n)){let e=parseInt(n.dataset.max_available);return e<0?0:e}return function(e){return null!=e?parseInt(e.querySelector("."+m).innerHTML.match(c.fF)[0]):0}(n)}function R(e){C(document.querySelector("#id_qty"));const t=e.closest("li").dataset.jiid;let n=X(d);const c=parseInt(n.innerHTML);n=X(a);const u=parseInt(n.innerHTML);0===c?N(o,t):0===u?N(i,t):function(e,t,n){const r=O(n);U(o,e,n,r),U(i,t,n,r)}(c,u,t),(0,r.Gy)(),D()}function N(e,t){var n=document.querySelector("#"+e);const r=x(n,t);if(null==r){var c=x(document.querySelector(`#${o}`),t);Y(c)&&G(c)}else M(H(n),n,r)}function U(e,t,n,r){const d=document.querySelector("#"+e),a=x(d,n),u=null!=a;let p=r.replace(c.fF,t);if(u)a.querySelector("."+m).innerHTML=p,Y(a)&&J(a);else{let t=function(e,t,n){const r=document.createElement("li");r.setAttribute("data-jiid",e);const c=document.createElement("span");c.classList.add(m),c.innerHTML=t,r.append(c);const d=document.createElement("div");d.classList.add("button-container");const a=document.createElement("button");a.classList.add(l),a.classList.add("buttonSecondary"),a.innerHTML=h,a.addEventListener("click",(e=>{$(e)}));const u=document.createElement("button");return u.classList.add(s),u.classList.add("button-primary"),n===o?u.innerHTML=g:n===i&&(u.innerHTML=S),u.addEventListener("click",(e=>{T(e)})),d.append(u),d.append(a),r.append(d),r}(n,p,e);d.append(t),k(d)}}function X(e){return document.querySelector("."+p).querySelector("."+e).querySelector("span")}function Y(e){return null!=e&&e.classList.contains(w)}function B(e){const t=e.querySelector("."+m);if(null==t)return"Description not found";if(!Y(e))return t.innerHTML;var n=parseInt(e.dataset.max_available);return n=n>0?n:0,t.innerHTML.replace(c.fF,n)}function G(e){return!(parseInt(e.dataset.max_available)<=0||(function(e){if(P(e))return;e.querySelector("."+m).innerHTML=B(e)}(e),J(e),0))}function J(e){!function(e){P(e)||e.classList.remove(w)}(e),function(e){P(e)||P(e.querySelector(`.${_}`))||e.querySelector(`.${_}`).remove()}(e)}function P(e){return null==e}document.addEventListener("DOMContentLoaded",(()=>{document.querySelectorAll("."+s).forEach((e=>{e.addEventListener("click",(e=>{T(e)}))})),document.querySelectorAll("."+l).forEach((e=>{e.addEventListener("click",(e=>{$(e)}))}))}))},113:(e,t,n)=>{n.d(t,{Gy:()=>p});var r=n(60),c=n(450);const o="editing-special-instruction",i="no-special-instructions",d="read_row",a="unsaved-changes";function u(e){const t=function(e){const t={};t.reference=document.querySelector("#id_doc_reference").value,t.issue_date=e,t.assigned_items=function(){const e=document.querySelector("#"+c.Kc),t=document.querySelector("#"+c.ut),n=m(e,!1);return{...m(t,!0),...n}}(),t.special_instructions=function(){const e=[],t=document.querySelector(".special-instructions").querySelector(".existing");return Array.from(t.children).forEach((t=>{if(!t.classList.contains(i)){let n={};n.id=t.hasAttribute("siid")?t.dataset.siid:0,n.contents=t.querySelector(".contents").innerHTML,e.push(n)}})),e}();const n=s("id_req_prod_date");null!==n&&(t.req_prod_date=n);const r=s("id_sched_prod_date");return null!==r&&(t.sched_prod_date=r),t}(e);"0"===window.DOC_ID?l("POST",201,t,`job=${window.JOB_ID}&type=${window.DOC_CODE}`):l("PUT",204,t,`id=${window.DOC_ID}`)}async function l(e,t,n,c){const o=(0,r.YG)(e,n),i=await(0,r.Fl)(`${window.URL_DOCBUILDER}?${c}`,o);(0,r.au)(i,t)?201===t?window.location.href=i[r.Sx]:async function(e){const t=await(0,r.m8)(e);if((0,r.au)(t,200)&&"doc_is_issued"in t&&(!0===t.doc_is_issued&&(window.location.href=window.URL_DOCMAIN),function(){let e=document.querySelector(`.${a}`);null!=e&&e.remove()}(),"doc_is_valid"in t&&"item_is_valid"in t))return n=t.doc_is_valid,c=t.item_is_valid,!0===n&&document.contains(document.getElementById("invalid_document_warning"))&&(document.getElementById("invalid_document_warning").remove(),document.getElementById("document_issue_btn").removeAttribute("disabled")),function(e){const t="invalid";document.querySelectorAll(`.${t}`).forEach((n=>{const r=n.dataset.jiid;r in e&&!0===e[r]&&(n.classList.remove(t),n.querySelector(".invalid-icon").remove())}))}(c),void(0,r.tr)("Document saved");var n,c;(0,r.tr)("Page display error: refresh is recommended.",!0)}(`${window.URL_DOCBUILDER}?${c}`):(0,r.tr)(i)}function s(e){const t=document.getElementById(e);if(t){var n=t.value;return""==n?"":n}return null}function m(e,t){const n={};return null==e.querySelector("."+c.op)&&Array.from(e.children).forEach((e=>{if("LI"===e.tagName){const c=String(e.dataset.jiid);n[c]=t?0:parseInt(e.querySelector(".display").innerHTML.match(r.fF)[0])}})),n}function p(){if(null==document.querySelector(`.${a}`)){let e=document.querySelector(".status-controls"),t=function(){let e=document.createElement("div");return e.classList.add(a),e.innerHTML="warning: unsaved changes exist",e}();e.append(t)}}function f(e){let t=e.parentElement,n=t.querySelector(".contents");n.classList.add(r.XL),(0,r.kX)(r.lJ);let c=n.innerHTML;t.prepend(function(e){let t=function(){let e=document.createElement("div");return e.classList.add(o),e.classList.add(r.fS),e.classList.add(r.fd),e}();return t.append(function(){let e=(0,r.Qp)();return e.addEventListener("click",(e=>{L(e.target)})),e}()),t.append(function(){let e=document.createElement("h5");return e.classList.add(r.yt),e.innerHTML="Edit Special Instruction",e}()),t.append(function(e){let t=document.createElement("textarea");return t.innerHTML=e,t}(e)),t.append(function(){let e=document.createElement("div");return e.classList.add("controls"),e.append(function(){let e=(0,r.O9)();return e.innerHTML="change",e.addEventListener("click",(e=>{!function(e){let t=e.closest(`.${o}`).querySelector("textarea").value,n=e.closest(".read_row").querySelector(".contents");n.innerHTML=t,n.classList.remove(r.XL),L(e),p()}(e.target)})),e}()),e.append(function(){let e=(0,r.N$)();return e.setAttribute("data-siid","0"),e.addEventListener("click",(e=>{v(e.target)})),e}()),e}()),t}(c))}function L(e){let t=e.closest(`.${o}`),n=t.parentElement;t.remove(),n.querySelector(".contents").classList.remove(r.XL),(0,r.xY)(r.lJ)}function v(e){e.closest("."+d).remove(),y(),p()}function y(){let e=document.querySelector(".special-instructions"),t=e.querySelector(`.${i}`),n=null==e.querySelector("."+d),r=null!=t;n&&!r?document.querySelector(".existing").append(function(){let e=document.createElement("p");return e.classList.add(i),e.innerHTML="No special instructions on this document",e}()):!n&&r&&t.remove()}document.addEventListener("DOMContentLoaded",(()=>{!function(){document.querySelector("#document_save_btn").addEventListener("click",(()=>{u(null)})),document.querySelector("#document_issue_btn").addEventListener("click",(e=>{!function(e){const t=function(){const e=document.createElement("div");return e.classList.add(r.fS),e.classList.add(r.fd),e.append(function(){const e=(0,r.Qp)();return e.addEventListener("click",(e=>{e.target.parentElement.remove()})),e}()),e.append(function(){const e=document.createElement("h4");return e.classList.add(r.yt),e.innerHTML="Issue Date",e}()),e.append(function(){const e=document.createElement("input");e.classList.add("issue-date"),e.type="date";const t=new Date,n=`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`;return e.value=n,e}()),e.append(function(){const e=(0,r.O9)();return e.classList.add("full-width-button"),e.innerHTML="issue",e.addEventListener("click",(e=>{u(e.target.parentElement.querySelector("input").value)})),e}()),e}();e.target.after(t)}(e)})),document.querySelector("#document_delete_btn").addEventListener("click",(()=>{!async function(){if(window.confirm("Deleting a document cannot be undone except by a system administrator. Are you sure?")){let e=(0,r.YG)("DELETE"),t=await(0,r.Fl)(`${window.URL_DOCBUILDER}?id=${window.DOC_ID}`,e);(0,r.au)(t,204)?window.location.href=window.JOB_URL:(0,r.tr)(t)}}()})),null!=document.querySelector(".document-fields-container")&&document.querySelectorAll("input").forEach((e=>{e.addEventListener("input",(()=>{p()}))}));const e="add-new";document.querySelector(".special-instruction").addEventListener("click",(()=>{(0,r.xY)(e)})),document.querySelector(".close-new-instr").addEventListener("click",(()=>{(0,r.kX)(e)})),document.querySelector(".add-special-instruction-btn").addEventListener("click",(()=>{!function(){let e=document.querySelector(".special-instructions").querySelector("textarea"),t=e.value;e.value="";let n=document.querySelector(".existing"),c=function(e){let t=function(){let e=document.createElement("div");return e.classList.add("read_row"),e}();return t.append(function(e){let t=document.createElement("div");return t.classList.add("contents"),t.innerHTML=e,t}(e)),t.append(function(){let e=(0,r.gA)();return e.setAttribute("data-siid","0"),e.addEventListener("click",(e=>{f(e.target)})),e}()),t.append(function(){let e=document.createElement("div");e.classList.add("who-and-when");let t=document.createElement("span");t.classList.add("username"),t.innerHTML="You",e.append(t);let n=document.createTextNode(" on ");e.append(n);let c=document.createElement("span");return c.classList.add("when"),c.innerHTML=(0,r.sT)(),e.append(c),e}()),t}(t);n.prepend(c),y(),p()}(),(0,r.kX)(e)})),document.querySelectorAll(".edit-special-instruction-btn").forEach((e=>{e.addEventListener("click",(e=>{f(e.target)}))})),document.querySelectorAll(".delete-special-instruction-btn").forEach((e=>{e.addEventListener("click",(e=>{v(e.target)}))}))}()}))},60:(e,t,n)=>{n.d(t,{Fl:()=>v,N$:()=>b,O9:()=>H,Qp:()=>M,Sx:()=>m,XL:()=>l,YG:()=>L,au:()=>q,fF:()=>r,fS:()=>i,fd:()=>a,gA:()=>k,kX:()=>w,lJ:()=>u,m8:()=>y,sT:()=>h,tr:()=>T,xY:()=>_,yt:()=>d});const r=/\d+(?=( x ))/g,c="system-message-box",o="temp-warning-msg",i="panel",d="panel-header",a="form-like",u="edit-icon",l="hide",s="http_code",m="location",p=new Set([200,201,204]),f=-1;function L(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n={method:e,headers:(r=function(e){let t=null;if(document.cookie&&""!==document.cookie){const n=document.cookie.split(";");for(let r=0;r<n.length;r++){const c=n[r].trim();if(c.substring(0,10)===e+"="){t=decodeURIComponent(c.substring(10));break}}}return t}("csrftoken"),c=new Headers,c.append("X-CSRFToken",r),c),credentials:"include"};var r,c;return null!=t&&(n.body=JSON.stringify(t)),n}async function v(e,t){let n=await fetch(e,t).catch((e=>{console.log("Error: ",e)}));return await E(n)}async function y(e){let t=await fetch(e).catch((e=>{console.log("Error: ",e)}));return await E(t)}async function E(e){const t=e.headers.get("content-type");if(t&&-1!==t.indexOf("application/json"))var n=await e.json();else n={};return n[s]=e.status,n[m]=e.headers.get("Location"),n}function q(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=S(e);return n!==f&&(null===t?p.has(n):n===t)}function S(e){return"object"!=typeof e?f:s in e?"string"==typeof e[s]?parseInt(e[s]):e[s]:f}function g(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n="error";if("string"==typeof e)return e;if("object"==typeof e){if(null!==t){let n=!0,r=S(e);if(r!==f&&(n=!function(e){return!!p.has(e)||(401==e||403==e||409==e)}(r)),n)return t}return function(e){if(q(e))return"Page refresh recommended.";switch(S(e)){case 400:return"Invalid inputs.";case 401:return"You must be logged in.";case 403:return r(e)?e[n]:"Request was forbidden by the server.";case 404:return"Requested information was not found.";case 409:return r(e)?e[n]:"Request clashed with information on server. (The server won.)";case 500:return"A server error has occurred.";default:return"Error: something went wrong."}}(e)}return null!==t?t:"Error: something went wrong.";function r(e){return"object"==typeof e&&n in e}}function h(){return(new Date).toLocaleString("en-GB")}function w(e){document.querySelectorAll("."+e).forEach((e=>{e.classList.add(l)}))}function _(e){document.querySelectorAll("."+e).forEach((e=>{e.classList.remove(l)}))}function T(e){let t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=document.querySelector(".status-controls"),i=document.querySelector("."+c);null==i&&(i=function(){let e=document.createElement("div");return e.classList.add(c),e}(),r.append(i)),"string"==typeof e?(n&&i.classList.add(o),t=e):"message"in e?t=e.message:g().responded_with_error_reason(e)?(i.classList.add(o),t=`Error: ${g(e)} @ ${h()}`):(i.classList.add(o),t="Something went wrong, try refreshing the page"),i.innerHTML=`${t} @ ${h()}`}function M(){let e=document.createElement("button");e.classList.add("close");let t=document.createElement("span");return t.innerHTML="close",e.append(t),e}function H(){let e=document.createElement("button");return e.classList.add("button-primary"),e.innerHTML="submit",e}function b(){let e=document.createElement("button");return e.innerHTML="delete",e.classList.add("button-warning"),e.classList.add("delete-btn"),e}function k(){let e=document.createElement("button");e.classList.add(u);let t=document.createElement("span");return t.innerHTML="edit",e.append(t),e}}},t={};function n(r){var c=t[r];if(void 0!==c)return c.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n(113),n(450)})();