import{create_generic_ele_cancel_button,create_generic_ele_delete_button,create_generic_ele_edit_button,create_generic_ele_submit_button,CSS_EDIT_ICON,CSS_GENERIC_FORM_LIKE,CSS_GENERIC_PANEL,CSS_GENERIC_PANEL_HEADING,CSS_HIDE,display_document_response_message,get_date_time,getRequestOptions,hide_all_by_class,KEY_LOCATION,QTY_RE,query_backend,status_is_good,unhide_all_by_class,update_backend}from"./util.js";import{CLASS_NONE_LI,ID_EXCLUDES_UL,ID_INCLUDES_UL}from"./document_items.js";const CLASS_SPECIAL_INSTRUCTION_EDITOR="editing-special-instruction",CLASS_SPECIAL_INSTRUCTION_EDIT="edit-special-instruction-btn",CLASS_SPECIAL_INSTRUCTION_DELETE="delete-special-instruction-btn",CLASS_LOCAL_NAV="status-controls",CLASS_INSTRUCTIONS_EMPTY_MESSAGE="no-special-instructions",CLASS_INSTRUCTIONS_SECTION="special-instructions",CLASS_ONE_SPECIAL_INSTRUCTION="read_row",CLASS_SHOW_ADD_INSTRUCTION_FORMLIKE="special-instruction",CLASS_HIDE_ADD_INSTRUCTION_FORMLIKE="close-new-instr",CLASS_UNSAVED_CHANGES="unsaved-changes";function open_issue_document_window(e){var t=create_ele_issue_document_window();e.target.after(t)}function close_issue_document_window(e){e.parentElement.remove()}function create_ele_issue_document_window(){let e=document.createElement("div");return e.classList.add(CSS_GENERIC_PANEL),e.classList.add(CSS_GENERIC_FORM_LIKE),e.append(create_ele_issue_document_window_cancel_btn()),e.append(create_ele_issue_document_window_heading()),e.append(create_ele_issue_document_window_issue_date_input()),e.append(create_ele_issue_document_window_issue_btn()),e}function create_ele_issue_document_window_cancel_btn(){let e=create_generic_ele_cancel_button();return e.addEventListener("click",e=>{close_issue_document_window(e.target)}),e}function create_ele_issue_document_window_heading(){let e=document.createElement("h4");return e.classList.add(CSS_GENERIC_PANEL_HEADING),e.innerHTML="Issue Date",e}function create_ele_issue_document_window_issue_date_input(){let e=document.createElement("input");e.classList.add("issue-date"),e.type="date";const t=new Date;var _=`${t.getFullYear()}-${t.getMonth()+1}-`+t.getDate();return e.value=_,e}function create_ele_issue_document_window_issue_btn(){let e=create_generic_ele_submit_button();return e.classList.add("full-width-button"),e.innerHTML="issue",e.addEventListener("click",e=>{issue_document(e.target)}),e}function issue_document(e){update_document(e.parentElement.querySelector("input").value)}function save_document(){update_document(null)}function update_document(e){e=get_document_data_as_object(e);"0"===window.DOC_ID?update_document_on_server("POST",201,e,`job=${window.JOB_ID}&type=`+window.DOC_CODE):update_document_on_server("PUT",204,e,"id="+window.DOC_ID)}async function update_document_on_server(e,t,_,n){e=getRequestOptions(e,_),_=await update_backend(window.URL_DOCBUILDER+"?"+n,e);status_is_good(_,t)?201===t?window.location.href=_[KEY_LOCATION]:update_page_after_successful_save(window.URL_DOCBUILDER+"?"+n):display_document_response_message(_)}async function update_page_after_successful_save(e){e=await query_backend(e);status_is_good(e,200)&&"doc_is_issued"in e&&(!0===e.doc_is_issued&&(window.location.href=window.URL_DOCMAIN),remove_unsaved_changes_ele(),"doc_is_valid"in e&&"item_is_valid"in e)?(update_validity_warnings(e.doc_is_valid,e.item_is_valid),display_document_response_message("Document saved")):display_document_response_message("Page display error: refresh is recommended.",!0)}function get_document_data_as_object(e){let t={};t.reference=document.querySelector("#id_doc_reference").value,t.issue_date=e,t.assigned_items=get_docitems_assignment_quantity_object(),t.special_instructions=get_special_instructions_as_list();e=get_value_from_id("id_req_prod_date"),null!==e&&(t.req_prod_date=e),e=get_value_from_id("id_sched_prod_date");return null!==e&&(t.sched_prod_date=e),t}function get_value_from_id(e){var e=document.getElementById(e);return e?""==(e=e.value)?"":e:null}function get_docitems_assignment_quantity_object(){var e=document.querySelector("#"+ID_INCLUDES_UL),t=document.querySelector("#"+ID_EXCLUDES_UL),e=ul_to_docitems_assignment_quantity_object(e,!1);return{...ul_to_docitems_assignment_quantity_object(t,!0),...e}}function ul_to_docitems_assignment_quantity_object(e,_){let n={};return null==e.querySelector("."+CLASS_NONE_LI)&&Array.from(e.children).forEach(e=>{var t;"LI"===e.tagName&&(t=String(e.dataset.jiid),n[t]=_?0:parseInt(e.querySelector(".display").innerHTML.match(QTY_RE)[0]))}),n}function get_special_instructions_as_list(){let _=[],e=document.querySelector("."+CLASS_INSTRUCTIONS_SECTION);var t=e.querySelector(".existing");return Array.from(t.children).forEach(t=>{if(!t.classList.contains(CLASS_INSTRUCTIONS_EMPTY_MESSAGE)){let e={};e.id=t.hasAttribute("siid")?t.dataset.siid:0,e.contents=t.querySelector(".contents").innerHTML,_.push(e)}}),_}async function delete_document(){var e;window.confirm("Deleting a document cannot be undone except by a system administrator. Are you sure?")&&(e=getRequestOptions("DELETE"),e=await update_backend(window.URL_DOCBUILDER+"?id="+window.DOC_ID,e),status_is_good(e,204)?window.location.href=window.JOB_URL:display_document_response_message(e))}function show_save_warning_ele(){if(null==document.querySelector("."+CLASS_UNSAVED_CHANGES)){let e=document.querySelector(".status-controls");var t=create_unsaved_changes_ele();e.append(t)}}function create_unsaved_changes_ele(){let e=document.createElement("div");return e.classList.add(CLASS_UNSAVED_CHANGES),e.innerHTML="warning: unsaved changes exist",e}function remove_unsaved_changes_ele(){let e=document.querySelector("."+CLASS_UNSAVED_CHANGES);null!=e&&e.remove()}function open_editor_special_instruction(e){let t=e.parentElement,_=t.querySelector(".contents");_.classList.add(CSS_HIDE),hide_all_by_class(CSS_EDIT_ICON);e=_.innerHTML;t.prepend(create_ele_editor_special_instruction(e))}function close_editor_special_instruction(e){let t=e.closest("."+CLASS_SPECIAL_INSTRUCTION_EDITOR),_=t.parentElement,n=(t.remove(),_.querySelector(".contents"));n.classList.remove(CSS_HIDE),unhide_all_by_class(CSS_EDIT_ICON)}function create_ele_editor_special_instruction(e){let t=create_ele_editor_special_instruction_base();return t.append(create_ele_editor_special_instruction_cancel_button()),t.append(create_ele_editor_special_instruction_heading()),t.append(create_ele_editor_special_instruction_input(e)),t.append(create_ele_editor_special_instruction_button_container()),t}function create_ele_editor_special_instruction_base(){let e=document.createElement("div");return e.classList.add(CLASS_SPECIAL_INSTRUCTION_EDITOR),e.classList.add(CSS_GENERIC_PANEL),e.classList.add(CSS_GENERIC_FORM_LIKE),e}function create_ele_editor_special_instruction_cancel_button(){let e=create_generic_ele_cancel_button();return e.addEventListener("click",e=>{close_editor_special_instruction(e.target)}),e}function create_ele_editor_special_instruction_heading(){let e=document.createElement("h5");return e.classList.add(CSS_GENERIC_PANEL_HEADING),e.innerHTML="Edit Special Instruction",e}function create_ele_editor_special_instruction_input(e){let t=document.createElement("textarea");return t.innerHTML=e,t}function create_ele_editor_special_instruction_button_container(){let e=document.createElement("div");return e.classList.add("controls"),e.append(create_ele_editor_special_instruction_submit_button()),e.append(create_ele_editor_special_instruction_delete_button()),e}function create_ele_editor_special_instruction_submit_button(){let e=create_generic_ele_submit_button();return e.innerHTML="change",e.addEventListener("click",e=>{update_ele_special_instruction(e.target)}),e}function create_ele_editor_special_instruction_delete_button(){let e=create_generic_ele_delete_button();return e.setAttribute("data-siid","0"),e.addEventListener("click",e=>{delete_ele_special_instruction(e.target)}),e}function add_special_instruction_to_page(){let e=document.querySelector(".special-instructions"),t=e.querySelector("textarea");var _=t.value;t.value="";let n=document.querySelector(".existing");_=create_ele_special_instruction(_);n.prepend(_),update_emptiness_of_special_instructions(),show_save_warning_ele()}function create_ele_special_instruction(e){let t=create_ele_special_instructions_base();return t.append(create_ele_special_instruction_contents(e)),t.append(create_ele_special_instruction_edit_btn()),t.append(create_ele_special_instruction_who_and_when_placeholder()),t}function create_ele_special_instructions_base(){let e=document.createElement("div");return e.classList.add("read_row"),e}function create_ele_special_instruction_contents(e){let t=document.createElement("div");return t.classList.add("contents"),t.innerHTML=e,t}function create_ele_special_instruction_edit_btn(){let e=create_generic_ele_edit_button();return e.setAttribute("data-siid","0"),e.addEventListener("click",e=>{open_editor_special_instruction(e.target)}),e}function create_ele_special_instruction_who_and_when_placeholder(){let e=document.createElement("div"),t=(e.classList.add("who-and-when"),document.createElement("span"));t.classList.add("username"),t.innerHTML="You",e.append(t);var _=document.createTextNode(" on ");e.append(_);let n=document.createElement("span");return n.classList.add("when"),n.innerHTML=get_date_time(),e.append(n),e}function update_ele_special_instruction(e){let t=e.closest("."+CLASS_SPECIAL_INSTRUCTION_EDITOR);var _=t.querySelector("textarea").value;let n=e.closest(".read_row"),i=n.querySelector(".contents");i.innerHTML=_,i.classList.remove(CSS_HIDE),close_editor_special_instruction(e),show_save_warning_ele()}function delete_ele_special_instruction(e){e.closest("."+CLASS_ONE_SPECIAL_INSTRUCTION).remove(),update_emptiness_of_special_instructions(),show_save_warning_ele()}function update_emptiness_of_special_instructions(){let e=document.querySelector(".special-instructions"),t=e.querySelector("."+CLASS_INSTRUCTIONS_EMPTY_MESSAGE);var _=null==e.querySelector("."+CLASS_ONE_SPECIAL_INSTRUCTION),n=null!=t;if(_&&!n){let e=document.querySelector(".existing");e.append(create_ele_empty_special_instructions())}else!_&&n&&t.remove()}function create_ele_empty_special_instructions(){let e=document.createElement("p");return e.classList.add(CLASS_INSTRUCTIONS_EMPTY_MESSAGE),e.innerHTML="No special instructions on this document",e}function update_validity_warnings(e,t){clear_document_validity_warning(e),clear_lineitem_validity_warnings(t)}function clear_document_validity_warning(e){!0===e&&document.contains(document.getElementById("invalid_document_warning"))&&(document.getElementById("invalid_document_warning").remove(),document.getElementById("document_issue_btn").removeAttribute("disabled"))}function clear_lineitem_validity_warnings(_){const n="invalid";document.querySelectorAll("."+n).forEach(e=>{var t=e.dataset.jiid;t in _&&!0===_[t]&&(e.classList.remove(n),e.querySelector(".invalid-icon").remove())})}import{show_save_warning_ele}from"./document_builder_main";import{create_generic_ele_cancel_button,create_generic_ele_submit_button,CSS_GENERIC_FORM_LIKE,CSS_GENERIC_PANEL,CSS_GENERIC_PANEL_HEADING,hide_all_by_class,QTY_RE,unhide_all_by_class}from"./util.js";const ID_INCLUDES_UL="included",ID_EXCLUDES_UL="excluded",CLASS_SPLIT_PREVIEW_INCLUDES="included",CLASS_SPLIT_PREVIEW_EXCLUDES="excluded",CLASS_NONE_LI="none",CLASS_SPLIT_BTN="split-docitem-btn",CLASS_TOGGLE_BTN="toggle-docitem-btn",CLASS_DISPLAY_SPAN="display",CLASS_SPLIT_WINDOW="split-docitem-window",CLASS_SPLIT_DIRECTION_SETTER="split-direction-setter",CLASS_SPLIT_DIRECTION_STRIP="split-direction-strip",CLASS_SPLIT_STATUS_CONTAINER="docitem-split-status-container",ID_SPLIT_WINDOW_INCLUDES_ARROWS="id_split_includes_arrows",ID_SPLIT_WINDOW_EXCLUDES_ARROWS="id_split_excludes_arrows",ID_SPLIT_WINDOW_DIRECTION="id_split_controls",STR_INCLUDES_BTN="&laquo; incl.",STR_EXCLUDES_BTN="excl. &raquo;",STR_SPLIT_BTN="&laquo; split &raquo;",CSS_CLASS_INVALID_LI="invalid",CSS_CLASS_INVALID_ICON="invalid-icon";function toggle_doc_item(e){var e=e.target.closest("li"),t=e.parentElement,_=get_dest_docitem_ul(t);null!=_&&(update_both_docitem_ul_for_toggle(_,t,e),show_save_warning_ele())}function update_both_docitem_ul_for_toggle(e,t,_){docitem_is_invalid(_)&&!fix_invalid_docitem_ele(_)?_.remove():move_docitem_li(e,_),update_none_li(t,e)}function get_dest_docitem_ul(e){if(e.id===ID_INCLUDES_UL)var t=document.querySelector("#"+ID_EXCLUDES_UL);else{if(e.id!==ID_EXCLUDES_UL)return null;t=document.querySelector("#"+ID_INCLUDES_UL)}return t}function move_docitem_li(e,t){var _=get_ele_li_with_same_jiid(e,t.dataset.jiid);null!=_?merge_into_dst_docitem_li(t,_):(_=get_toggle_button_display_str(e),t.querySelector("."+CLASS_TOGGLE_BTN).innerHTML=_,e.append(t))}function get_toggle_button_display_str(e){let t="toggle";return e.id===ID_EXCLUDES_UL?t=STR_INCLUDES_BTN:e.id===ID_INCLUDES_UL&&(t=STR_EXCLUDES_BTN),t}function update_none_li(e,t){remove_none_li(t),ul_contains_li(e)||e.append(create_ele_none_li())}function remove_none_li(e){const t=e.querySelector("."+CLASS_NONE_LI);null!=t&&t.remove()}function ul_contains_li(t){for(let e=0;e<t.children.length;e++)if("LI"===t.children[e].nodeName)return!0;return!1}function create_ele_none_li(){const e=document.createElement("li");return e.classList.add(CLASS_NONE_LI),e.append(document.createTextNode("None")),e}function get_ele_li_with_same_jiid(t,_){for(let e=0;e<t.children.length;e++)if(t.children[e].dataset.jiid&&_===t.children[e].dataset.jiid)return t.children[e];return null}function merge_into_dst_docitem_li(e,t){const _=t.querySelector("."+CLASS_DISPLAY_SPAN);t=e.querySelector("."+CLASS_DISPLAY_SPAN);_.innerHTML=get_combined_docitem_text(t.innerHTML,_.innerHTML),e.remove()}function get_combined_docitem_text(e,t){var e=parseInt(e.match(QTY_RE)[0]),_=parseInt(t.match(QTY_RE)[0]);return t.replace(QTY_RE,e+_)}function split_doc_item(e){open_docitem_split_window(e.target)}function open_docitem_split_window(e){close_docitem_split_window();const t=e.closest("li");e=t.parentElement.id;t.append(create_ele_docitem_split_window(t,e)),hide_all_by_class(CLASS_SPLIT_BTN),hide_all_by_class(CLASS_TOGGLE_BTN)}function close_docitem_split_window(){let e=document.querySelector("."+CLASS_SPLIT_WINDOW);e&&e.remove(),unhide_all_by_class(CLASS_SPLIT_BTN),unhide_all_by_class(CLASS_TOGGLE_BTN)}function create_ele_docitem_split_window(e,t){var _=e.dataset.jiid;let n=document.createElement("div");return n.classList.add(CLASS_SPLIT_WINDOW),n.classList.add(CSS_GENERIC_FORM_LIKE),n.classList.add(CSS_GENERIC_PANEL),n.append(create_ele_docitem_split_window_heading()),split_window_needs_invalid_warning(_)&&n.append(create_ele_docitem_invalid_split_warning()),n.append(create_ele_docitem_desc(_)),n.append(create_ele_docitem_split_window_controls(_,t,e)),n.append(create_ele_docitem_split_window_status_container(_)),n.append(create_ele_docitem_split_window_submit_btn()),n}function create_ele_docitem_split_window_heading(){let e=document.createElement("div"),t=(e.classList.add(CSS_GENERIC_PANEL_HEADING),document.createElement("h5"));return t.innerHTML="Edit Split",e.append(create_ele_docitem_split_window_cancel_btn()),e.append(t),e}function create_ele_docitem_desc(e){let t=document.createElement("p");return t.innerHTML="Splitting "+get_combined_docitem_text_from_jobitem_id(e),t}function get_combined_docitem_text_from_jobitem_id(e){var t=get_individual_docitem_text_from_jobitem_id(ID_INCLUDES_UL,e),e=get_individual_docitem_text_from_jobitem_id(ID_EXCLUDES_UL,e);return""===t?e:""===e?t:get_combined_docitem_text(t,e)}function get_individual_docitem_text_from_jobitem_id(e,t){e=get_ele_li_with_same_jiid(document.querySelector("#"+e),t);return null!=e?get_valid_description(e):""}function split_window_needs_invalid_warning(e){return docitem_is_invalid(get_ele_li_with_same_jiid(document.querySelector("#"+ID_INCLUDES_UL),e))}function create_ele_docitem_invalid_split_warning(){let e=document.createElement("div");e.classList.add("invalid");var t=document.querySelector("."+CSS_CLASS_INVALID_ICON).cloneNode(!0),t=(e.append(t),document.createTextNode("Invalid quantity detected and corrected"));return e.append(t),e}function create_ele_docitem_split_window_controls(e,t,_){const n=document.createElement("div");n.classList.add(CLASS_SPLIT_DIRECTION_SETTER),n.append(create_ele_docitem_split_window_direction(t));_=create_ele_docitem_edit_field(docitem_is_invalid(_)?_.dataset.max_available:get_docitem_qty(t,e));return n.append(_),n}function create_ele_docitem_split_window_direction(e){const t=document.createElement("div"),_=(t.classList.add(CLASS_SPLIT_DIRECTION_STRIP),document.createElement("div")),n=document.createElement("div");var i;_.id=ID_SPLIT_WINDOW_INCLUDES_ARROWS,n.id=ID_SPLIT_WINDOW_EXCLUDES_ARROWS,e===ID_INCLUDES_UL?(_.innerHTML="&laquo;&laquo;&laquo;",n.innerHTML="",i=CLASS_SPLIT_PREVIEW_INCLUDES):e===ID_EXCLUDES_UL&&(_.innerHTML="",n.innerHTML="&raquo;&raquo;&raquo;",i=CLASS_SPLIT_PREVIEW_EXCLUDES),t.append(_);const c=document.createElement("div");return c.id=ID_SPLIT_WINDOW_DIRECTION,c.innerHTML=i,c.addEventListener("click",e=>{toggle_docitem_split_window_direction(e)}),t.append(c),t.append(n),t}function create_ele_jobitem_quantity_input(){const e=document.createElement("input");return e.type="number",e}function create_ele_docitem_edit_field(e){let t=create_ele_jobitem_quantity_input();return t.min=0,t.value=e,t.addEventListener("change",e=>{update_split_window(e.target)}),t.addEventListener("keydown",e=>{"Enter"===e.key&&(update_split_window(e.target),process_split_request(e.target))}),t}function create_ele_docitem_split_window_status_container(e){let t=document.createElement("div");return t.classList.add(CLASS_SPLIT_STATUS_CONTAINER),t.append(create_ele_docitem_split_window_category_div(CLASS_SPLIT_PREVIEW_INCLUDES,e)),t.append(create_ele_docitem_split_window_category_div(CLASS_SPLIT_PREVIEW_EXCLUDES,e)),t}function create_ele_docitem_split_window_category_div(e,t){const _=document.createElement("div"),n=(_.classList.add(e),_.classList.add("container"),document.createElement("h5"));n.innerHTML=e[0].toUpperCase()+e.substring(1),_.append(n);e=get_docitem_qty(e,t);let i=document.createElement("span");return i.innerHTML=e,_.append(i),_}function create_ele_docitem_split_window_submit_btn(){let e=create_generic_ele_submit_button();return e.classList.add("full-width-button"),e.innerHTML="split",e.addEventListener("click",e=>{process_split_request(e.target)}),e}function create_ele_docitem_split_window_cancel_btn(){let e=create_generic_ele_cancel_button();return e.addEventListener("click",()=>{close_docitem_split_window()}),e}function toggle_docitem_split_window_direction(e){e=e.target.innerHTML;let t=document.querySelector("#"+ID_SPLIT_WINDOW_INCLUDES_ARROWS),_=document.querySelector("#"+ID_SPLIT_WINDOW_EXCLUDES_ARROWS),n=document.querySelector("#"+ID_SPLIT_WINDOW_DIRECTION);e===ID_INCLUDES_UL?(t.innerHTML="",_.innerHTML="&raquo;&raquo;&raquo;",n.innerHTML=ID_EXCLUDES_UL):e===ID_EXCLUDES_UL&&(t.innerHTML="&laquo;&laquo;&laquo;",_.innerHTML="",n.innerHTML=ID_INCLUDES_UL)}function update_split_window(e){var t=get_docitem_split_controls_state(),_=t,t=toggle_docitem_membership_id(t),_=get_docitem_split_window_result_ele(_),t=get_docitem_split_window_result_ele(t),n=parseInt(e.value);set_docitem_split_window(_,t,get_total_qty(e.closest("li").dataset.jiid),n)}function toggle_docitem_membership_id(e){return e===CLASS_SPLIT_PREVIEW_INCLUDES?CLASS_SPLIT_PREVIEW_EXCLUDES:CLASS_SPLIT_PREVIEW_INCLUDES}function get_docitem_split_controls_state(){let e=document.querySelector("#"+ID_SPLIT_WINDOW_DIRECTION),t=e.innerHTML.toLowerCase();return t.includes(CLASS_SPLIT_PREVIEW_EXCLUDES)?CLASS_SPLIT_PREVIEW_EXCLUDES:t.includes(CLASS_SPLIT_PREVIEW_INCLUDES)?CLASS_SPLIT_PREVIEW_INCLUDES:void 0}function set_docitem_split_window(e,t,_,n){n<=0?(e.innerHTML=0,t.innerHTML=_):n<=_?(e.innerHTML=n,t.innerHTML=_-n):_<n&&(e.innerHTML=_,t.innerHTML=0)}function get_total_qty(e){var t=0,e=(t+=get_docitem_qty(ID_INCLUDES_UL,e),get_docitem_qty(ID_EXCLUDES_UL,e));return t+=e}function get_docitem_qty(e,t){e=get_ele_li_with_same_jiid(document.querySelector("#"+e),t);return docitem_is_invalid(e)?(t=parseInt(e.dataset.max_available))<0?0:t:get_docitem_qty_from_li(e)}function get_docitem_qty_from_li(e){return null!=e?parseInt(e.querySelector("."+CLASS_DISPLAY_SPAN).innerHTML.match(QTY_RE)[0]):0}function process_split_request(e){update_split_window(document.querySelector("#id_qty"));var e=e.closest("li").dataset.jiid,t=get_docitem_split_window_result_ele(CLASS_SPLIT_PREVIEW_INCLUDES),_=parseInt(t.innerHTML),t=get_docitem_split_window_result_ele(CLASS_SPLIT_PREVIEW_EXCLUDES),t=parseInt(t.innerHTML);0===_?process_docitem_split_N_and_0(ID_INCLUDES_UL,e):0===t?process_docitem_split_N_and_0(ID_EXCLUDES_UL,e):process_docitem_split_N_and_N(_,t,e),show_save_warning_ele(),close_docitem_split_window()}function process_docitem_split_N_and_0(e,t){var e=document.querySelector("#"+e),_=get_ele_li_with_same_jiid(e,t);null!=_?update_both_docitem_ul_for_toggle(get_dest_docitem_ul(e),e,_):docitem_is_invalid(e=get_ele_li_with_same_jiid(document.querySelector("#"+ID_INCLUDES_UL),t))&&fix_invalid_docitem_ele(e)}function process_docitem_split_N_and_N(e,t,_){var n=get_combined_docitem_text_from_jobitem_id(_);process_docitem_split_set_ul(ID_INCLUDES_UL,e,_,n),process_docitem_split_set_ul(ID_EXCLUDES_UL,t,_,n)}function process_docitem_split_set_ul(e,t,_,n){const i=document.querySelector("#"+e),c=get_ele_li_with_same_jiid(i,_);var o=null!=c,n=n.replace(QTY_RE,t);if(o){let e=c.querySelector("."+CLASS_DISPLAY_SPAN);e.innerHTML=n,docitem_is_invalid(c)&&wipe_invalid_formatting(c)}else{t=create_ele_docitem_li(_,n,e);i.append(t),remove_none_li(i)}}function get_docitem_split_window_result_ele(e){let t=document.querySelector("."+CLASS_SPLIT_WINDOW);return t.querySelector("."+e).querySelector("span")}function create_ele_docitem_li(e,t,_){const n=document.createElement("li"),i=(n.setAttribute("data-jiid",e),document.createElement("span")),c=(i.classList.add(CLASS_DISPLAY_SPAN),i.innerHTML=t,n.append(i),document.createElement("div")),o=(c.classList.add("button-container"),document.createElement("button")),r=(o.classList.add(CLASS_SPLIT_BTN),o.classList.add("buttonSecondary"),o.innerHTML=STR_SPLIT_BTN,o.addEventListener("click",e=>{split_doc_item(e)}),document.createElement("button"));return r.classList.add(CLASS_TOGGLE_BTN),r.classList.add("button-primary"),_===ID_INCLUDES_UL?r.innerHTML=STR_EXCLUDES_BTN:_===ID_EXCLUDES_UL&&(r.innerHTML=STR_INCLUDES_BTN),r.addEventListener("click",e=>{toggle_doc_item(e)}),c.append(r),c.append(o),n.append(c),n}function docitem_is_invalid(e){return null!=e&&e.classList.contains(CSS_CLASS_INVALID_LI)}function get_valid_description(e){const t=e.querySelector("."+CLASS_DISPLAY_SPAN);return null==t?"Description not found":docitem_is_invalid(e)?(e=0<(e=parseInt(e.dataset.max_available))?e:0,t.innerHTML.replace(QTY_RE,e)):t.innerHTML}function fix_invalid_docitem_ele(e){return!(parseInt(e.dataset.max_available)<=0)&&(replace_invalid_description(e),wipe_invalid_formatting(e),!0)}function replace_invalid_description(e){if(!element_does_not_exist(e)){const t=e.querySelector("."+CLASS_DISPLAY_SPAN);t.innerHTML=get_valid_description(e)}}function wipe_invalid_formatting(e){remove_invalid_css(e),remove_invalid_icon(e)}function remove_invalid_css(e){element_does_not_exist(e)||e.classList.remove(CSS_CLASS_INVALID_LI)}function remove_invalid_icon(e){element_does_not_exist(e)||element_does_not_exist(e.querySelector("."+CSS_CLASS_INVALID_ICON))||e.querySelector("."+CSS_CLASS_INVALID_ICON).remove()}function element_does_not_exist(e){return null==e}export{CLASS_SPECIAL_INSTRUCTION_EDIT,CLASS_SPECIAL_INSTRUCTION_DELETE,CLASS_SHOW_ADD_INSTRUCTION_FORMLIKE,CLASS_HIDE_ADD_INSTRUCTION_FORMLIKE,open_issue_document_window,save_document,delete_document,show_save_warning_ele,open_editor_special_instruction,add_special_instruction_to_page,delete_ele_special_instruction,ID_INCLUDES_UL,ID_EXCLUDES_UL,CLASS_NONE_LI,CLASS_SPLIT_BTN,CLASS_TOGGLE_BTN,toggle_doc_item,split_doc_item};